<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tarifas FÍBARO – Panel Offline</title>
<style>
:root {
  --primary: #4E8FCA;
  --dark: #111111;
  --light: #ffffff;
  --muted: #e9eef5;
  --accent: #0f172a;
  --radius: 16px;
}
* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, 'Apple Color Emoji', 'Segoe UI Emoji';
  background: #0b0f17;
  color: var(--light);
}
.header {
  position: sticky; top: 0; z-index: 10;
  background: linear-gradient(180deg, #0b0f17 0%, rgba(11,15,23,0.6) 100%);
  backdrop-filter: blur(6px);
  border-bottom: 1px solid rgba(255,255,255,0.08);
}
.wrap { max-width: 1200px; margin: 0 auto; padding: 16px; }
.brand { display:flex; align-items:center; gap: 12px; flex-wrap:wrap; }
.brand img { height: 42px; }
.brand-links { display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
.brand-link { color:#e2e8f0; text-decoration:none; font-size:15px; font-weight:600; display:inline-flex; align-items:center; gap:8px; padding:6px 12px; border-radius:999px; border:1px solid transparent; transition:color .2s ease, border-color .2s ease, background .2s ease, transform .2s ease; }
.brand-link svg { width:18px; height:18px; }
.brand-link.phone-link svg { width:22px; height:22px; }
.brand-link:hover { color:var(--primary); border-color:rgba(78,143,202,0.4); background:rgba(78,143,202,0.12); transform:translateY(-1px); }
.brand-link.phone-link { background:rgba(34,197,94,0.16); border-color:rgba(34,197,94,0.45); color:#bbf7d0; font-size:16px; padding:8px 18px; box-shadow:0 6px 18px rgba(16,185,129,0.25); gap:12px; }
.brand-link.phone-link:hover { color:#fff; border-color:rgba(34,197,94,0.75); background:rgba(34,197,94,0.32); box-shadow:0 10px 26px rgba(16,185,129,0.35); }
.brand-link.instagram-link { background:linear-gradient(135deg, rgba(249,115,22,0.2), rgba(236,72,153,0.35)); border-color:rgba(252,165,165,0.45); color:#fbcfe8; font-weight:700; box-shadow:0 10px 26px rgba(236,72,153,0.35); }
.brand-link.instagram-link:hover { color:#fff; border-color:rgba(236,72,153,0.65); background:linear-gradient(135deg, rgba(249,115,22,0.35), rgba(236,72,153,0.55)); box-shadow:0 14px 32px rgba(236,72,153,0.45); }
.brand-link-text { display:flex; flex-direction:column; gap:2px; line-height:1.2; }
.brand-link-subtitle { font-size:12px; font-weight:500; opacity:0.8; color:#cbd5f5; }
.brand-link.phone-link .brand-link-subtitle { color:#d1fae5; }
.hidden { display: none !important; }
.user-info { display:flex; justify-content:flex-end; align-items:center; gap:10px; flex-wrap:wrap; margin-top:12px; }
.header-actions { display:flex; justify-content:flex-end; align-items:center; gap:16px; flex-wrap:wrap; margin-top:12px; }
.cta-button { padding:10px 18px; border-radius:999px; border:none; cursor:pointer; font-weight:700; letter-spacing:.4px; backgroun
d:linear-gradient(135deg, #38bdf8, #6366f1); color:#fff; box-shadow:0 12px 28px rgba(99,102,241,0.35); transition:transform .2s e
ase, box-shadow .2s ease; }
.cta-button:hover { transform:translateY(-2px); box-shadow:0 18px 36px rgba(99,102,241,0.45); }
.cta-button:focus-visible { outline:3px solid rgba(148,163,184,0.65); outline-offset:2px; }
.notification-wrapper { position:relative; }
.notification-bell { position:relative; width:44px; height:44px; border-radius:50%; border:1px solid rgba(148,163,184,0.35); backg
round:rgba(15,23,42,0.75); color:#cbd5f5; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:bac
kground .2s ease, transform .2s ease, box-shadow .2s ease; }
.notification-bell svg { width:22px; height:22px; }
.notification-bell:hover { background:rgba(30,41,59,0.85); transform:translateY(-1px); box-shadow:0 10px 24px rgba(15,23,42,0.45);
 }
.notification-bell:focus-visible { outline:3px solid rgba(99,102,241,0.6); outline-offset:2px; }
.notification-bell.active { color:#fbbf24; border-color:rgba(251,191,36,0.55); box-shadow:0 12px 28px rgba(251,191,36,0.25); }
.notification-dot { position:absolute; top:8px; right:8px; width:10px; height:10px; border-radius:50%; background:#f87171; box-shad
ow:0 0 0 2px rgba(15,23,42,0.85); display:none; }
.notification-bell.has-unread .notification-dot { display:block; }
.notification-dropdown { position:absolute; top:54px; right:0; width:320px; max-width:calc(100vw - 32px); background:#0f1522; bord
er:1px solid rgba(148,163,184,0.2); border-radius:16px; box-shadow:0 18px 44px rgba(15,23,42,0.55); padding:16px; display:flex; fl
ex-direction:column; gap:12px; z-index:90; }
.notification-dropdown.hidden { display:none !important; }
.notification-dropdown-header { display:flex; justify-content:space-between; align-items:center; gap:8px; }
.notification-dropdown-header span { font-weight:700; font-size:15px; }
.close-notifications { background:#ef4444; border:none; color:#fff; border-radius:999px; width:32px; height:32px; display:flex; ali
gn-items:center; justify-content:center; font-weight:700; cursor:pointer; box-shadow:0 8px 18px rgba(239,68,68,0.35); }
.close-notifications:hover { transform:translateY(-1px); }
.notification-list { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:10px; max-height:260px; overflo
w:auto; }
.notification-item { background:rgba(15,23,42,0.8); border:1px solid rgba(148,163,184,0.18); border-radius:12px; padding:10px 12p
x; display:flex; flex-direction:column; gap:4px; font-size:13px; color:#e2e8f0; }
.notification-item.unread { border-color:rgba(59,130,246,0.45); box-shadow:0 6px 16px rgba(59,130,246,0.25); }
.notification-message { line-height:1.4; }
.notification-time { font-size:11px; color:#94a3b8; }
.notification-actions { display:flex; justify-content:flex-end; }
.notification-empty { text-align:center; font-size:13px; color:#94a3b8; padding:12px; border-radius:12px; border:1px dashed rgba(14
8,163,184,0.3); }
.notification-footer { display:flex; justify-content:flex-end; }
.notification-footer button { border:none; background:transparent; color:#60a5fa; font-size:13px; cursor:pointer; }
.notification-footer button:hover { text-decoration:underline; }
.user-info .avatar { width:36px; height:36px; border-radius:50%; object-fit:cover; border:1px solid rgba(255,255,255,0.25); }
.user-info .name { font-weight:600; }
.role-tag { display:inline-flex; align-items:center; padding:4px 10px; border-radius:999px; border:1px solid rgba(255,255,255,0.18); font-size:12px; text-transform:uppercase; letter-spacing:.6px; }
.role-tag[data-role="admin"] { background: rgba(78,143,202,0.15); border-color: rgba(78,143,202,0.55); }
.role-tag[data-role="comercial"] { background: rgba(16,185,129,0.15); border-color: rgba(16,185,129,0.55); }
.role-tag[data-role="basico"] { background: rgba(148,163,184,0.12); border-color: rgba(148,163,184,0.4); }
.role-tag[data-role="cliente"] { background: rgba(59,130,246,0.18); border-color: rgba(59,130,246,0.55); }
.notice { background: rgba(15,21,34,0.85); border: 1px solid rgba(148,163,184,0.2); border-radius: var(--radius); padding: 18px; margin-bottom: 18px; }
.admin-subsection { margin-top:18px; }
.notice h2, .notice h3 { margin-top:0; }
.section-title { font-size: 18px; font-weight: 700; margin:0 0 8px; }
.section-subtitle { font-size: 15px; font-weight: 600; margin: 16px 0 8px; }
.stacked { display:flex; flex-direction:column; gap:12px; }
.form-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(180px,1fr)); gap:12px; }
.form-grid .full { grid-column: 1 / -1; }
textarea { width:100%; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,0.12); background:#0b1120; color:var(--light); min-height:88px; resize:vertical; }
.data-table { width:100%; border-collapse:collapse; margin-top:12px; }
.data-table th, .data-table td { border-bottom:1px solid rgba(255,255,255,0.08); padding:10px; text-align:left; font-size:13px; }
.data-table tbody tr:hover { background: rgba(78,143,202,0.08); }
.status-pill { display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; font-size:12px; text-transform:uppercase; letter-spacing:.4px; }
.status-pill[data-status="pendiente"] { background: rgba(244,178,55,0.15); color:#fbbf24; border:1px solid rgba(251,191,36,0.45); }
.status-pill[data-status="vendido"] { background: rgba(34,197,94,0.18); color:#86efac; border:1px solid rgba(34,197,94,0.45); }
.status-pill[data-status="cancelado"] { background: rgba(239,68,68,0.18); color:#fca5a5; border:1px solid rgba(239,68,68,0.45); }
.lead-list { margin-top:12px; display:flex; flex-direction:column; gap:12px; }
.lead-card { border:1px solid rgba(255,255,255,0.1); border-radius:14px; padding:12px 14px; background:#0b1120; }
.lead-card header { display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap; }
.lead-card .meta { font-size:12px; color:#93a0b5; }
.lead-card .body { margin-top:8px; font-size:13px; line-height:1.45; }
.lead-card footer { margin-top:12px; display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px; font-size:12px; color:#93a0b5; }
.points-wrapper { display:flex; flex-direction:column; gap:16px; margin:18px 0; }
.points-grid { display:grid; gap:16px; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); }
.points-card { background: linear-gradient(180deg, rgba(34,197,94,0.15) 0%, rgba(12,74,110,0.35) 100%); border-radius:18px; padding:18px; border:1px solid rgba(34,197,94,0.35); box-shadow:0 20px 45px rgba(15,118,110,0.35); position:relative; overflow:hidden; }
.points-card h3 { margin:0 0 8px; font-size:18px; letter-spacing:.4px; }
.points-card .balance { font-size:38px; font-weight:800; line-height:1; }
.points-card .balance span { font-size:16px; font-weight:600; display:block; color:#a8f5ff; letter-spacing:.4px; }
.points-card .hint { font-size:13px; color:rgba(226,232,240,0.85); margin:10px 0 0; }
.points-card .actions { margin-top:14px; display:flex; gap:10px; flex-wrap:wrap; }
.points-card.secondary { background: linear-gradient(180deg, rgba(59,130,246,0.18) 0%, rgba(29,78,216,0.28) 100%); border-color: rgba(59,130,246,0.45); box-shadow:0 20px 45px rgba(30,64,175,0.35); }
.points-card.secondary .hint { color:rgba(191,219,254,0.85); }
.points-history { background:#0b1120; border:1px solid rgba(148,163,184,0.18); border-radius:16px; padding:16px; }
.points-history h3 { margin:0 0 10px; font-size:16px; }
.points-history ul { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:10px; max-height:240px; overflow:auto; }
.points-history li { display:flex; justify-content:space-between; align-items:center; gap:12px; font-size:13px; padding:10px 12px; border-radius:12px; background:rgba(15,23,42,0.75); border:1px solid rgba(148,163,184,0.12); }
.points-history li.empty { justify-content:center; font-style:italic; color:#cbd5f5; border-style:dashed; }
.points-history li.earned { border-color:rgba(34,197,94,0.35); color:#bbf7d0; }
.points-history li.spent { border-color:rgba(239,68,68,0.35); color:#fecaca; }
.points-history .meta { display:flex; flex-direction:column; gap:2px; }
.points-history .meta span { font-size:12px; color:#cbd5f5; }
.rewards-grid { display:grid; gap:16px; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); }
.reward-card { background:#0b1120; border:1px solid rgba(148,163,184,0.18); border-radius:18px; padding:16px; display:flex; flex-direction:column; gap:12px; position:relative; overflow:hidden; }
.reward-thumb { position:relative; width:100%; aspect-ratio:4/3; border-radius:14px; overflow:hidden; border:1px solid rgba(148,163,184,0.2); background:linear-gradient(135deg, rgba(30,64,175,0.25), rgba(30,41,59,0.65)); display:flex; align-items:center; justify-content:center; }
.reward-thumb img { width:100%; height:100%; object-fit:cover; display:block; }
.reward-thumb.placeholder { color:#cbd5f5; font-size:12px; text-transform:uppercase; letter-spacing:.6px; font-weight:600; }
.reward-thumb.placeholder span { opacity:0.7; }
.upload-dropzone { position:relative; width:100%; border:1px dashed rgba(148,163,184,0.35); background:rgba(15,23,42,0.6); border-radius:14px; padding:18px; text-align:center; cursor:pointer; transition:border-color .2s ease, background .2s ease; display:flex; align-items:center; justify-content:center; min-height:160px; margin-top:8px; }
.upload-dropzone input[type="file"] { display:none; }
.upload-dropzone .upload-placeholder { color:#a8b3c7; display:flex; flex-direction:column; gap:6px; font-size:13px; max-width:260px; line-height:1.4; }
.upload-dropzone .upload-placeholder strong { color:#e2e8f0; font-weight:600; font-size:14px; }
.upload-dropzone.dragover { border-color:rgba(78,143,202,0.75); background:rgba(78,143,202,0.18); }
.upload-dropzone.has-image { padding:0; border-style:solid; border-color:rgba(78,143,202,0.55); background:#0b1120; }
.upload-dropzone.has-image img { display:block; width:100%; height:100%; object-fit:cover; border-radius:12px; }
.upload-actions { margin-top:8px; display:flex; justify-content:flex-end; }
.reward-card .title { font-size:17px; font-weight:700; }
.reward-card .cost { font-size:14px; color:#fbbf24; font-weight:600; }
.reward-card .validity { font-size:12px; color:#a8b3c7; }
.reward-card .requests { font-size:12px; color:#a8b3c7; }
.reward-card .actions { margin-top:auto; display:flex; gap:10px; flex-wrap:wrap; }
.reward-card.unlocked { border-color:rgba(34,197,94,0.5); box-shadow:0 20px 45px rgba(34,197,94,0.25); }
.reward-card.unlocked::after { content:''; position:absolute; inset:auto -40% -40% auto; width:160px; height:160px; background: radial-gradient(circle at center, rgba(34,197,94,0.35), transparent 70%); pointer-events:none; }
.reward-card.locked { opacity:0.65; }
.reward-card .tag { align-self:flex-start; }
.reward-card.out-of-stock {
  border-color: rgba(239,68,68,0.45);
  box-shadow: none;
}
.reward-card.out-of-stock .cost {
  color: #fca5a5;
}
.reward-status { display:flex; gap:6px; align-items:center; font-size:12px; color:#cbd5f5; }
.requests-list { display:flex; flex-direction:column; gap:12px; margin-top:12px; }
.request-item { background:#0b1120; border:1px solid rgba(148,163,184,0.18); border-radius:14px; padding:12px; display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; }
.request-item .info { display:flex; flex-direction:column; gap:4px; font-size:13px; }
.request-item .actions { display:flex; gap:8px; align-items:center; }
.empty-state { border:1px dashed rgba(148,163,184,0.35); border-radius:16px; padding:24px; text-align:center; color:#a8b3c7; margin-top:12px; }
.modal { position:fixed; inset:0; background:rgba(11,15,23,0.85); display:flex; align-items:center; justify-content:center; padding:20px; backdrop-filter:blur(4px); z-index:99; }
.modal.hidden { display:none !important; }
.modal .modal-content { background:#0f1522; border:1px solid rgba(255,255,255,0.12); border-radius:18px; padding:24px; max-width:420px; width:100%; box-shadow:0 25px 60px rgba(0,0,0,0.45); }
.modal .modal-content h3 { margin-top:0; }
.modal-actions { display:flex; justify-content:flex-end; gap:10px; margin-top:16px; }
.tile-actions { margin-top:auto; display:flex; gap:10px; flex-wrap:wrap; }
.flex-between { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:12px; }
.login-hints { margin:0; padding-left:20px; color:#cbd5f5; font-size:14px; }
.login-hints li + li { margin-top:6px; }
.muted-link { color:#93a0b5; font-size:12px; }
.small-hint { font-size:12px; color:#94a3b8; margin:6px 0 0; }
.tag { display:inline-flex; align-items:center; padding:4px 8px; border-radius:999px; background:rgba(148,163,184,0.12); border:1px solid rgba(148,163,184,0.3); font-size:11px; letter-spacing:.4px; text-transform:uppercase; }
.tag.tag-success { background: rgba(34,197,94,0.18); border-color: rgba(34,197,94,0.45); color:#86efac; }
.tag.tag-warning { background: rgba(234,179,8,0.18); border-color: rgba(234,179,8,0.45); color:#facc15; }
.tag.tag-error { background: rgba(239,68,68,0.18); border-color: rgba(239,68,68,0.45); color:#fca5a5; }
.highlight { color:#fbbf24; font-weight:600; }
.toolbar {
  display:grid;
  grid-template-columns: repeat(6, minmax(0,1fr));
  gap: 12px; margin-top: 12px;
}
.results-toolbar {
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:16px;
  flex-wrap:wrap;
  margin-top:12px;
}
.results-info {
  display:flex;
  align-items:baseline;
  gap:8px;
}
.results-label {
  font-size:13px;
  letter-spacing:.4px;
  text-transform:uppercase;
  color:#94a3b8;
}
.results-count {
  font-size:24px;
  font-weight:700;
  color:#fff;
}
.results-toolbar #imprimir {
  background:rgba(148,163,184,0.18);
  border:1px solid rgba(148,163,184,0.35);
  color:#e2e8f0;
}
.results-toolbar #imprimir:hover {
  background:rgba(148,163,184,0.28);
  border-color:rgba(148,163,184,0.55);
}
.card {
  background: #0f1522;
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: var(--radius);
  padding: 14px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.25);
}
.label { font-size: 12px; color: #a8b3c7; margin-bottom: 6px; display:block; }
input[type="number"], input[type="text"], select {
  width:100%; padding: 10px 12px;
  border-radius: 12px; border: 1px solid rgba(255,255,255,0.12);
  background: #0b1120; color: var(--light);
  outline: none;
}
.toggle-field { display:flex; align-items:center; gap:10px; font-size:13px; color:#e2e8f0; }
.toggle-field label { cursor:pointer; }
.toggle-field input[type="checkbox"] { width:18px; height:18px; accent-color:var(--primary); }
input[type="date"]{
  width:100%; padding: 10px 12px;
  border-radius: 12px; border: 1px solid rgba(255,255,255,0.12);
  background: #0b1120; color: var(--light);
}
button.primary {
  padding: 12px 16px; border-radius: 12px; border: none; cursor:pointer;
  background: var(--primary); color: #fff; font-weight: 600;
  letter-spacing:.3px;
}
.controls { display:flex; gap: 10px; align-items:center; }
.grid {
  display:flex;
  flex-direction:column;
  gap:28px;
  margin-top:28px;
  width:100%;
}
.tile {
  background: linear-gradient(180deg, #0f1522 0%, #0b1120 100%);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 18px;
  padding: 20px;
  transition: transform .15s ease, box-shadow .15s ease;
  display:flex;
  flex-direction:column;
  gap:16px;
  position:relative;
  overflow:hidden;
}
.tile:hover { transform: translateY(-3px); box-shadow: 0 12px 35px rgba(0,0,0,.35); }
.tile.featured { border-color: rgba(78,143,202,0.6); box-shadow: 0 16px 40px rgba(78,143,202,0.25); position:relative; }
.tile.featured::after { content:'Destacada'; position:absolute; top:14px; right:16px; font-size:11px; letter-spacing:.6px; text-transform:uppercase; background:rgba(78,143,202,0.2); border:1px solid rgba(78,143,202,0.6); border-radius:999px; padding:4px 10px; color:#bfdbfe; }
.tile.highlighted { box-shadow: 0 0 0 2px rgba(78,143,202,0.6); }
.tile .title { font-size: 18px; font-weight: 700; letter-spacing:.4px; }
.badge { display:inline-flex; align-items:center; gap:6px; padding: 4px 8px; border-radius: 999px;
  background: rgba(78,143,202,0.15); color: var(--light); border: 1px solid rgba(78,143,202,0.35); font-size: 12px; }
.price { font-size: 28px; font-weight: 800; }
.dim { color: #a8b3c7; font-size: 13px; }
.kpis { display:flex; gap: 10px; flex-wrap:wrap; margin-top: 10px; }
.kpi { flex: 1 1 100px; padding:10px; border-radius: 12px; background:#0b1120; border:1px solid rgba(255,255,255,.08); }
.footer { text-align:center; color:#93a0b5; font-size:12px; padding: 22px 0 40px; }
.icon { width:18px; height:18px; vertical-align:-4px; }
hr.sep { border: none; border-top: 1px dashed rgba(255,255,255,0.12); margin: 10px 0; }
@media (max-width: 1100px) {
  .toolbar{grid-template-columns: repeat(2, minmax(0,1fr));}
  .tariff-jumps, .tariff-client-tabs { padding:10px; }
}
@media (max-width: 768px) {
  .tariff-card-header { flex-direction:column; align-items:flex-start; }
  .tariff-card-price { width:100%; justify-content:flex-start; }
}
@media (max-width: 640px) {
  .toolbar{grid-template-columns:1fr;}
  .brand img{height:34px;}
  .tile{padding:18px;}
  .tariff-jumps, .tariff-client-tabs { border-radius:14px; gap:6px; }
  .tariff-type-section { padding:16px; }
  .tariff-type-section .tariff-card-grid { gap:16px; }
  .brand-link { font-size:14px; }
  .tariff-card-meta-grid { grid-template-columns:1fr; }
  .floating-actions { right:16px; bottom:16px; }
  .floating-actions a { width:52px; height:52px; }
}
.smallbtn { background: transparent; border:1px solid rgba(255,255,255,.2); color:#fff; padding:10px 12px; border-radius:12px; cursor:pointer; }
.smallbtn:hover { border-color: var(--primary); }
.smallbtn.danger { border-color: rgba(239,68,68,0.55); color:#fca5a5; }
.smallbtn.danger:hover { border-color: rgba(239,68,68,0.8); background: rgba(239,68,68,0.18); }
.stacked.gap-sm { gap:8px; }
.multi-select { min-height:110px; }
.inline-actions { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.ai-results { margin-top:16px; display:grid; gap:14px; }
.ai-filter-form .inline-actions { margin-top:4px; }
.ai-preferences { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px,1fr)); gap:12px; }
.ai-preferences .full { grid-column:1 / -1; }
.ai-lines-field.hidden, .ai-tv-field.hidden { display:none !important; }
.ai-lines-field, .ai-tv-field { transition:opacity .2s ease; }
@media (min-width: 768px) {
  .ai-results { grid-template-columns: repeat(3, minmax(0, 1fr)); }
}
.ai-card { background:#0b1120; border:1px solid rgba(255,255,255,0.08); border-radius:16px; padding:16px; display:flex; flex-direction:column; gap:12px; }
.tariff-layout { display:flex; flex-direction:column; gap:24px; }
.tariff-panels { display:flex; flex-direction:column; gap:24px; }
.tariff-jumps { display:flex; flex-wrap:wrap; gap:10px; padding:12px; margin:0; background:rgba(15,23,42,0.7); border:1px solid rgba(148,163,184,0.2); border-radius:18px; box-shadow:0 12px 30px rgba(8,11,19,0.45); overflow-x:auto; scrollbar-width:none; }
.tariff-jumps::-webkit-scrollbar { display:none; }
.tariff-jumps button { background:rgba(148,163,184,0.16); border:1px solid rgba(148,163,184,0.35); color:#e2e8f0; padding:10px 16px; border-radius:12px; cursor:pointer; font-weight:600; transition:background .2s ease, border-color .2s ease, transform .15s ease; white-space:nowrap; }
.tariff-jumps button:hover { background:rgba(78,143,202,0.18); border-color:rgba(78,143,202,0.5); transform:translateY(-1px); }
.tariff-client-tabs, .tariff-admin-tabs, .tariff-type-buttons { display:flex; flex-wrap:wrap; gap:8px; margin:0; padding:12px; background:rgba(15,23,42,0.7); border:1px solid rgba(148,163,184,0.2); border-radius:18px; box-shadow:0 12px 30px rgba(8,11,19,0.45); overflow-x:auto; scrollbar-width:none; }
.tariff-client-tabs::-webkit-scrollbar, .tariff-admin-tabs::-webkit-scrollbar, .tariff-type-buttons::-webkit-scrollbar { display:none; }
.tariff-tab-btn, .tariff-type-btn { border:1px solid rgba(148,163,184,0.35); background:rgba(148,163,184,0.12); color:#e2e8f0; padding:8px 16px; border-radius:999px; font-size:13px; font-weight:600; letter-spacing:.3px; cursor:pointer; transition:background .2s ease, border-color .2s ease, color .2s ease, transform .15s ease; white-space:nowrap; }
.tariff-tab-btn:hover, .tariff-type-btn:hover { background:rgba(78,143,202,0.18); border-color:rgba(78,143,202,0.45); transform:translateY(-1px); }
.tariff-tab-btn.active, .tariff-type-btn.active { background:var(--primary); border-color:transparent; color:#fff; box-shadow:0 8px 24px rgba(78,143,202,0.25); }
.tariff-company-panel { display:none; }
.tariff-company-panel.grid-layout { grid-template-columns:repeat(auto-fit, minmax(260px, 1fr)); gap:18px; }
.tariff-company-panel.grid-layout .tile { height:100%; }
.tariff-company-panel.active { display:block; }
.tariff-company-panel.active.grid-layout { display:grid; }
.tariff-company-panel.empty { display:block; padding:18px; border:1px dashed rgba(148,163,184,0.35); border-radius:16px; color:#94a3b8; }
.tariff-type-section { margin:0; background:rgba(11,17,32,0.8); border:1px solid rgba(148,163,184,0.18); border-radius:18px; padding:20px; display:flex; flex-direction:column; gap:16px; }
.tariff-type-section h3 { margin:0; font-size:18px; font-weight:700; letter-spacing:.4px; }
.tariff-type-section .section-description { margin:0; color:#94a3b8; font-size:13px; }
.tariff-type-section .tariff-card-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(260px, 1fr)); gap:18px; }
.tariff-highlight-block { margin:18px 0 10px; }
.tariff-highlight-block h2 { margin:0 0 12px; font-size:20px; letter-spacing:.4px; }
.tariff-highlight-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(260px, 1fr)); gap:18px; }
.tariff-highlight-grid .tile { height:100%; }
.tariff-card-header { display:flex; justify-content:space-between; align-items:flex-start; gap:16px; flex-wrap:wrap; }
.tariff-card-heading { display:flex; flex-direction:column; gap:6px; flex:1 1 220px; min-width:0; }
.tariff-card-name { font-size:20px; font-weight:700; margin:0; line-height:1.2; }
.tariff-card-code { color:#94a3b8; font-size:13px; word-break:break-word; }
.tariff-card-price { display:flex; align-items:baseline; gap:6px; color:#e2e8f0; }
.tariff-card-amount { font-size:32px; font-weight:800; line-height:1; }
.tariff-card-period { font-size:13px; color:#94a3b8; text-transform:uppercase; letter-spacing:.4px; }
.tariff-card-tags { display:flex; flex-wrap:wrap; gap:8px; }
.tariff-card-description { margin:0; color:#cbd5f5; line-height:1.55; white-space:pre-line; }
.tariff-card-meta-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(160px, 1fr)); gap:12px; }
.tariff-card-meta-item { background:rgba(12,18,31,0.75); border:1px solid rgba(148,163,184,0.2); border-radius:14px; padding:12px; display:flex; flex-direction:column; gap:4px; font-size:12px; color:#94a3b8; min-height:78px; }
.tariff-card-meta-item .tariff-detail-label { text-transform:uppercase; letter-spacing:.4px; font-weight:600; color:#64748b; }
.tariff-card-meta-item strong { font-size:16px; color:#e2e8f0; font-weight:700; }
.tariff-detail-note { font-size:12px; color:#64748b; }
.floating-actions { position:fixed; right:28px; bottom:28px; display:flex; flex-direction:column; gap:12px; z-index:120; }
.floating-actions a,
.floating-actions button { width:58px; height:58px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; text-decoration:none; box-shadow:0 12px 28px rgba(0,0,0,0.4); transition:transform .2s ease, box-shadow .2s ease; }
.floating-actions a:focus-visible { outline:3px solid rgba(255,255,255,0.85); outline-offset:3px; }
.floating-actions a:hover,
.floating-actions button:hover { transform:translateY(-3px) scale(1.02); box-shadow:0 16px 32px rgba(0,0,0,0.45); }
.floating-actions button { border:none; cursor:pointer; background:linear-gradient(135deg, #38bdf8, #0ea5e9); }
.floating-actions button:focus-visible { outline:3px solid rgba(255,255,255,0.85); outline-offset:3px; }
.floating-actions a.whatsapp { background:linear-gradient(135deg, #22c55e, #16a34a); }
.floating-actions a.instagram { background:linear-gradient(135deg, #f97316, #ec4899); }
.floating-actions svg { width:26px; height:26px; }
.call-request-button { background:linear-gradient(135deg, #f97316, #facc15) !important; color:#fff; }
.call-request-button svg { width:26px; height:26px; }
.tariff-admin-controls { margin:16px 0; }
.tariff-admin-controls .tariff-type-buttons { margin:12px 0 0; }
.badge-type { background:rgba(78,143,202,0.15); border:1px solid rgba(78,143,202,0.35); color:#bfdbfe; }
.tariff-table-note { font-size:12px; color:#94a3b8; margin:8px 0 0; }
.admin-tariff-table { width:100%; border-collapse:collapse; }
.admin-tariff-table th, .admin-tariff-table td { border-bottom:1px solid rgba(255,255,255,0.08); padding:10px; text-align:left; font-size:13px; }
.admin-tariff-table tbody tr:hover { background:rgba(78,143,202,0.08); }
.admin-tariff-table tr.featured-row { background:rgba(78,143,202,0.12); }
.admin-tariff-table tr.featured-row:hover { background:rgba(78,143,202,0.2); }
@media (max-width: 1100px) { .tariff-company-panel.grid-layout .tile{grid-column: span 6 / span 6;} .tariff-type-section .tile{grid-column: span 6 / span 6;} .tariff-highlight-grid .tile{grid-column: span 6 / span 6;} }
@media (max-width: 640px) { .tariff-company-panel.grid-layout .tile{grid-column: span 12 / span 12;} .tariff-type-section .tile{grid-column: span 12 / span 12;} .tariff-highlight-grid .tile{grid-column: span 12 / span 12;} }
.ai-card h4 { margin:0; font-size:16px; }
.ai-card p { margin:0; }
.ai-card .badge { margin-right:auto; }
.profile-modal { max-width: 720px; width: 100%; }
.profile-modal h3 { margin-top: 0; }
.profile-modal .modal-actions { gap: 12px; flex-wrap: wrap; }

#commercialMetrics {
  background: #0b1120;
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 18px;
  padding: 18px;
  display: flex;
  flex-direction: column;
  gap: 18px;
  margin-top: 16px;
}
#commercialMetrics .commercial-kpi { display: flex; flex-direction: column; gap: 12px; }
#commercialMetrics .kpi-header { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px; }
#commercialMetrics .kpi-header strong { font-size: 20px; }
.kpi-progress-track { position: relative; height: 10px; border-radius: 999px; background: rgba(148,163,184,0.2); overflow: hidden; }
.kpi-progress-fill { position: absolute; inset: 0; background: linear-gradient(90deg, #4E8FCA 0%, #22d3ee 100%); }
.kpi-markers { display:flex; justify-content:space-between; font-size:11px; color:#a8b3c7; margin-top:4px; }
.kpi-status { display:flex; flex-direction:column; gap:4px; font-size:13px; color:#a8b3c7; }
.commission-card { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:12px; background: rgba(78,143,202,0.12); border:1px solid rgba(78,143,202,0.35); border-radius:14px; padding:14px; }
.commission-value { font-size:26px; font-weight:700; }
.commission-meta { display:flex; gap:12px; flex-wrap:wrap; font-size:12px; color:#a8b3c7; }
.bonus-highlight {
  display:flex;
  flex-direction:column;
  gap:6px;
  padding:16px;
  border-radius:16px;
  border:1px solid rgba(251,191,36,0.45);
  background: linear-gradient(135deg, rgba(251,191,36,0.18) 0%, rgba(217,119,6,0.08) 100%);
  color:#facc15;
  box-shadow:0 12px 35px rgba(120,73,0,0.25);
}
.bonus-highlight.active {
  background: linear-gradient(135deg, rgba(250,204,21,0.35) 0%, rgba(202,138,4,0.25) 100%);
  color:#fef3c7;
  border-color: rgba(250,204,21,0.8);
  box-shadow:0 16px 45px rgba(202,138,4,0.35);
}
.bonus-label { font-size:12px; text-transform:uppercase; letter-spacing:.4px; color:rgba(255,255,255,0.75); }
.bonus-amount { font-size:32px; font-weight:800; color:#fff; text-shadow:0 4px 14px rgba(250,204,21,0.35); }
.bonus-note { font-size:13px; color:rgba(255,255,255,0.75); }
.total-benefit-card {
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  padding:16px;
  border-radius:16px;
  border:1px solid rgba(34,197,94,0.35);
  background: linear-gradient(135deg, rgba(34,197,94,0.18) 0%, rgba(22,163,74,0.12) 100%);
  box-shadow:0 12px 30px rgba(15,118,110,0.25);
}
.total-benefit-value { font-size:28px; font-weight:800; color:#bbf7d0; }
.metrics-history { border-top:1px dashed rgba(255,255,255,0.12); padding-top:12px; }
.metrics-history h4 { margin:0 0 8px; font-size:14px; color:#a8b3c7; text-transform:uppercase; letter-spacing:.4px; }
.metrics-history ul { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:8px; }
.metrics-history li { display:flex; justify-content:space-between; align-items:center; font-size:13px; color:#a8b3c7; }
.metrics-history li strong { color:#fff; }

.admin-tabs { display:flex; gap:8px; flex-wrap:wrap; margin:16px 0; }
.admin-tabs .tab { border:1px solid rgba(255,255,255,0.15); background:transparent; color:#fff; padding:8px 16px; border-radius:999px; cursor:pointer; font-weight:600; letter-spacing:.3px; }
.admin-tabs .tab.active { background:var(--primary); border-color:var(--primary); }
.admin-tab { margin-top:0; }
.stats-grid { display:grid; gap:12px; grid-template-columns:repeat(auto-fit, minmax(240px,1fr)); }
.stat-card { background:#0b1120; border:1px solid rgba(255,255,255,0.08); border-radius:16px; padding:16px; display:flex; flex-direction:column; gap:12px; box-shadow:0 12px 30px rgba(0,0,0,0.25); }
.stat-card[data-rank="1"] { border-color: rgba(34,197,94,0.45); box-shadow:0 16px 36px rgba(34,197,94,0.25); }
.stat-card[data-rank="2"] { border-color: rgba(59,130,246,0.35); }
.stat-card[data-rank="3"] { border-color: rgba(234,179,8,0.35); }
.stat-header { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px; }
.stat-name { font-weight:600; font-size:16px; }
.stat-rank { font-size:12px; color:#a8b3c7; }
.kpi-badge { display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; font-size:11px; border:1px solid rgba(255,255,255,0.18); }
.kpi-badge[data-state="active"] { background: rgba(34,197,94,0.15); border-color: rgba(34,197,94,0.4); color:#86efac; }
.kpi-badge[data-state="pending"] { background: rgba(234,179,8,0.15); border-color: rgba(234,179,8,0.35); color:#facc15; }
.stat-body { display:grid; gap:6px; font-size:13px; color:#a8b3c7; }
.stat-body strong { color:#fff; }
.stat-figure { font-size:28px; font-weight:700; color:#fff; line-height:1.1; }
.stat-figure span { display:block; font-size:12px; font-weight:500; color:#94a3b8; text-transform:uppercase; letter-spacing:.4px; }
.stat-metrics { display:grid; gap:4px; font-size:13px; color:#a8b3c7; }
.stat-metric { display:flex; justify-content:space-between; align-items:center; }
.stat-metric strong { color:#fff; }
.stat-footnote { font-size:12px; color:#94a3b8; border-top:1px dashed rgba(255,255,255,0.08); padding-top:8px; }
.stat-avatar { width:36px; height:36px; border-radius:50%; overflow:hidden; background:rgba(59,130,246,0.12); display:flex; align-items:center; justify-content:center; font-weight:700; text-transform:uppercase; letter-spacing:.4px; color:#60a5fa; border:1px solid rgba(59,130,246,0.35); }
.stat-avatar img { width:100%; height:100%; object-fit:cover; display:block; }
.admin-stats-toolbar { display:flex; justify-content:space-between; align-items:flex-start; flex-wrap:wrap; gap:16px; margin:12px 0; }
.admin-stats-toolbar .range-info { font-size:13px; color:#94a3b8; margin:4px 0 0; }
.range-switcher { display:flex; align-items:center; gap:10px; }
.range-switcher-label { font-size:11px; text-transform:uppercase; letter-spacing:.4px; color:#94a3b8; }
.range-switcher-buttons { display:flex; gap:6px; background:rgba(15,23,42,0.6); border:1px solid rgba(148,163,184,0.18); padding:4px; border-radius:999px; }
.range-switcher button { border:none; background:transparent; color:#e2e8f0; font-size:13px; font-weight:600; padding:6px 14px; border-radius:999px; cursor:pointer; transition:background .2s ease, color .2s ease, box-shadow .2s ease; }
.range-switcher button.active { background:var(--primary); color:#fff; box-shadow:0 6px 18px rgba(78,143,202,0.35); }
.range-switcher button:focus-visible { outline:2px solid var(--primary); outline-offset:2px; }
.admin-sales-totals { display:flex; flex-wrap:wrap; gap:12px; }
.admin-total-card { flex:1 1 220px; display:flex; flex-direction:column; gap:6px; padding:16px; border-radius:16px; border:1px solid rgba(59,130,246,0.35); background:linear-gradient(135deg, rgba(59,130,246,0.18) 0%, rgba(15,23,42,0.65) 100%); box-shadow:0 12px 30px rgba(30,64,175,0.25); }
.admin-total-card .total-heading { font-size:11px; text-transform:uppercase; letter-spacing:.4px; color:#94a3b8; }
.admin-total-card .total-number { font-size:32px; font-weight:800; line-height:1; color:#fff; }
.admin-total-card .total-breakdown { font-size:13px; color:#cbd5f5; }
.admin-stats-group { margin-top:18px; display:flex; flex-direction:column; gap:12px; }

@media (max-width: 768px) {
  #commercialMetrics { padding: 16px; }
  .commission-card { flex-direction:column; align-items:flex-start; }
}
</style>
</head>
<body>
<header class="header">
  <div class="wrap">
    <div class="brand">
      <img src="data:image/png;base64,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sTtkJIwAAggggAACCCCAQPUFyAABBBBAAAEEEEAAAQQQQAABBJIvQIUIIBA/AS4AiN8xI2MEEEAAAQQQQAABBKotwPoIIIAAAggggAACCCCAAAIIIJB8ASpEAIEYCnABQAwPGikjgAACCCCAAAIIIFBdAVZHAAEEEEAAAQQQQAABBBBAAIHkC1AhAgjEUYALAOJ41MgZAQQQQAABBBBAAIFqCrA2AggggAACCCCAAAIIIIAAAggkX4AKEUAglgJcABDLw0bSCCCAAAIIIIAAAghUT4CVEUAAAQQQQAABBBBAAAEEEEAg+QJUiAAC8RT4f3buJLdhIAYCoP//6nhftQxz8bBdQBJLGhpml6+NKAD0/N5sTYAAAQIECBAgQIAAAQIEKgJmCRAgQIAAAQIECBAgQIAAgXyBgwLAD3zJIhIgQIAAAQIECBAgQIDArwvIT4AAAQIECBAgQIAAAQIECOQLHBQAfuFLlpEAAQIECBAgQIAAAQIEflxAfAIECBAgQIAAAQIECBAgQCBf4JjQfwA4IvghQIAAAQIECBAgQIAAAQLJArIRIECAAAECBAgQIECAAAEC+QKnhAoAJwW/BAgQIECAAAECBAgQIEAgV0AyAgQIECBAgAABAgQIECBAIF/gnFAB4MzgDwECBAgQIECAAAECBAgQSBWQiwABAgQIECBAgAABAgQIEMgXuCRUALg4+EuAAAECBAgQIECAAAECBDIFpCJAgAABAgQIECBAgAABAgTyBa4JFQCuEF4IECBAgAABAgQIECBAgECigEwECBAgQIAAAQIECBAgQIBAvsAtoQLATcIrAQIECBAgQIAAAQIECBDIE5CIAAECBAgQIECAAAECBAgQyBe4J1QAuFO4IECAAAECBAgQIECAAAECaQLyECBAgAABAgQIECBAgAABAvkCj4QKAA8LVwQIECBAgAABAgQIECBAIEtAGgIECBAgQIAAAQIECBAgQCBf4CmhAsAThksCBAgQIECAAAECBAgQIJAkIAsBAgQIECBAgAABAgQIECCQL/CcUAHgWcM1AQIECBAgQIAAAQIECBDIEZCEAAECBAgQIECAAAECBAgQyBd4SagA8MLhhgABAgQIECBAgAABAgQIpAjIQYAAAQIECBAgQIAAAQIECOQLvCZUAHj1cEeAAAECBAgQIECAAAECBDIEpCBAgAABAgQIECBAgAABAgTyBd4SKgC8gbglQIAAAQIECBAgQIAAAQIJAjIQIECAAAECBAgQIECAAAEC+QLvCRUA3kXcEyBAgAABAgQIECBAgACB/gISECBAgAABAgQIECBAgAABAvkCHwkVAD5IPCBAgAABAgQIECBAgAABAt0F7E+AAAECBAgQIECAAAECBAjkC3wmVAD4NPGEAAECBAgQIECAAAECBAj0FrA9AQIECBAgQIAAAQIECBAgkC+wkFABYAHFIwIECBAgQIAAAQIECBAg0FnA7gQIECBAgAABAgQIECBAgEC+wFJCBYAlFc8IECBAgAABAgQIECBAgEBfAZsTIECAAAECBAgQIECAAAEC+QKLCRUAFlk8JECAAAECBAgQIECAAAECXQXsTYAAAQIECBAgQIAAAQIECOQLLCdUAFh28ZQAAQIECBAgQIAAAQIECPQUsDUBAgQIECBAgAABAgQIECCQL7CSUAFgBcZjAgQIECBAgAABAgQIECDQUcDOBAgQIECAAAECBAgQIECAQL7AWkIFgDUZzwkQIECAAAECBAgQIECAQD8BGxMgQIAAAQIECBAgQIAAAQL5AqsJFQBWaRwQIECAAAECBAgQIECAAIFuAvYlQIAAAQIECBAgQIAAAQIE8gXWEyoArNs4IUCAAAECBAgQIECAAAECvQRsS4AAAQIECBAgQIAAAQIECOQLbCRUANjAcUSAAAECBAgQIECAAAECBDoJ2JUAAQIECBAgQIAAAQIECBDIF9hKqACwpeOMAAECBAgQIECAAAECBAj0EbApAQIECBAgQIAAAQIECBAgkC+wmVABYJPHIQECBAgQIECAAAECBAgQ6CJgTwIECBAgQIAAAQIECBAgQCBfYDuhAsC2j1MCBAgQIECAAAECBAgQINBDwJYECBAgQIAAAQIECBAgQIBAvsBOQgWAHSDHBAgQIECAAAECBAgQIECgg4AdCRAgQIAAAQIECBAgQIAAgXyBvYQKAHtCzgkQIECAAAECBAgQIECAwPwCNiRAgAABAgQIECBAgAABAgTyBXYTKgDsEhkgQIAAAQIECBAgQIAAAQKzC9iPAAECBAgQIECAAAECBAgQyBfYT6gAsG9kggABAgQIECBAgAABAgQIzC1gOwIECBAgQIAAAQIECBAgQCBfYCChAsAAkhECBAgQIECAAAECBAgQIDCzgN0IECBAgAABAgQIECBAgACBfIGRhAoAI0pmCBAgQIAAAQIECBAgQIDAvAI2I0CAAAECBAgQIECAAAECBPIFhhIqAAwxGSJAgAABAgQIECBAgAABArMK2IsAAQIECBAgQIAAAQIECBDIFxhLqAAw5mSKAAECBAgQIECAAAECBAjMKWArAgQIECBAgAABAgQIECBAIF9gMKECwCCUMQIECBAgQIAAAQIECBAgMKOAnQgQIECAAAECBAgQIECAAIF8gdGECgCjUuYIECBAgAABAgQIECBAgMB8AjYiQIAAAQIECBAgQIAAAQIE8gWGEyoADFMZJECAAAECBAgQIECAAAECswnYhwABAgQIECBAgAABAgQIEMgXGE+oADBuZZIAAQIECBAgQIAAAQIECMwlYBsCBAgQIECAAAECBAgQIEAgX6CQUAGggGWUAAECBAgQIECAAAECBAjMJGAXAgQIECBAgAABAgQIECBAIF+gklABoKJllgABAgQIECBAgAABAgQIzCNgEwIECBAgQIAAAQIECBAgQCBfdH7IawAAAQ1JREFUoJRQAaDEZZgAAQIECBAgQIAAAQIECMwiYA8CBAgQIECAAAECBAgQIEAgX6CWUAGg5mWaAAECBAgQIECAAAECBAjMIWALAgQIECBAgAABAgQIECBAIF+gmFABoAhmnAABAgQIECBAgAABAgQIzCBgBwIECBAgQIAAAQIECBAgQCBfoJpQAaAqZp4AAQIECBAgQIAAAQIECHxfwAYECBAgQIAAAQIECBAgQIBAvkA5oQJAmcwbCBAgQIAAAQIECBAgQIDAtwV8PgECBAgQIECAAAECBAgQIJAvUE+oAFA38w4CBAgQIECAAAECBAgQIPBdAZ9OgAABAgQIECBAgAABAgQI5Av8I+EfAAAA//+XVuxyAAAABklEQVQDAAh2h11CsnSmAAAAAElFTkSuQmCC" alt="FÍBARO logo" />
      <div class="brand-links">
        <a class="brand-link instagram-link" href="https://www.instagram.com/fibaroteleco" target="_blank" rel="noreferrer noopener">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="18" height="18" rx="5" stroke="currentColor" stroke-width="2"/><path d="M16 11.37A3.37 3.37 0 1 1 12.63 8 3.37 3.37 0 0 1 16 11.37z" stroke="currentColor" stroke-width="2"/><circle cx="17.5" cy="6.5" r="1.5" fill="currentColor"/></svg>
          @fibaroteleco
        </a>
        <a class="brand-link phone-link" href="https://wa.me/34633671657" target="_blank" rel="noreferrer noopener" aria-label="Contactar por WhatsApp">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 20.5 5.5 16A7.5 7.5 0 1 1 12 19.5a7.4 7.4 0 0 1-3.5-.9L4 20.5z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/><path d="M9.5 9.75c0 1.95 1.8 3.75 3.75 3.75" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <div class="brand-link-text">
            <span>633 67 16 57</span>
            <span class="brand-link-subtitle">WhatsApp directo</span>
          </div>
        </a>
      </div>
      <span id="syncStatus" class="tag tag-warning">Sincronizando…</span>
    </div>
    <div class="user-info" id="userInfo">
      <button class="primary" id="openLogin">Iniciar sesión</button>
    </div>
    <div class="header-actions">
      <button type="button" class="cta-button hidden" id="customBudgetButton">Presupuesto a medida</button>
      <div class="notification-wrapper">
        <button type="button" class="notification-bell" id="notificationButton" aria-label="Abrir notificaciones" aria-expanded="false" aria-haspopup="true">
          <span class="notification-dot" id="notificationDot"></span>
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 9a6 6 0 0 1 12 0c0 5 2 7 2 7H4s2-2 2-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M10 19a2 2 0 1 0 4 0" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <div class="notification-dropdown hidden" id="notificationDropdown" role="dialog" aria-modal="false">
          <div class="notification-dropdown-header">
            <span>Notificaciones</span>
            <button type="button" class="close-notifications" id="closeNotifications" aria-label="Cerrar notificaciones">×</button>
          </div>
          <ul class="notification-list" id="notificationList"></ul>
          <div class="notification-footer">
            <button type="button" id="markNotificationsRead">Marcar como leídas</button>
          </div>
        </div>
      </div>
    </div>
    <div class="toolbar results-toolbar">
      <div class="results-info">
        <span class="results-label">Tarifas disponibles</span>
        <span class="results-count" id="count">0</span>
      </div>
      <button class="smallbtn" id="imprimir">Imprimir catálogo</button>
    </div>
  </div>
</header>

<div id="loginModal" class="modal hidden" role="dialog" aria-modal="true">
  <div class="modal-content">
    <h3>Iniciar sesión</h3>
    <p class="dim" style="margin-top:-4px;">Selecciona un perfil disponible e introduce sus credenciales.</p>
    <form id="loginForm" class="stacked">
      <div>
        <label class="label" for="loginUser">Usuario</label>
        <input id="loginUser" type="text" autocomplete="username" required />
      </div>
      <div>
        <label class="label" for="loginPass">Contraseña</label>
        <input id="loginPass" type="password" autocomplete="current-password" required />
      </div>
      <div class="dim" id="loginError" style="min-height:18px;"></div>
      <div class="modal-actions">
        <button type="button" class="smallbtn" id="cancelLogin">Cancelar</button>
        <button type="submit" class="primary">Entrar</button>
      </div>
    </form>
    <p class="muted-link">Perfiles disponibles: <span id="availableUsers"></span></p>
  </div>
</div>

<div id="registerModal" class="modal hidden" role="dialog" aria-modal="true">
  <div class="modal-content">
    <h3>Crear cuenta de cliente</h3>
    <p class="dim" style="margin-top:-4px;">Registra un usuario de cliente para solicitar tarifas directamente al equipo administrador.</p>
    <form id="registerForm" class="stacked">
      <div class="form-grid">
        <div>
          <label class="label" for="registerFirstName">Nombre</label>
          <input id="registerFirstName" type="text" autocomplete="given-name" placeholder="Nombre" />
        </div>
        <div>
          <label class="label" for="registerLastName">Apellidos</label>
          <input id="registerLastName" type="text" autocomplete="family-name" placeholder="Apellidos" />
        </div>
        <div>
          <label class="label" for="registerEmail">Correo electrónico</label>
          <input id="registerEmail" type="email" autocomplete="email" placeholder="tu@correo.com" />
        </div>
        <div>
          <label class="label" for="registerUser">Usuario</label>
          <input id="registerUser" type="text" autocomplete="username" required placeholder="Identificador" />
        </div>
        <div>
          <label class="label" for="registerPass">Contraseña</label>
          <input id="registerPass" type="password" autocomplete="new-password" required placeholder="Mínimo 6 caracteres" />
        </div>
        <div>
          <label class="label" for="registerPassConfirm">Repite la contraseña</label>
          <input id="registerPassConfirm" type="password" autocomplete="new-password" required placeholder="Confirma la contraseña" />
        </div>
      </div>
      <div class="dim" id="registerError" style="min-height:18px;"></div>
      <div class="modal-actions">
        <button type="button" class="smallbtn" id="cancelRegister">Cancelar</button>
        <button type="submit" class="primary">Crear cuenta</button>
      </div>
    </form>
  </div>
</div>

<div id="leadModal" class="modal hidden" role="dialog" aria-modal="true">
  <div class="modal-content">
    <h3 id="leadModalTitle">Enviar propuesta</h3>
    <p class="dim">Tarifa seleccionada: <span class="highlight" id="leadTariffName"></span></p>
    <form id="leadForm" class="stacked">
      <input type="hidden" id="leadTariffId" />
      <div>
        <label class="label" for="clientName">Nombre del cliente</label>
        <input id="clientName" type="text" placeholder="Nombre y apellidos" required />
      </div>
      <div>
        <label class="label" for="clientContact">Datos de contacto</label>
        <input id="clientContact" type="text" placeholder="Teléfono, email..." required />
      </div>
      <div>
        <label class="label" for="clientNotes">Notas adicionales</label>
        <textarea id="clientNotes" placeholder="Observaciones o necesidades específicas"></textarea>
      </div>
      <div class="modal-actions">
        <button type="button" class="smallbtn" id="cancelLead">Cancelar</button>
        <button type="submit" class="primary">Enviar al administrador</button>
      </div>
    </form>
  </div>
</div>

<div id="requestModal" class="modal hidden" role="dialog" aria-modal="true">
  <div class="modal-content">
    <h3>Solicitar tarifa</h3>
    <p class="dim">Tarifa seleccionada: <span class="highlight" id="requestTariffName"></span></p>
    <p class="dim" style="margin-top:-4px;"><strong>Aviso:</strong> al rellenar este formulario se creará un perfil de cliente automáticamente.</p>
    <form id="requestForm" class="stacked">
      <input type="hidden" id="requestTariffId" />
      <div class="form-grid">
        <div>
          <label class="label" for="requestUsername">Usuario</label>
          <input id="requestUsername" type="text" autocomplete="username" required placeholder="Elige tu usuario" />
        </div>
        <div>
          <label class="label" for="requestPassword">Contraseña</label>
          <input id="requestPassword" type="password" autocomplete="new-password" required placeholder="Mínimo 6 caracteres" />
        </div>
        <div>
          <label class="label" for="requestEmail">Correo electrónico</label>
          <input id="requestEmail" type="email" autocomplete="email" required placeholder="tu@correo.com" />
        </div>
        <div>
          <label class="label" for="requestPhone">Teléfono de contacto</label>
          <input id="requestPhone" type="tel" autocomplete="tel" required placeholder="Número de teléfono" />
        </div>
        <div class="full">
          <label class="label" for="requestAddress">Dirección</label>
          <textarea id="requestAddress" required placeholder="Dirección completa"></textarea>
        </div>
      </div>
      <div class="dim" id="requestError" style="min-height:18px;"></div>
      <div class="modal-actions">
        <button type="button" class="smallbtn" id="cancelRequest">Cancelar</button>
        <button type="submit" class="primary">Solicitar tarifa</button>
      </div>
    </form>
  </div>
</div>

<div id="customBudgetModal" class="modal hidden" role="dialog" aria-modal="true">
  <div class="modal-content">
    <h3>Solicitar presupuesto a medida</h3>
    <p class="dim" style="margin-top:-4px;">Cuéntanos las necesidades del cliente para que el administrador prepare una oferta personalizada.</p>
    <form id="customBudgetForm" class="stacked">
      <div>
        <label class="label" for="customBudgetSummary">Resumen de necesidades</label>
        <textarea id="customBudgetSummary" required placeholder="Ej. Fibra 600 Mbps, 3 líneas ilimitadas, TV con Netflix"></textarea>
      </div>
      <div>
        <label class="label" for="customBudgetContact">Forma de contacto preferida</label>
        <input id="customBudgetContact" type="text" placeholder="Teléfono o email de contacto" />
      </div>
      <div class="modal-actions">
        <button type="button" class="smallbtn" id="cancelCustomBudget">Cancelar</button>
        <button type="submit" class="primary">Enviar solicitud</button>
      </div>
    </form>
  </div>
</div>

<div id="callRequestModal" class="modal hidden" role="dialog" aria-modal="true">
  <div class="modal-content">
    <h3>Solicitud de llamada</h3>
    <p class="dim" style="margin-top:-4px;">Déjanos tus datos y el administrador te devolverá la llamada lo antes posible.</p>
    <form id="callRequestForm" class="stacked">
      <div>
        <label class="label" for="callRequestName">Nombre completo</label>
        <input id="callRequestName" type="text" placeholder="Tu nombre" required />
      </div>
      <div>
        <label class="label" for="callRequestPhone">Teléfono de contacto</label>
        <input id="callRequestPhone" type="tel" placeholder="Número de teléfono" required />
      </div>
      <div>
        <label class="label" for="callRequestTime">Horario preferido</label>
        <input id="callRequestTime" type="text" placeholder="Ej. Tardes de 16h a 18h" />
      </div>
      <div>
        <label class="label" for="callRequestNotes">Notas adicionales</label>
        <textarea id="callRequestNotes" placeholder="Detalles adicionales o necesidades específicas"></textarea>
      </div>
      <div class="modal-actions">
        <button type="button" class="smallbtn" id="cancelCallRequest">Cancelar</button>
        <button type="submit" class="primary">Solicitar llamada</button>
      </div>
    </form>
  </div>
</div>

<div id="referralModal" class="modal hidden" role="dialog" aria-modal="true">
  <div class="modal-content">
    <h3>Invitar a un amigo</h3>
    <p class="dim">Completa los datos de tu amigo para que reciba su cuenta y elija la instalación deseada.</p>
    <form id="referralForm" class="stacked">
      <div class="form-grid">
        <div class="full">
          <label class="label" for="referralTariff">Producto a contratar</label>
          <select id="referralTariff" required></select>
        </div>
        <div>
          <label class="label" for="referralFriendName">Nombre y apellidos</label>
          <input id="referralFriendName" type="text" placeholder="Nombre completo" required />
        </div>
        <div>
          <label class="label" for="referralFriendUsername">Usuario</label>
          <input id="referralFriendUsername" type="text" autocomplete="username" required />
        </div>
        <div>
          <label class="label" for="referralFriendPassword">Contraseña</label>
          <input id="referralFriendPassword" type="password" autocomplete="new-password" required />
        </div>
        <div>
          <label class="label" for="referralFriendEmail">Correo electrónico</label>
          <input id="referralFriendEmail" type="email" autocomplete="email" required />
        </div>
        <div>
          <label class="label" for="referralFriendPhone">Teléfono</label>
          <input id="referralFriendPhone" type="tel" autocomplete="tel" required />
        </div>
        <div class="full">
          <label class="label" for="referralFriendAddress">Dirección</label>
          <textarea id="referralFriendAddress" placeholder="Dirección completa" required></textarea>
        </div>
        <div class="full">
          <label class="label" for="referralNotes">Notas para el administrador (opcional)</label>
          <textarea id="referralNotes" placeholder="Añade detalles útiles para la instalación"></textarea>
        </div>
      </div>
      <div class="dim" id="referralError" style="min-height:18px;"></div>
      <div class="modal-actions">
        <button type="button" class="smallbtn" id="cancelReferral">Cancelar</button>
        <button type="submit" class="primary">Enviar invitación</button>
      </div>
    </form>
  </div>
</div>

<div id="profilePanel" class="modal hidden" role="dialog" aria-modal="true">
  <div class="modal-content profile-modal">
    <h3>Mi perfil</h3>
    <p class="dim" style="margin-top:-4px;">Actualiza tus datos personales y de contacto. También puedes definir una nueva contraseña.</p>
    <form id="profileForm" class="stacked">
      <div class="form-grid">
        <div>
          <label class="label" for="profileFirstName">Nombre</label>
          <input id="profileFirstName" type="text" placeholder="Nombre" autocomplete="given-name" />
        </div>
        <div>
          <label class="label" for="profileLastName">Apellidos</label>
          <input id="profileLastName" type="text" placeholder="Apellidos" autocomplete="family-name" />
        </div>
        <div>
          <label class="label" for="profileEmail">Correo de notificaciones</label>
          <input id="profileEmail" type="email" placeholder="correo@empresa.com" autocomplete="email" />
        </div>
        <div>
          <label class="label" for="profileCompanyPhone">Teléfono de empresa</label>
          <input id="profileCompanyPhone" type="text" placeholder="Teléfono corporativo" autocomplete="tel" />
        </div>
        <div>
          <label class="label" for="profilePersonalPhone">Teléfono personal</label>
          <input id="profilePersonalPhone" type="text" placeholder="Teléfono personal" autocomplete="tel" />
        </div>
        <div>
          <label class="label" for="profilePhoto">Foto de perfil (URL)</label>
          <input id="profilePhoto" type="url" placeholder="https://..." autocomplete="url" />
        </div>
        <div class="full">
          <label class="label" for="profileAddress">Dirección</label>
          <textarea id="profileAddress" placeholder="Dirección completa"></textarea>
        </div>
      </div>
      <div class="form-grid">
        <div>
          <label class="label" for="profilePassword">Nueva contraseña</label>
          <input id="profilePassword" type="password" autocomplete="new-password" placeholder="Deja en blanco para mantenerla" />
        </div>
        <div>
          <label class="label" for="profilePasswordConfirm">Repite la contraseña</label>
          <input id="profilePasswordConfirm" type="password" autocomplete="new-password" placeholder="Confirma la nueva contraseña" />
        </div>
      </div>
      <div class="modal-actions" style="justify-content:flex-start; padding-top:4px;">
        <button type="submit" class="primary">Guardar cambios</button>
        <button type="button" class="smallbtn" id="closeProfile">Cerrar</button>
        <span class="dim" id="profileFormInfo"></span>
      </div>
    </form>
  </div>
</div>

<main class="wrap">
  <section id="aiPanel" class="card">
    <h2 class="section-title">Buscador inteligente de tarifas</h2>
    <p class="dim">Selecciona tus preferencias y generaremos propuestas ajustadas a la velocidad de fibra, líneas móviles y plataformas disponibles.</p>
    <form id="aiSearchForm" class="stacked ai-filter-form">
      <div class="ai-preferences">
        <div>
          <label class="label" for="aiFiberSpeed">Velocidad de fibra</label>
          <select id="aiFiberSpeed">
            <option value="">Cualquier velocidad</option>
          </select>
        </div>
        <div>
          <label class="label" for="aiMobilePreference">¿Incluye líneas móviles?</label>
          <select id="aiMobilePreference">
            <option value="no">Sin líneas móviles</option>
            <option value="yes">Sí, añadir líneas móviles</option>
          </select>
        </div>
        <div class="ai-lines-field hidden" id="aiLinesField">
          <label class="label" for="aiMobileLines">Número de líneas</label>
          <select id="aiMobileLines"></select>
        </div>
        <div>
          <label class="label" for="aiTvPreference">¿Quieres TV o plataformas?</label>
          <select id="aiTvPreference">
            <option value="no">Sin TV / plataformas</option>
            <option value="yes">Sí, incluir plataformas</option>
          </select>
        </div>
        <div class="ai-tv-field hidden" id="aiTvField">
          <label class="label" for="aiTvPlatform">Selecciona plataforma</label>
          <select id="aiTvPlatform">
            <option value="agiletv">Agile TV</option>
            <option value="netflix">Netflix</option>
            <option value="hbomax">HBO Max</option>
            <option value="disney+">Disney+</option>
            <option value="primevideo">Amazon Prime Video</option>
            <option value="dazn">DAZN</option>
            <option value="movistar+">Movistar Plus+</option>
          </select>
        </div>
      </div>
      <div class="inline-actions" style="justify-content:flex-end;">
        <button type="button" class="smallbtn" id="aiSearchClear">Limpiar</button>
        <button type="submit" class="primary">Buscar tarifas</button>
      </div>
    </form>
    <div id="aiResults" class="ai-results"></div>
  </section>

  <section id="authReminder" class="notice hidden">
    <div id="authNoticeBasic" class="hidden">
      <h2 class="section-title">Modo lectura</h2>
      <p>Has iniciado sesión como <span class="role-tag" data-role="basico">usuario básico</span>. Puedes consultar las tarifas disponibles, pero las acciones de edición y envío de ventas están deshabilitadas.</p>
    </div>
  </section>

  <section id="commercialPanel" class="card hidden">
    <h2 class="section-title">Mis oportunidades</h2>
    <p class="dim">Selecciona una tarifa y pulsa <strong>Enviar propuesta</strong> para remitir los datos del cliente al administrador.</p>
    <div id="commercialMetrics" class="hidden"></div>
    <div id="clientPlanSection" class="points-wrapper hidden">
      <div class="points-grid">
        <div class="points-card" id="clientPointsCard">
          <h3>Mi cartera de puntos</h3>
          <div class="balance" id="clientPointsBalance"><span>Saldo disponible</span>0</div>
          <p class="hint">Suma puntos contratando fibra, líneas móviles o invitando a tus amigos al plan.</p>
        </div>
        <div class="points-card secondary" id="clientReferralCard">
          <h3>Plan amigo FÍBARO</h3>
          <p class="hint">Invita a un amigo, cuando su instalación esté completada conseguirás el 50% de sus puntos.</p>
          <div class="actions">
            <button type="button" class="primary" id="openReferral">Invitar a un amigo</button>
          </div>
        </div>
      </div>
      <div>
        <div class="section-subtitle" style="margin:0 0 8px;">Recompensas disponibles</div>
        <div id="clientRewards" class="rewards-grid"></div>
      </div>
      <div id="clientPointsHistory" class="points-history hidden">
        <h3>Historial de puntos</h3>
        <ul id="clientPointsHistoryList"></ul>
      </div>
    </div>
    <div id="commercialNotifications" class="notice hidden"></div>
    <div id="commercialLeads" class="lead-list"></div>
  </section>

  <section id="teamPanel" class="card hidden">
    <h2 class="section-title">Equipo comercial</h2>
    <p class="dim">Consulta las ventas de las personas a tu cargo y haz seguimiento de su actividad.</p>
    <div id="teamSummary" class="kpis"></div>
    <div id="teamLeadList" class="lead-list"></div>
  </section>

  <section id="adminPanel" class="card hidden">
    <h2 class="section-title">Panel de administración</h2>
    <p class="dim">Organiza tus tareas por apartados para controlar las ventas, las tarifas disponibles y la base de usuarios.</p>
    <div id="adminTabs" class="admin-tabs">
      <button type="button" class="tab active" data-tab="sales">Ventas</button>
      <button type="button" class="tab" data-tab="tariffs">Tarifas</button>
      <button type="button" class="tab" data-tab="clients">Clientes directos</button>
      <button type="button" class="tab" data-tab="rewards">Recompensas</button>
      <button type="button" class="tab" data-tab="users">Usuarios</button>
    </div>

    <div id="adminSalesTab" class="admin-tab">
      <div class="section-subtitle" style="margin:0 0 12px;">Registro de ventas</div>
      <div class="flex-between">
        <p class="dim" style="margin:0;">Consulta y actualiza el estado de cada oportunidad.</p>
        <div style="display:flex; gap:8px; align-items:center;">
          <label class="label" for="leadFilter" style="margin:0;">Filtrar por comercial</label>
          <select id="leadFilter">
            <option value="">Todos</option>
          </select>
        </div>
      </div>
      <div id="leadSummary" class="kpis" style="margin-top:12px;"></div>
      <div id="leadList" class="lead-list" style="margin-top:12px;"></div>
      <div id="customBudgetSection" class="notice admin-subsection hidden">
        <h3 class="section-subtitle" style="margin:0;">Solicitudes de presupuestos a medida</h3>
        <div id="customBudgetList" class="lead-list" style="margin-top:12px;"></div>
      </div>
      <div id="callRequestSection" class="notice admin-subsection hidden">
        <h3 class="section-subtitle" style="margin:0;">Solicitudes de llamada</h3>
        <div id="callRequestList" class="lead-list" style="margin-top:12px;"></div>
      </div>
      <div class="admin-stats-toolbar">
        <div>
          <div class="section-subtitle" style="margin:0;">Control de comisiones por técnico</div>
          <p class="range-info" id="adminSalesRangeLabel">Datos del mes en curso</p>
        </div>
        <div class="range-switcher" id="adminSalesRangeControls">
          <span class="range-switcher-label">Periodo</span>
          <div class="range-switcher-buttons">
            <button type="button" data-range="day">Día</button>
            <button type="button" data-range="week">Semana</button>
            <button type="button" data-range="month" class="active">Mes</button>
            <button type="button" data-range="year">Año</button>
          </div>
        </div>
      </div>
      <div class="admin-stats-group">
        <div class="section-subtitle" style="margin:0;">Ranking de técnicos por comisión</div>
        <div id="adminSalesTotals" class="admin-sales-totals hidden" aria-live="polite"></div>
        <div id="adminSalesStats" class="stats-grid"></div>
      </div>
      <div class="admin-stats-group">
        <div class="section-subtitle" style="margin:0;">Ranking de clientes por puntos</div>
        <div id="adminClientStats" class="stats-grid"></div>
      </div>
    </div>

    <div id="adminTariffsTab" class="admin-tab hidden">
      <div class="section-subtitle">Gestión de tarifas</div>
      <form id="tarifaForm" class="stacked">
        <input type="hidden" id="tarifaId" />
        <div class="form-grid">
          <div>
            <label class="label" for="tarifaCodigo">Código</label>
            <input id="tarifaCodigo" type="text" required />
          </div>
          <div>
            <label class="label" for="tarifaNombre">Nombre</label>
            <input id="tarifaNombre" type="text" required />
          </div>
          <div>
            <label class="label" for="tarifaCompania">Compañía</label>
            <input id="tarifaCompania" type="text" required />
          </div>
          <div>
            <label class="label" for="tarifaTipo">Tipo de producto</label>
            <select id="tarifaTipo" required>
              <option value="C">C · Convergente (fibra + móvil)</option>
              <option value="F">F · Solo fibra</option>
              <option value="M">M · Móvil contrato</option>
              <option value="N">N · Móvil contrato número nuevo</option>
              <option value="P">P · Móvil prepago</option>
            </select>
          </div>
          <div>
            <label class="label" for="tarifaLineas">Líneas</label>
            <input id="tarifaLineas" type="number" min="0" step="1" />
          </div>
          <div>
            <label class="label" for="tarifaPrecio">Precio mensual</label>
            <input id="tarifaPrecio" type="number" step="0.01" min="0" required />
          </div>
          <div>
            <label class="label" for="tarifaMoneda">Moneda</label>
            <input id="tarifaMoneda" type="text" value="EUR" />
          </div>
          <div>
            <label class="label" for="tarifaPermanencia">Permanencia</label>
            <input id="tarifaPermanencia" type="text" placeholder="Sí/No/meses" />
          </div>
          <div>
            <label class="label" for="tarifaDesde">Vigente desde</label>
            <input id="tarifaDesde" type="date" />
          </div>
          <div>
            <label class="label" for="tarifaHasta">Vigente hasta</label>
            <input id="tarifaHasta" type="date" />
          </div>
          <div class="full">
            <label class="label" for="tarifaDescripcion">Descripción</label>
            <textarea id="tarifaDescripcion" placeholder="Detalle comercial de la tarifa"></textarea>
          </div>
          <div class="full">
            <label class="label" for="tarifaPlataformas">TV o plataformas incluidas</label>
            <input id="tarifaPlataformas" type="text" placeholder="Netflix, HBO Max, Agile TV…" />
            <p class="small-hint">Separa cada plataforma con comas para mostrarlas destacadas.</p>
          </div>
          <div>
            <label class="label" for="tarifaDestacada">Destacar tarifa</label>
            <div class="toggle-field">
              <input id="tarifaDestacada" type="checkbox" />
              <label for="tarifaDestacada" class="dim">Colócala arriba en el panel público como opción destacada.</label>
            </div>
          </div>
        </div>
        <div class="modal-actions" style="justify-content:flex-start; padding-top:4px;">
          <button type="submit" class="primary" id="guardarTarifa">Guardar tarifa</button>
          <button type="button" class="smallbtn" id="cancelarEdicion">Cancelar</button>
          <span class="dim" id="tarifaFormInfo"></span>
        </div>
      </form>
      <div class="tariff-admin-controls">
        <div id="adminTariffCompanyTabs" class="tariff-admin-tabs"></div>
        <div id="adminTariffTypeFilters" class="tariff-type-buttons"></div>
      </div>
      <div id="tarifaList"></div>
    </div>

    <div id="adminClientsTab" class="admin-tab hidden">
      <div id="directClientSection" class="notice hidden">
        <h3 class="section-subtitle" style="margin-top:0;">Solicitudes de clientes directos</h3>
        <p class="dim" id="directClientEmpty">Cuando un cliente registrado solicite una tarifa aparecerá aquí para su revisión.</p>
        <div id="directClientList" class="lead-list"></div>
      </div>
    </div>

    <div id="adminRewardsTab" class="admin-tab hidden">
      <div class="section-subtitle" style="margin:0 0 12px;">Plan de recompensas</div>
      <p class="dim" style="margin-top:0;">Crea productos canjeables por puntos para motivar a los clientes del plan amigo.</p>
      <form id="rewardForm" class="stacked">
        <input type="hidden" id="rewardId" />
        <div class="form-grid">
          <div>
            <label class="label" for="rewardTitle">Nombre de la recompensa</label>
            <input id="rewardTitle" type="text" placeholder="Ej. Router WiFi 6 premium" required />
          </div>
          <div>
            <label class="label" for="rewardPoints">Coste en puntos</label>
            <input id="rewardPoints" type="number" min="1" step="1" required />
          </div>
          <div>
            <label class="label" for="rewardUnits">Unidades en stock</label>
            <input id="rewardUnits" type="number" min="0" step="1" placeholder="Ej. 100" />
            <p class="dim" style="margin-top:6px;">Deja vacío si no hay límite de unidades.</p>
          </div>
          <div>
            <label class="label" for="rewardValidFrom">Disponible desde</label>
            <input id="rewardValidFrom" type="date" />
          </div>
          <div>
            <label class="label" for="rewardValidUntil">Disponible hasta</label>
            <input id="rewardValidUntil" type="date" />
          </div>
          <div class="full">
            <label class="label" for="rewardImage">Imagen destacada</label>
            <input id="rewardImage" type="text" placeholder="https://..." />
            <div id="rewardImageDropzone" class="upload-dropzone" tabindex="0">
              <input id="rewardImageFile" type="file" accept="image/*" />
              <div class="upload-placeholder">
                <strong>Arrastra una imagen aquí</strong>
                <span>O haz clic para seleccionar un archivo desde tu equipo. También puedes pegar una URL en el campo superior.</span>
              </div>
              <img id="rewardImagePreview" class="hidden" alt="Vista previa de la imagen de la recompensa" />
            </div>
            <div class="upload-actions hidden" id="rewardImageActions">
              <button type="button" class="smallbtn hidden" id="rewardImageClear">Quitar imagen</button>
            </div>
            <p class="dim" style="margin-top:6px;">Puedes usar una URL o subir una imagen arrastrándola sobre el recuadro.</p>
          </div>
          <div class="full">
            <label class="label" for="rewardDescription">Descripción</label>
            <textarea id="rewardDescription" placeholder="Detalla la recompensa y cómo se entregará."></textarea>
          </div>
        </div>
        <div class="modal-actions" style="justify-content:flex-start; padding-top:4px;">
          <button type="submit" class="primary" id="saveReward">Guardar recompensa</button>
          <button type="button" class="smallbtn" id="cancelRewardEdit">Cancelar</button>
          <span class="dim" id="rewardFormInfo"></span>
        </div>
      </form>
      <div id="rewardList" class="rewards-grid"></div>
    </div>

    <div id="adminUsersTab" class="admin-tab hidden">
      <div class="section-subtitle" style="margin:0 0 8px;">Gestión de usuarios</div>
      <form id="userForm" class="stacked gap-sm">
        <div class="form-grid">
          <div>
            <label class="label" for="userUsername">Usuario</label>
            <input id="userUsername" type="text" placeholder="Identificador único" autocomplete="off" required />
          </div>
          <div>
            <label class="label" for="userPassword">Contraseña</label>
            <input id="userPassword" type="password" placeholder="Obligatoria al crear" autocomplete="new-password" />
          </div>
          <div>
            <label class="label" for="userRole">Rol</label>
            <select id="userRole">
              <option value="basico">Básico</option>
              <option value="comercial">Comercial</option>
              <option value="cliente">Cliente</option>
              <option value="lider">Responsable de equipo</option>
              <option value="admin">Administrador</option>
            </select>
          </div>
          <div>
            <label class="label" for="userEmail">Correo de notificaciones</label>
            <input id="userEmail" type="email" placeholder="correo@empresa.com" />
          </div>
          <div>
            <label class="label" for="userFirstName">Nombre</label>
            <input id="userFirstName" type="text" placeholder="Nombre" />
          </div>
          <div>
            <label class="label" for="userLastName">Apellidos</label>
            <input id="userLastName" type="text" placeholder="Apellidos" />
          </div>
        </div>
        <div class="form-grid">
          <div>
            <label class="label" for="userCompanyPhone">Teléfono de empresa</label>
            <input id="userCompanyPhone" type="text" placeholder="Teléfono corporativo" />
          </div>
          <div>
            <label class="label" for="userPersonalPhone">Teléfono personal</label>
            <input id="userPersonalPhone" type="text" placeholder="Teléfono personal" />
          </div>
          <div>
            <label class="label" for="userPhoto">Foto de perfil (URL)</label>
            <input id="userPhoto" type="url" placeholder="https://..." />
          </div>
          <div class="full">
            <label class="label" for="userAddress">Dirección</label>
            <textarea id="userAddress" placeholder="Dirección completa"></textarea>
          </div>
          <div class="full hidden" id="managedUsersField">
            <label class="label" for="userManagedUsers">Equipo a cargo</label>
            <select id="userManagedUsers" class="multi-select" multiple></select>
            <p class="dim" style="margin:6px 0 0;">Selecciona los usuarios que formarán parte del equipo comercial de este responsable.</p>
          </div>
        </div>
        <div class="modal-actions" style="justify-content:flex-start; padding-top:4px;">
          <button type="submit" class="primary" id="saveUserBtn">Crear usuario</button>
          <button type="button" class="smallbtn" id="cancelUserEdit">Cancelar</button>
          <span class="dim" id="userFormInfo"></span>
        </div>
      </form>
      <div class="toolbar" id="userFilterBar">
        <div>
          <label class="label" for="userRoleFilter">Filtrar por tipo de usuario</label>
          <select id="userRoleFilter">
            <option value="all">Todos los usuarios</option>
            <option value="lider">Responsables de equipo</option>
            <option value="comercial">Comerciales</option>
            <option value="direct-client">Clientes directos</option>
            <option value="cliente">Clientes gestionados</option>
            <option value="admin">Administradores</option>
            <option value="basico">Usuarios básicos</option>
          </select>
        </div>
      </div>
      <div id="userList"></div>
    </div>
  </section>

  <div class="grid" id="grid"></div>
  <p class="footer">Hecho con cariño en tonos <strong>azul</strong>, <strong>negro</strong> y <strong>blanco</strong>. Datos de tarifas embebidos – no requiere conexión.</p>
</main>

<div class="floating-actions">
  <button class="call-request-button" id="callRequestButton" type="button" aria-label="Solicitar llamada">
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 5a2 2 0 0 1 2-2h2.1a1 1 0 0 1 .97.757l1.03 4.123a1 1 0 0 1-.516 1.12l-1.79.895a12.05 12.05 0 0 0 5.41 5.41l.896-1.79a1 1 0 0 1 1.119-.516l4.124 1.03a1 1 0 0 1 .757.97V19a2 2 0 0 1-2 2h-1c-8.284 0-15-6.716-15-15V5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
  </button>
  <a class="whatsapp" href="https://wa.me/34633671657" target="_blank" rel="noreferrer noopener" aria-label="Abrir conversación de WhatsApp">
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 20.5 5.5 16A7.5 7.5 0 1 1 12 19.5a7.4 7.4 0 0 1-3.5-.9L4 20.5z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/><path d="M9.5 9.75c0 1.95 1.8 3.75 3.75 3.75" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
  </a>
  <a class="instagram" href="https://www.instagram.com/fibaroteleco" target="_blank" rel="noreferrer noopener" aria-label="Ir a Instagram">
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="18" height="18" rx="5" stroke="currentColor" stroke-width="2"/><path d="M16 11.37A3.37 3.37 0 1 1 12.63 8 3.37 3.37 0 0 1 16 11.37z" stroke="currentColor" stroke-width="2"/><circle cx="17.5" cy="6.5" r="1.5" fill="currentColor"/></svg>
  </a>
</div>

<script src="./firebase-config.js"></script>
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
import { getFirestore, doc, getDoc, onSnapshot, serverTimestamp, setDoc } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

const BASE_DATA = [{"codigo": "P-0001", "nombre": "CONVERGENTE  2 LINEAS ", "precio": 12.5, "compañia": "mm", "familia": "LA MÁS BARATA", "moneda": "EUR", "permanencia": "no", "descripción": "FIBRA 300 Y 2 LINEAS CON LLAMADAS ILIMITADAS Y 50 GI COMPARTIDOS", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 2}, {"codigo": "P-0002", "nombre": "CONVERGENTE  2 LINEAS ", "precio": 99.9, "compañia": "pp", "familia": "LA MÁS BARATA", "moneda": "EUR", "permanencia": "12 meses", "descripción": "qwe", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 2}, {"codigo": "P-0003", "nombre": "CONVERGENTE  2 LINEAS ", "precio": 78.0, "compañia": "simyo", "familia": "LA MÁS BARATA", "moneda": "EUR", "permanencia": "3 meses", "descripción": "zxc", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 2}, {"codigo": "P-0004", "nombre": "CONVERGENTE  2 LINEAS ", "precio": 258.0, "compañia": "jazztel", "familia": "LA MÁS BARATA", "moneda": "EUR", "permanencia": "6 meses", "descripción": "rty", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 2}, {"codigo": "P-0005", "nombre": "CONVERGENTE  3 LINEAS ", "precio": 46.0, "compañia": "mm", "familia": "LA MÁS BARATA", "moneda": "EUR", "permanencia": "9 meses", "descripción": "fgh", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 3}, {"codigo": "P-0006", "nombre": "CONVERGENTE  3 LINEAS ", "precio": 21.0, "compañia": "pp", "familia": "LA MÁS BARATA", "moneda": "EUR", "permanencia": "no", "descripción": "cvb", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 3}, {"codigo": "P-0007", "nombre": "CONVERGENTE  3 LINEAS ", "precio": 12.0, "compañia": "simyo", "familia": "LA MÁS BARATA", "moneda": "EUR", "permanencia": "12 meses", "descripción": "tyu", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 3}, {"codigo": "P-0008", "nombre": "CONVERGENTE  3 LINEAS ", "precio": 45.0, "compañia": "jazztel", "familia": "LA MÁS BARATA", "moneda": "EUR", "permanencia": "3 meses", "descripción": "yhn", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 3}, {"codigo": "P-0009", "nombre": "CONVERGENTE  4 LINEAS ", "precio": 14.0, "compañia": "mm", "familia": "LA MÁS BARATA", "moneda": "EUR", "permanencia": "6 meses", "descripción": "fvb", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 4}, {"codigo": "P-0010", "nombre": "CONVERGENTE  4 LINEAS ", "precio": 13.0, "compañia": "pp", "familia": "LA MÁS BARATA", "moneda": "EUR", "permanencia": "9 meses", "descripción": "uik", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 4}, {"codigo": "P-0011", "nombre": "CONVERGENTE  4 LINEAS ", "precio": 78.0, "compañia": "simyo", "familia": "LA MÁS BARATA", "moneda": "EUR", "permanencia": "no", "descripción": "yhn", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 4}, {"codigo": "P-0012", "nombre": "CONVERGENTE  4 LINEAS ", "precio": 57.0, "compañia": "jazztel", "familia": "LA MÁS BARATA", "moneda": "EUR", "permanencia": "12 meses", "descripción": "pñl", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 4}, {"codigo": "P-0013", "nombre": "CONVERGENTE  2 LINEAS ", "precio": 912.5, "compañia": "mm", "familia": "MEDIA", "moneda": "EUR", "permanencia": "3 meses", "descripción": "R45", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 2}, {"codigo": "P-0014", "nombre": "CONVERGENTE  2 LINEAS ", "precio": 999.9, "compañia": "pp", "familia": "MEDIA", "moneda": "EUR", "permanencia": "6 meses", "descripción": "RF43", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 2}, {"codigo": "P-0015", "nombre": "CONVERGENTE  2 LINEAS ", "precio": 978.0, "compañia": "simyo", "familia": "MEDIA", "moneda": "EUR", "permanencia": "9 meses", "descripción": "F34F", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 2}, {"codigo": "P-0016", "nombre": "CONVERGENTE  2 LINEAS ", "precio": 958.0, "compañia": "jazztel", "familia": "MEDIA", "moneda": "EUR", "permanencia": "no", "descripción": "34F45", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 2}, {"codigo": "P-0017", "nombre": "CONVERGENTE  3 LINEAS ", "precio": 946.0, "compañia": "mm", "familia": "MEDIA", "moneda": "EUR", "permanencia": "12 meses", "descripción": "34F43", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 3}, {"codigo": "P-0018", "nombre": "CONVERGENTE  3 LINEAS ", "precio": 921.0, "compañia": "pp", "familia": "MEDIA", "moneda": "EUR", "permanencia": "3 meses", "descripción": "F3RF", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 3}, {"codigo": "P-0019", "nombre": "CONVERGENTE  3 LINEAS ", "precio": 997.0, "compañia": "simyo", "familia": "PREMIUM", "moneda": "EUR", "permanencia": "6 meses", "descripción": "656H", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 3}, {"codigo": "P-0020", "nombre": "CONVERGENTE  3 LINEAS ", "precio": 5745.0, "compañia": "jazztel", "familia": "PREMIUM", "moneda": "EUR", "permanencia": "9 meses", "descripción": "H768", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 3}, {"codigo": "P-0021", "nombre": "CONVERGENTE  4 LINEAS ", "precio": 6745.0, "compañia": "mm", "familia": "PREMIUM", "moneda": "EUR", "permanencia": "no", "descripción": "5G34G", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 4}, {"codigo": "P-0022", "nombre": "CONVERGENTE  4 LINEAS ", "precio": 5868.0, "compañia": "pp", "familia": "PREMIUM", "moneda": "EUR", "permanencia": "12 meses", "descripción": "F3RT", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 4}, {"codigo": "P-0023", "nombre": "CONVERGENTE  4 LINEAS ", "precio": 9999.0, "compañia": "simyo", "familia": "PREMIUM", "moneda": "EUR", "permanencia": "3 meses", "descripción": "F324TG6", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 4}, {"codigo": "P-0024", "nombre": "CONVERGENTE  4 LINEAS ", "precio": 3858.0, "compañia": "jazztel", "familia": "PREMIUM", "moneda": "EUR", "permanencia": "6 meses", "descripción": "EF5655", "vigente_desde": "2025-01-01", "vigente_hasta": "2025-12-31", "lineas": 4}];

const STORAGE_KEYS = {
  tariffs: 'panel.tarifas.v1',
  leads: 'panel.leads.v1',
  rewards: 'panel.recompensas.v1',
  notifications: 'panel.notificaciones.v1',
  callRequests: 'panel.llamadas.v1',
  customBudgets: 'panel.presupuestos.v1',
  session: 'panel.session.v2',
  users: 'panel.usuarios.v1'
};

const REWARD_LOW_STOCK_THRESHOLD = 15;

const DEFAULT_USERS = [
  {
    username: 'admin',
    password: 'admin123',
    role: 'admin',
    firstName: 'Alicia',
    lastName: 'Admin',
    email: 'admin@fibaro.es'
  },
  {
    username: 'sofia',
    password: 'comercial123',
    role: 'comercial',
    firstName: 'Sofía',
    lastName: 'Comercial',
    email: 'sofia@fibaro.es'
  },
  {
    username: 'ana',
    password: 'basico123',
    role: 'basico',
    firstName: 'Ana',
    lastName: 'Lectora',
    email: 'ana@fibaro.es'
  }
];

const ROLE_LABELS = { admin: 'Administrador', comercial: 'Comercial', basico: 'Básico', lider: 'Responsable de equipo', cliente: 'Cliente' };
const CLIENT_ROLE = 'cliente';
const TARIFF_TYPE_LABELS = {
  C: 'Fibra y móvil',
  F: 'Solo fibra',
  M: 'Móvil contrato',
  N: 'Móvil número nuevo',
  P: 'Móvil prepago'
};
const TARIFF_TYPE_ORDER = ['C', 'F', 'M', 'N', 'P'];

const KNOWN_TV_PLATFORMS = [
  { id: 'agiletv', label: 'Agile TV', pattern: /agile\s*tv/i },
  { id: 'netflix', label: 'Netflix', pattern: /netflix/i },
  { id: 'hbomax', label: 'HBO Max', pattern: /(hbo\s*max|hbomax)/i },
  { id: 'disneyplus', label: 'Disney+', pattern: /disney\s*\+|disney\s*plus/i },
  { id: 'primevideo', label: 'Amazon Prime Video', pattern: /prime\s*video|amazon\s*prime/i },
  { id: 'dazn', label: 'DAZN', pattern: /dazn/i },
  { id: 'movistarplus', label: 'Movistar Plus+', pattern: /movistar\s*\+|movistar\s*plus/i }
];

// Configuración de bonos por packs (productos con código que comienza por "C")
const KPI_THRESHOLDS = [
  { sales: 3, bonus: 30 },
  { sales: 5, bonus: 100 },
  { sales: 8, bonus: 200 },
  { sales: 10, bonus: 300 }
];

// Comisión fija por cada tipo de producto vendido
const COMMISSION_RATES = {
  fiber: 30,
  mobile: 10
};

const KPI_HISTORY_MONTHS = 3;

const REMOTE_TARGET = window.FIREBASE_DATA_DOCUMENT || { collection: 'app', document: 'state' };

const remoteState = {
  enabled: Boolean(window.FIREBASE_CONFIG && window.FIREBASE_CONFIG.projectId),
  ready: false,
  writing: false,
  pending: false,
  unsub: null,
  lastError: null,
  data: null
};

let firebaseAppInstance = null;
let firestoreDb = null;
let remoteDocRef = null;
let remoteSyncTimer = null;
let remoteDataArrived = false;

let domReady = false;
let syncStatusEl = null;
let syncStatus = {
  state: remoteState.enabled ? 'connecting' : 'offline',
  message: remoteState.enabled ? 'Sincronizando…' : 'Modo offline'
};

function setSyncStatus(state, message) {
  syncStatus = { state, message };
  if (domReady) renderSyncStatus();
}

function renderSyncStatus() {
  if (!domReady) return;
  if (!syncStatusEl) syncStatusEl = document.querySelector('#syncStatus');
  if (!syncStatusEl) return;
  const mapping = {
    offline: { className: 'tag-warning', label: 'Modo offline' },
    connecting: { className: 'tag-warning', label: 'Conectando…' },
    syncing: { className: 'tag-warning', label: 'Guardando…' },
    online: { className: 'tag-success', label: 'Sincronizado' },
    error: { className: 'tag-error', label: 'Error de sincronización' }
  };
  const entry = mapping[syncStatus.state] || mapping.offline;
  syncStatusEl.classList.remove('tag-warning', 'tag-success', 'tag-error');
  syncStatusEl.classList.add(entry.className);
  syncStatusEl.textContent = syncStatus.message || entry.label;
}

function scheduleRemoteSync() {
  if (!remoteState.enabled) return;
  remoteState.pending = true;
  if (!remoteDocRef) {
    return;
  }
  if (remoteSyncTimer) clearTimeout(remoteSyncTimer);
  remoteSyncTimer = setTimeout(commitRemoteSync, 200);
  setSyncStatus('syncing', 'Guardando…');
}

async function commitRemoteSync() {
  if (!remoteState.enabled || !remoteDocRef) return;
  remoteSyncTimer = null;
  remoteState.pending = false;
  remoteState.writing = true;
  setSyncStatus('syncing', 'Guardando…');
  try {
    await setDoc(remoteDocRef, {
      users,
      tariffs,
      leads,
      rewards,
      updatedAt: serverTimestamp()
    }, { merge: true });
    remoteState.lastError = null;
  } catch (error) {
    remoteState.lastError = error;
    console.error('No se pudo sincronizar con Firestore', error);
    setSyncStatus('error', 'Error al guardar');
  } finally {
    remoteState.writing = false;
    if (!remoteState.lastError) {
      setSyncStatus('online', 'Sincronizado');
    }
  }
}

function flushRemoteQueue() {
  if (!remoteState.enabled || !remoteDocRef) return;
  if (!remoteState.pending) return;
  if (remoteSyncTimer) clearTimeout(remoteSyncTimer);
  remoteSyncTimer = setTimeout(commitRemoteSync, 50);
}

function applyRemoteData(data) {
  remoteDataArrived = true;
  remoteState.data = data || {};
  if (Array.isArray(remoteState.data.users)) {
    const list = remoteState.data.users.map(normaliseUser).filter(Boolean);
    cleanManagedUsers(list);
    users = list;
    try {
      localStorage.setItem(STORAGE_KEYS.users, JSON.stringify(users));
    } catch (error) {
      console.warn('No se pudieron sincronizar usuarios en localStorage', error);
    }
    if (currentUser) {
      const updated = getUserByUsername(currentUser.username);
      if (updated) {
        setCurrentUser(buildUserSnapshot(updated), { persist: false });
      } else {
        logout();
      }
    }
  }
  if (Array.isArray(remoteState.data.tariffs)) {
    tariffs = remoteState.data.tariffs.map(normaliseTariff);
    try {
      localStorage.setItem(STORAGE_KEYS.tariffs, JSON.stringify(tariffs));
    } catch (error) {
      console.warn('No se pudieron sincronizar tarifas en localStorage', error);
    }
  }
  if (Array.isArray(remoteState.data.leads)) {
    leads = remoteState.data.leads.map(normaliseLead).filter(Boolean);
    try {
      localStorage.setItem(STORAGE_KEYS.leads, JSON.stringify(leads));
    } catch (error) {
      console.warn('No se pudieron sincronizar leads en localStorage', error);
    }
  }
  if (Array.isArray(remoteState.data.rewards)) {
    rewards = remoteState.data.rewards.map(normaliseReward).filter(Boolean);
    try {
      localStorage.setItem(STORAGE_KEYS.rewards, JSON.stringify(rewards));
    } catch (error) {
      console.warn('No se pudieron sincronizar recompensas en localStorage', error);
    }
  }
  if (domReady) {
    renderEverythingAfterDataChange({ refreshFilters: true, refreshAi: Boolean(aiLastQuery) });
  }
}

const $ = (sel, ctx = document) => ctx.querySelector(sel);
const $$ = (sel, ctx = document) => Array.from(ctx.querySelectorAll(sel));
const uniq = (arr) => Array.from(new Set(arr.filter(x => x !== null && x !== undefined && x !== '')))
  .sort((a, b) => ('' + a).localeCompare('' + b, 'es', { numeric: true }));

function escapeHtml(value) {
  return String(value ?? '').replace(/[&<>"']/g, match => {
    switch (match) {
      case '&': return '&amp;';
      case '<': return '&lt;';
      case '>': return '&gt;';
      case '"': return '&quot;';
      case "'": return '&#39;';
      default: return match;
    }
  });
}

function normalisePointsMovement(raw) {
  if (!raw) return null;
  const amount = Number(raw.amount ?? raw.points ?? raw.puntos ?? 0);
  if (!Number.isFinite(amount) || amount === 0) return null;
  const concept = (raw.concept || raw.concepto || raw.descripcion || raw.description || '').trim();
  const relatedId = (raw.relatedId || raw.related || raw.leadId || '').toString();
  const createdAt = raw.createdAt || raw.created_at || new Date().toISOString();
  const type = raw.type === 'spent' || amount < 0 ? 'spent' : 'earned';
  return {
    id: raw.id || createId('pts'),
    amount: Math.round(amount),
    concept,
    relatedId,
    type,
    createdAt
  };
}

let users = [];
let grid,
  countEl,
  authReminder,
  authNoticeAnonymous,
  authNoticeBasic,
  adminPanel,
  commercialPanel,
  userInfo,
  loginModal,
  loginForm,
  loginError,
  loginUserInput,
  loginPassInput,
  registerModal,
  registerForm,
  registerError,
  registerUserInput,
  registerPassInput,
  registerPassConfirmInput,
  registerFirstNameInput,
  registerLastNameInput,
  registerEmailInput,
  leadModal,
  leadForm,
  leadTariffName,
  leadTariffIdInput,
  requestModal,
  requestForm,
  requestTariffName,
  requestTariffIdInput,
  requestUsernameInput,
  requestPasswordInput,
  requestEmailInput,
  requestPhoneInput,
  requestAddressInput,
  requestError,
  commercialNotifications,
  commercialLeads,
  commercialMetrics,
  clientPlanSection,
  clientPointsBalance,
  clientRewardsContainer,
  clientPointsHistory,
  clientPointsHistoryList,
  referralModal,
  referralForm,
  referralTariffSelect,
  referralFriendNameInput,
  referralFriendUsernameInput,
  referralFriendPasswordInput,
  referralFriendEmailInput,
  referralFriendPhoneInput,
  referralFriendAddressInput,
  referralNotesInput,
  referralError,
  leadSummary,
  leadList,
  leadFilter,
  directClientSection,
  directClientList,
  directClientEmpty,
  customBudgetSection,
  customBudgetList,
  callRequestSection,
  callRequestList,
  adminSalesTotals,
  adminSalesStats,
  adminClientStats,
  adminSalesRangeControls,
  adminSalesRangeLabel,
  adminTabs,
  adminSalesTab,
  adminTariffsTab,
  adminClientsTab,
  adminRewardsTab,
  adminUsersTab,
  tarifaList,
  tarifaForm,
  tarifaFormInfo,
  guardarTarifaBtn,
  cancelarEdicionBtn,
  tarifaCodigo,
  tarifaNombre,
  tarifaCompania,
  tarifaTipo,
  tarifaLineas,
  tarifaPrecio,
  tarifaMoneda,
  tarifaPermanencia,
  tarifaDesde,
  tarifaHasta,
  tarifaDescripcion,
  tarifaPlataformasInput,
  tarifaDestacadaInput,
  adminTariffTabsContainer,
  adminTariffTypeContainer,
  rewardForm,
  rewardFormInfo,
  rewardIdInput,
  rewardTitleInput,
  rewardPointsInput,
  rewardUnitsInput,
  rewardValidFromInput,
  rewardValidUntilInput,
  rewardImageInput,
  rewardImageDropzone,
  rewardImageFileInput,
  rewardImagePreview,
  rewardImageClearBtn,
  rewardImageActions,
  rewardDescriptionInput,
  rewardList,
  clientNameInput,
  clientContactInput,
  clientNotesInput,
  aiPanel,
  aiForm,
  aiFiberSelect,
  aiMobilePreferenceSelect,
  aiMobileLinesSelect,
  aiTvPreferenceSelect,
  aiTvPlatformSelect,
  aiLinesField,
  aiTvField,
  aiResults,
  aiClearBtn,
  customBudgetModal,
  customBudgetForm,
  customBudgetSummaryInput,
  customBudgetContactInput,
  callRequestModal,
  callRequestForm,
  callRequestNameInput,
  callRequestPhoneInput,
  callRequestTimeInput,
  callRequestNotesInput,
  customBudgetButton,
  notificationButton,
  notificationDropdown,
  notificationList,
  notificationDot,
  markNotificationsReadBtn,
  closeNotificationsBtn,
  callRequestButton,
  profilePanel,
  profileForm,
  profileFormInfo,
  profileFirstName,
  profileLastName,
  profileEmail,
  profileCompanyPhone,
  profilePersonalPhone,
  profilePhoto,
  profileAddress,
  profilePassword,
  profilePasswordConfirm,
  closeProfileBtn,
  teamPanel,
  teamSummary,
  teamLeadList,
  userForm,
  userFormInfo,
  userUsername,
  userPassword,
  userRole,
  userEmail,
  userFirstName,
  userLastName,
  userCompanyPhone,
  userPersonalPhone,
  userPhoto,
  userAddress,
  userManagedUsers,
  managedUsersField,
  userRoleFilter,
  userListContainer,
  saveUserBtn,
  cancelUserEdit;

let currentUser = null;
let tariffs = [];
let leads = [];
let rewards = [];
let notifications = [];
let callRequests = [];
let customBudgets = [];
let editingTariffId = null;
let editingUser = null;
let commercialNoticeTimeout = null;
let aiLastQuery = null;
let adminActiveTab = 'sales';
let adminSalesRange = 'month';
let adminTabButtons = [];
let adminTabPanels = {};
let adminTariffCompanyFilter = 'all';
let adminTariffTypeFilter = 'all';
let clientTariffTab = 'destacadas';
let pendingTariffScrollTarget = '';
let lastRenderedTariffs = [];
let notificationsOpen = false;

function renderEverythingAfterDataChange({ refreshAi = false } = {}) {
  if (!domReady) return;
  updateAvailableUsersHint();
  renderUserList();
  aplicarFiltros();
  renderTariffTable();
  populateReferralTariffs();
  renderLeadSummary();
  renderAdminLeadList();
  renderAdminRewards();
  renderCustomBudgetInbox();
  renderCallRequestInbox();
  renderCommercialPanel();
  renderTeamPanel();
  renderNotifications();
  populateAiFiberOptions();
  if (refreshAi && aiLastQuery) {
    runAiSearch(aiLastQuery, { preserveFormState: true });
  }
}

function todayISO() {
  return new Date().toISOString().slice(0, 10);
}

function createId(prefix = 'id') {
  return `${prefix}-${Math.random().toString(36).slice(2, 8)}-${Date.now().toString(36)}`;
}

function parseDate(value) {
  if (!value) return null;
  const date = new Date(value);
  return Number.isNaN(date.getTime()) ? null : date;
}

function startOfMonth(date) {
  return new Date(date.getFullYear(), date.getMonth(), 1);
}

function startOfDay(date) {
  return new Date(date.getFullYear(), date.getMonth(), date.getDate());
}

function endOfDay(date) {
  return new Date(date.getFullYear(), date.getMonth(), date.getDate(), 23, 59, 59, 999);
}

function startOfWeek(date) {
  const base = startOfDay(date);
  const day = base.getDay();
  const diff = (day + 6) % 7;
  base.setDate(base.getDate() - diff);
  return base;
}

function startOfYear(date) {
  return new Date(date.getFullYear(), 0, 1);
}

function monthKeyFromDate(date) {
  return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
}

function monthLabel(date) {
  try {
    return date.toLocaleDateString('es-ES', { month: 'short', year: 'numeric' });
  } catch (error) {
    return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
  }
}

function formatDateES(date, options = { day: '2-digit', month: 'short', year: 'numeric' }) {
  try {
    return date.toLocaleDateString('es-ES', options);
  } catch (error) {
    if (options?.month) {
      return `${String(date.getDate()).padStart(2, '0')}/${String(date.getMonth() + 1).padStart(2, '0')}/${date.getFullYear()}`;
    }
    return date.toISOString().slice(0, 10);
  }
}

function describeRangeLabel(rangeKey, start, end) {
  if (rangeKey === 'day') {
    return `Datos de hoy (${formatDateES(start)})`;
  }
  if (rangeKey === 'week') {
    const startLabel = formatDateES(start, { day: '2-digit', month: 'short' });
    const endLabel = formatDateES(end, { day: '2-digit', month: 'short', year: 'numeric' });
    return `Datos de la semana (${startLabel} – ${endLabel})`;
  }
  if (rangeKey === 'year') {
    return `Datos del ${start.getFullYear()}`;
  }
  const monthText = formatDateES(start, { month: 'long', year: 'numeric' });
  return `Datos del mes (${monthText})`;
}

function getTimeframeRange(rangeKey) {
  const now = new Date();
  const end = endOfDay(now);
  let start;
  switch (rangeKey) {
    case 'day':
      start = startOfDay(now);
      break;
    case 'week':
      start = startOfWeek(now);
      break;
    case 'year':
      start = startOfYear(now);
      break;
    case 'month':
    default:
      start = startOfMonth(now);
      break;
  }
  return { start, end, label: describeRangeLabel(rangeKey, start, end) };
}

function normaliseUser(raw) {
  if (!raw) return null;
  const username = (raw.username || '').trim().toLowerCase();
  if (!username) return null;
  let firstName = (raw.firstName || '').trim();
  let lastName = (raw.lastName || '').trim();
  if (!firstName && !lastName && raw.name) {
    const pieces = String(raw.name).trim().split(/\s+/);
    firstName = pieces.shift() || '';
    lastName = pieces.join(' ');
  }
  const managedUsers = Array.isArray(raw.managedUsers)
    ? uniq(raw.managedUsers.map(u => (u || '').trim().toLowerCase()))
    : [];
  const pointsHistory = Array.isArray(raw.pointsHistory)
    ? raw.pointsHistory.map(normalisePointsMovement).filter(Boolean)
    : [];
  let pointsBalance = Number(raw.pointsBalance ?? raw.puntos ?? 0);
  if (!Number.isFinite(pointsBalance)) pointsBalance = 0;
  pointsBalance = Math.round(pointsBalance);
  if (!pointsBalance && pointsHistory.length) {
    pointsBalance = pointsHistory.reduce((acc, entry) => acc + entry.amount, 0);
  }
  const referrals = Array.isArray(raw.referrals)
    ? uniq(raw.referrals.map(u => (u || '').trim().toLowerCase()))
    : [];
  const referredBy = (raw.referredBy || raw.referidoPor || '').trim().toLowerCase();
  return {
    username,
    password: raw.password || '',
    role: raw.role || 'basico',
    firstName,
    lastName,
    email: (raw.email || '').trim(),
    companyPhone: (raw.companyPhone || '').trim(),
    personalPhone: (raw.personalPhone || '').trim(),
    address: (raw.address || '').trim(),
    photo: (raw.photo || '').trim(),
    selfRegistered: Boolean(raw.selfRegistered),
    managedUsers: managedUsers.filter(value => value && value !== username),
    pointsBalance,
    pointsHistory,
    referrals,
    referredBy
  };
}

function cleanManagedUsers(list) {
  const usernames = new Set(list.map(u => u.username));
  let changed = false;
  list.forEach(user => {
    const filtered = (user.managedUsers || []).filter(member => usernames.has(member) && member !== user.username);
    if (filtered.length !== (user.managedUsers || []).length) {
      changed = true;
    }
    user.managedUsers = filtered;
  });
  return changed;
}

function removeFromManagedTeams(username) {
  if (!username) return false;
  let changed = false;
  users.forEach(user => {
    if (!Array.isArray(user.managedUsers)) return;
    const filtered = user.managedUsers.filter(member => member !== username);
    if (filtered.length !== user.managedUsers.length) {
      user.managedUsers = filtered;
      changed = true;
    }
  });
  return changed;
}

function loadUsersFromStorage() {
  try {
    const raw = localStorage.getItem(STORAGE_KEYS.users);
    if (raw) {
      const parsed = JSON.parse(raw);
      if (Array.isArray(parsed)) {
        const list = parsed.map(normaliseUser).filter(Boolean);
        cleanManagedUsers(list);
        return list;
      }
    }
  } catch (error) {
    console.warn('No se pudieron cargar los usuarios guardados', error);
  }
  const defaults = DEFAULT_USERS.map(normaliseUser).filter(Boolean);
  cleanManagedUsers(defaults);
  return defaults;
}

function saveUsers() {
  if (remoteState.enabled) {
    scheduleRemoteSync();
  }
  try {
    localStorage.setItem(STORAGE_KEYS.users, JSON.stringify(users));
  } catch (error) {
    console.warn('No se pudieron guardar los usuarios', error);
  }
}

function getUserByUsername(username) {
  if (!username) return null;
  return users.find(user => user.username === username) || null;
}

function buildUserSnapshot(user) {
  if (!user) return null;
  return {
    username: user.username,
    role: user.role,
    firstName: user.firstName || '',
    lastName: user.lastName || '',
    email: user.email || '',
    companyPhone: user.companyPhone || '',
    personalPhone: user.personalPhone || '',
    address: user.address || '',
    photo: user.photo || '',
    managedUsers: Array.isArray(user.managedUsers) ? [...user.managedUsers] : [],
    pointsBalance: Number.isFinite(Number(user.pointsBalance)) ? Math.round(Number(user.pointsBalance)) : 0,
    pointsHistory: Array.isArray(user.pointsHistory) ? [...user.pointsHistory] : [],
    referrals: Array.isArray(user.referrals) ? [...user.referrals] : [],
    referredBy: user.referredBy || '',
    selfRegistered: Boolean(user.selfRegistered)
  };
}

function userDisplayName(user) {
  if (!user) return '';
  const first = (user.firstName || '').trim();
  const last = (user.lastName || '').trim();
  const combined = `${first} ${last}`.trim();
  if (combined) return combined;
  if (user.name) return user.name;
  return user.username || '';
}

function updateAvailableUsersHint() {
  const hint = $('#availableUsers');
  if (!hint) return;
  if (!users.length) {
    hint.textContent = 'Sin usuarios disponibles';
    return;
  }
  hint.textContent = users.map(u => u.username).join(', ');
}

function detectTariffType(item) {
  const raw = (item.tipo || item.type || item.category || '').toString().trim().toUpperCase();
  if (raw && TARIFF_TYPE_ORDER.includes(raw[0])) return raw[0];
  const text = `${item.nombre || ''} ${item['descripción'] || item.descripcion || ''}`.toLowerCase();
  if (/prepago/.test(text)) return 'P';
  if (/(n[uú]mero\s+nuevo|numero\s+nuevo|alta\s+nueva)/.test(text)) return 'N';
  if (/(convergen|fibra\s+y\s+m[oó]vil|fibra\s+\+\s+m[oó]vil|pack\s+completo)/.test(text)) return 'C';
  if (/fibra/.test(text) && !/m[oó]vil/.test(text)) return 'F';
  if (/m[oó]vil/.test(text)) return 'M';
  return 'C';
}

function normaliseTariff(item) {
  const clone = { ...item };
  clone.id = clone.id || clone.codigo || createId('tarifa');
  clone.lineas = clone.lineas === '' || clone.lineas === undefined ? null : clone.lineas;
  if (clone.lineas !== null) clone.lineas = Number(clone.lineas);
  clone.precio = clone.precio === '' || clone.precio === undefined ? null : clone.precio;
  if (clone.precio !== null) clone.precio = Number(clone.precio);
  clone.moneda = clone.moneda || 'EUR';
  clone.tipo = detectTariffType(clone);
  clone.destacada = Boolean(item.destacada || item.featured);
  const rawPlatforms = Array.isArray(clone.plataformas)
    ? clone.plataformas
    : (clone.platforms || clone.tv || clone['plataformas'] || clone['tv/plataformas'] || '');
  let platforms = [];
  if (Array.isArray(rawPlatforms)) {
    platforms = rawPlatforms.map(value => String(value || '').trim()).filter(Boolean);
  } else if (typeof rawPlatforms === 'string') {
    platforms = rawPlatforms
      .split(/[,;\n]/)
      .map(value => value.trim())
      .filter(Boolean);
  }
  clone.plataformas = platforms;
  return clone;
}

function loadTariffsFromStorage() {
  try {
    const raw = localStorage.getItem(STORAGE_KEYS.tariffs);
    if (raw) {
      const parsed = JSON.parse(raw);
      if (Array.isArray(parsed)) {
        return parsed.map(normaliseTariff);
      }
    }
  } catch (error) {
    console.warn('No se pudieron cargar las tarifas guardadas', error);
  }
  return BASE_DATA.map(normaliseTariff);
}

function saveTariffs() {
  if (remoteState.enabled) {
    scheduleRemoteSync();
  }
  try {
    localStorage.setItem(STORAGE_KEYS.tariffs, JSON.stringify(tariffs));
  } catch (error) {
    console.warn('No se pudieron guardar las tarifas', error);
  }
}

function parseLocaleNumber(value) {
  if (value === null || value === undefined) return NaN;
  if (typeof value === 'number') return Number.isFinite(value) ? value : NaN;
  const normalised = String(value).replace(/[^0-9.,-]/g, '').replace(',', '.');
  const parsed = parseFloat(normalised);
  return Number.isFinite(parsed) ? parsed : NaN;
}

function tariffLines(tariff) {
  if (tariff.lineas === null || tariff.lineas === undefined) return Number.POSITIVE_INFINITY;
  const value = Number(tariff.lineas);
  return Number.isFinite(value) ? value : Number.POSITIVE_INFINITY;
}

function extractTariffFeatures(tariff) {
  const baseText = `${tariff.nombre || ''} ${tariff['descripción'] || ''}`.toLowerCase();
  const dataMatches = Array.from(baseText.matchAll(/(\d+(?:[.,]\d+)?)\s*(?:gb|gigas)/g));
  const dataValues = dataMatches
    .map(match => parseLocaleNumber(match[1]))
    .filter(value => !Number.isNaN(value));
  const dataGB = dataValues.length ? Math.max(...dataValues) : null;
  const fiberMatches = Array.from(baseText.matchAll(/(\d+(?:[.,]\d+)?)\s*(?:gbps|gb|mbps|mb)\s*(?:de\s*)?fibra/g));
  let fiberMbps = null;
  fiberMatches.forEach(match => {
    const amount = parseLocaleNumber(match[1]);
    if (Number.isNaN(amount)) return;
    const unit = /gbp?s?/i.test(match[0]) ? 1000 : /gb/i.test(match[0]) ? 1000 : 1;
    const mbps = amount * unit;
    fiberMbps = fiberMbps === null ? mbps : Math.max(fiberMbps, mbps);
  });
  if (fiberMbps === null && /(fibra\s+r[áa]pida|fibra\s+alta\s+velocidad)/.test(baseText)) {
    fiberMbps = 600;
  }
  const unlimitedMinutes = /(ilimitad|minutos\s+ilimitados|llamadas\s+ilimitadas|sin\s+l[ií]mite\s+de\s+minutos)/.test(baseText);
  return { dataGB, fiberMbps, unlimitedMinutes };
}

function parseAiQuery(raw) {
  const text = String(raw || '').toLowerCase();
  const lineMatch = text.match(/(\d+)\s*(?:l[ií]neas|lineas|l[ií]nea|linea)/);
  const lines = lineMatch ? parseInt(lineMatch[1], 10) : null;
  const budgetValues = [];
  for (const match of text.matchAll(/(\d+(?:[.,]\d+)?)\s*(?:€|eur|euros)/g)) {
    const value = parseLocaleNumber(match[1]);
    if (!Number.isNaN(value)) budgetValues.push(value);
  }
  for (const match of text.matchAll(/(?:menos\s+de|inferior\s+a|hasta)\s+(\d+(?:[.,]\d+)?)/g)) {
    const value = parseLocaleNumber(match[1]);
    if (!Number.isNaN(value)) budgetValues.push(value);
  }
  const budget = budgetValues.length ? Math.min(...budgetValues) : null;
  const dataMatches = Array.from(text.matchAll(/(\d+(?:[.,]\d+)?)\s*(?:gb|gigas)/g));
  const dataValues = dataMatches
    .map(match => parseLocaleNumber(match[1]))
    .filter(value => !Number.isNaN(value));
  const minData = dataValues.length ? Math.max(...dataValues) : null;
  const fiberMatches = Array.from(text.matchAll(/(\d+(?:[.,]\d+)?)\s*(?:gbps|gb|mbps|mb)\s*(?:de\s*)?fibra/g));
  let fiberMbps = null;
  fiberMatches.forEach(match => {
    const value = parseLocaleNumber(match[1]);
    if (Number.isNaN(value)) return;
    const unit = /gbp?s?/i.test(match[0]) ? 1000 : /gb/i.test(match[0]) ? 1000 : 1;
    const mbps = value * unit;
    fiberMbps = fiberMbps === null ? mbps : Math.max(fiberMbps, mbps);
  });
  if (fiberMbps === null && /(fibra\s+r[áa]pida|fibra\s+alta\s+velocidad)/.test(text)) {
    fiberMbps = 600;
  }
  const unlimitedMinutes = /(ilimitad|minutos\s+ilimitados|sin\s+l[ií]mite\s+de\s+minutos|llamadas\s+ilimitadas)/.test(text);
  return { lines, budget, minData, fiberMbps, unlimitedMinutes };
}

function normaliseAiRequirements(input) {
  const base = {
    lines: null,
    budget: null,
    minData: null,
    fiberMbps: null,
    unlimitedMinutes: false,
    wantsMobile: false,
    wantsTv: false,
    tvPlatform: '',
    tvLabel: ''
  };
  if (!input) return base;
  if (typeof input === 'string') {
    const parsed = parseAiQuery(input);
    return {
      ...base,
      ...parsed,
      wantsMobile: parsed.lines != null,
      wantsTv: false,
      tvPlatform: '',
      tvLabel: ''
    };
  }
  const clone = { ...base };
  if (input.lines != null && input.lines !== '') {
    const value = Number(input.lines);
    if (Number.isFinite(value) && value > 0) clone.lines = value;
  }
  if (input.budget != null && input.budget !== '') {
    const budget = Number(input.budget);
    if (Number.isFinite(budget) && budget > 0) clone.budget = budget;
  }
  if (input.minData != null && input.minData !== '') {
    const data = Number(input.minData);
    if (Number.isFinite(data) && data > 0) clone.minData = data;
  }
  if (input.fiberMbps != null && input.fiberMbps !== '') {
    const fiber = Number(input.fiberMbps);
    if (Number.isFinite(fiber) && fiber > 0) clone.fiberMbps = fiber;
  }
  clone.unlimitedMinutes = Boolean(input.unlimitedMinutes);
  clone.wantsMobile = Boolean(input.wantsMobile) || (clone.lines != null && clone.lines > 0);
  clone.wantsTv = Boolean(input.wantsTv);
  const platform = (input.tvPlatform || '').toString().trim();
  if (clone.wantsTv && platform) {
    const normalised = normalisePlatformIdentifier(platform);
    if (normalised) {
      clone.tvPlatform = normalised;
      clone.tvLabel = input.tvLabel || platform;
    }
  }
  return clone;
}

function normalisePlatformIdentifier(value) {
  return String(value || '')
    .toLowerCase()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '')
    .replace(/\s+/g, '')
    .replace(/\+/g, 'plus')
    .replace(/[^a-z0-9]/g, '');
}

function getTariffTvPlatforms(tariff) {
  if (!tariff) return [];
  const explicit = Array.isArray(tariff.plataformas) ? tariff.plataformas : [];
  const platforms = explicit
    .map(label => String(label || '').trim())
    .filter(Boolean)
    .map(label => ({ id: normalisePlatformIdentifier(label), label }));
  const seen = new Set(platforms.map(item => item.id));
  const text = `${tariff.nombre || ''} ${tariff['descripción'] || tariff.descripcion || ''}`.toLowerCase();
  KNOWN_TV_PLATFORMS.forEach(platform => {
    if (platform.pattern.test(text) && !seen.has(platform.id)) {
      platforms.push({ id: platform.id, label: platform.label });
      seen.add(platform.id);
    }
  });
  return platforms;
}

function tariffMeetsTvRequirement(tariff, requirements) {
  const platforms = getTariffTvPlatforms(tariff);
  const hasTv = platforms.length > 0;
  if (!requirements || !requirements.wantsTv) {
    return { hasTv, exactMatch: false, platforms };
  }
  if (!hasTv) {
    return { hasTv: false, exactMatch: false, platforms };
  }
  if (requirements.tvPlatform) {
    const exactMatch = platforms.some(item => item.id === requirements.tvPlatform);
    return { hasTv: true, exactMatch, platforms };
  }
  return { hasTv: true, exactMatch: true, platforms };
}

function applyAiRequirementsToForm(requirements) {
  if (!requirements) return;
  if (aiFiberSelect) {
    aiFiberSelect.value = requirements.fiberMbps ? String(requirements.fiberMbps) : '';
  }
  if (aiMobilePreferenceSelect) {
    aiMobilePreferenceSelect.value = requirements.wantsMobile ? 'yes' : 'no';
  }
  handleAiMobilePreferenceChange();
  if (aiMobileLinesSelect) {
    aiMobileLinesSelect.value = requirements.lines ? String(requirements.lines) : '1';
  }
  if (aiTvPreferenceSelect) {
    aiTvPreferenceSelect.value = requirements.wantsTv ? 'yes' : 'no';
  }
  handleAiTvPreferenceChange();
  if (aiTvPlatformSelect) {
    if (requirements.tvPlatform) {
      const option = Array.from(aiTvPlatformSelect.options || []).find(opt => normalisePlatformIdentifier(opt.value) === requirements.tvPlatform);
      if (option) {
        aiTvPlatformSelect.value = option.value;
      }
    } else {
      aiTvPlatformSelect.selectedIndex = 0;
    }
  }
}

function aiRequirementsAreEmpty(requirements) {
  if (!requirements) return true;
  return !requirements.lines
    && !requirements.budget
    && !requirements.minData
    && !requirements.fiberMbps
    && !requirements.unlimitedMinutes
    && !requirements.wantsTv
    && !requirements.wantsMobile;
}

function populateAiLinesOptions() {
  if (!aiMobileLinesSelect) return;
  const previous = aiMobileLinesSelect.value;
  const options = [];
  for (let value = 1; value <= 10; value += 1) {
    const label = `${value} ${value === 1 ? 'línea' : 'líneas'}`;
    options.push(`<option value="${value}">${label}</option>`);
  }
  aiMobileLinesSelect.innerHTML = options.join('');
  if (previous && options.some(option => option.includes(`value="${previous}"`))) {
    aiMobileLinesSelect.value = previous;
  } else {
    aiMobileLinesSelect.value = '1';
  }
}

function populateAiFiberOptions() {
  if (!aiFiberSelect) return;
  const previous = aiFiberSelect.value;
  const speeds = uniq(
    tariffs
      .map(tariff => {
        const features = extractTariffFeatures(tariff);
        return features.fiberMbps;
      })
      .filter(value => Number.isFinite(value) && value > 0)
  ).sort((a, b) => a - b);
  const options = ['<option value="">Cualquier velocidad</option>'];
  speeds.forEach(speed => {
    const label = speed >= 1000 ? `${(speed / 1000).toFixed(speed % 1000 === 0 ? 0 : 1)} Gbps` : `${Math.round(speed)} Mbps`;
    options.push(`<option value="${speed}">${label}</option>`);
  });
  aiFiberSelect.innerHTML = options.join('');
  if (previous && options.some(option => option.includes(`value="${previous}"`))) {
    aiFiberSelect.value = previous;
  } else {
    aiFiberSelect.value = '';
  }
}

function handleAiMobilePreferenceChange() {
  const wantsMobile = aiMobilePreferenceSelect?.value === 'yes';
  if (!aiLinesField) return;
  aiLinesField.classList.toggle('hidden', !wantsMobile);
  if (wantsMobile && aiMobileLinesSelect && !aiMobileLinesSelect.value) {
    aiMobileLinesSelect.value = '1';
  }
}

function handleAiTvPreferenceChange() {
  const wantsTv = aiTvPreferenceSelect?.value === 'yes';
  if (!aiTvField) return;
  aiTvField.classList.toggle('hidden', !wantsTv);
}

function collectAiRequirementsFromForm() {
  return normaliseAiRequirements({
    fiberMbps: aiFiberSelect?.value || null,
    lines: aiMobilePreferenceSelect?.value === 'yes' ? aiMobileLinesSelect?.value || '1' : null,
    wantsMobile: aiMobilePreferenceSelect?.value === 'yes',
    wantsTv: aiTvPreferenceSelect?.value === 'yes',
    tvPlatform: aiTvPreferenceSelect?.value === 'yes' ? aiTvPlatformSelect?.value || '' : '',
    tvLabel: aiTvPreferenceSelect?.value === 'yes' ? (aiTvPlatformSelect?.selectedOptions?.[0]?.textContent || '') : ''
  });
}

function scoreTariff(tariff, requirements = {}) {
  const linesAvailable = tariffLines(tariff);
  if (requirements.lines && linesAvailable < requirements.lines) return -Infinity;
  if (requirements.wantsMobile && Number.isFinite(linesAvailable) && linesAvailable < (requirements.lines || 1)) return -Infinity;
  const price = tariff.precio != null ? Number(tariff.precio) : Infinity;
  const features = extractTariffFeatures(tariff);
  const tvInfo = tariffMeetsTvRequirement(tariff, requirements);
  if (requirements.wantsTv && !tvInfo.hasTv) return -Infinity;
  if (requirements.wantsTv && requirements.tvPlatform && !tvInfo.exactMatch) return -Infinity;
  let score = 0;
  if (requirements.budget && Number.isFinite(price)) {
    if (price <= requirements.budget) {
      score += 8 - ((requirements.budget - price) / Math.max(requirements.budget, 1)) * 3;
    } else {
      score -= ((price - requirements.budget) / Math.max(requirements.budget, 1)) * 6;
    }
  }
  if (requirements.minData) {
    if (features.dataGB != null && features.dataGB >= requirements.minData) {
      score += 6 + Math.min(features.dataGB - requirements.minData, 80) / 10;
    } else {
      score -= 6;
    }
  } else if (features.dataGB != null) {
    score += Math.min(features.dataGB, 150) / 60;
  }
  if (requirements.fiberMbps) {
    if (features.fiberMbps != null && features.fiberMbps >= requirements.fiberMbps) {
      score += 5 + Math.min(features.fiberMbps - requirements.fiberMbps, 800) / 150;
    } else {
      score -= 4;
    }
  } else if (features.fiberMbps) {
    score += features.fiberMbps / 220;
  }
  if (requirements.unlimitedMinutes) {
    score += features.unlimitedMinutes ? 3 : -3;
  } else if (features.unlimitedMinutes) {
    score += 1.5;
  }
  if (requirements.wantsMobile) {
    if (Number.isFinite(linesAvailable)) {
      score += Math.min(linesAvailable, requirements.lines || linesAvailable) * 1.5;
    } else {
      score += 1;
    }
  } else if (Number.isFinite(linesAvailable) && linesAvailable > 1) {
    score += 0.5;
  }
  if (requirements.wantsTv) {
    score += tvInfo.exactMatch ? 6 : 3;
  } else if (tvInfo.hasTv) {
    score += 1.5;
  }
  if (tariff.permanencia && String(tariff.permanencia).toLowerCase().includes('sin')) {
    score += 1;
  }
  if (Number.isFinite(price)) {
    score -= price / 120;
  }
  return score;
}

function premiumScore(tariff, requirements = {}) {
  const linesAvailable = tariffLines(tariff);
  if (requirements.lines && linesAvailable < requirements.lines) return -Infinity;
  if (requirements.wantsMobile && Number.isFinite(linesAvailable) && linesAvailable < (requirements.lines || 1)) return -Infinity;
  const price = tariff.precio != null ? Number(tariff.precio) : Infinity;
  const features = extractTariffFeatures(tariff);
  const tvInfo = tariffMeetsTvRequirement(tariff, requirements);
  if (requirements.wantsTv && !tvInfo.hasTv) return -Infinity;
  if (requirements.wantsTv && requirements.tvPlatform && !tvInfo.exactMatch) return -Infinity;
  let score = 0;
  if (features.dataGB != null) score += features.dataGB * 0.65;
  if (features.fiberMbps != null) score += features.fiberMbps / 60;
  if (features.unlimitedMinutes) score += 4.5;
  if (requirements.minData && features.dataGB != null) {
    score += Math.max(0, features.dataGB - requirements.minData) * 0.9;
  }
  if (requirements.fiberMbps && features.fiberMbps != null) {
    score += Math.max(0, features.fiberMbps - requirements.fiberMbps) / 40;
  }
  if (requirements.wantsMobile) {
    if (Number.isFinite(linesAvailable)) {
      score += Math.min(linesAvailable, requirements.lines || linesAvailable) * 2;
    } else {
      score += 2;
    }
  } else if (Number.isFinite(linesAvailable) && linesAvailable > 1) {
    score += 0.75;
  }
  if (tvInfo.hasTv) {
    score += requirements.wantsTv ? (tvInfo.exactMatch ? 8 : 5) : 3;
  }
  if (requirements.budget && Number.isFinite(price) && price > requirements.budget * 2) {
    score -= (price - requirements.budget * 2) / 45;
  }
  if (Number.isFinite(price)) {
    score -= price / 160;
  }
  return score;
}

function formatAiReason(type, tariff, requirements, features) {
  const priceText = tariff.precio != null ? euro(tariff.precio, tariff.moneda) : 'precio no disponible';
  const parts = [];
  if (features.dataGB != null) {
    parts.push(`${Math.round(features.dataGB)}GB de datos`);
  }
  if (features.fiberMbps != null) {
    if (features.fiberMbps >= 1000) {
      const gbps = features.fiberMbps / 1000;
      parts.push(`${gbps % 1 === 0 ? gbps : gbps.toFixed(1)} Gbps de fibra`);
    } else {
      parts.push(`${Math.round(features.fiberMbps)} Mbps de fibra`);
    }
  }
  if (features.unlimitedMinutes) {
    parts.push('llamadas ilimitadas');
  }
  const tvInfo = tariffMeetsTvRequirement(tariff, requirements);
  if (tvInfo.hasTv) {
    const labels = tvInfo.platforms.map(item => item.label).filter(Boolean);
    if (labels.length) {
      parts.push(`plataformas: ${labels.join(', ')}`);
    } else {
      parts.push('incluye TV o plataformas');
    }
  }
  const featureText = parts.length ? ` Incluye ${parts.join(' · ')}.` : '';
  const safeRequirements = requirements || {};
  const requestedLines = safeRequirements.lines;
  const lineText = tariff.lineas != null ? `${tariff.lineas} líneas` : 'líneas flexibles';
  if (type === 'economy') {
    const coverage = requestedLines ? `${requestedLines} líneas solicitadas` : lineText;
    let message = `Es la opción más económica que cubre ${coverage} por ${priceText}.`;
    if (safeRequirements.wantsTv && tvInfo.hasTv) {
      message += ' Aporta las plataformas solicitadas.';
    }
    return `${message}${featureText}`.trim();
  }
  if (type === 'premium') {
    let message = `Mejora las prestaciones con ${lineText} y extras avanzados por ${priceText}.`;
    if (safeRequirements.wantsTv && tvInfo.hasTv) {
      message += ' Incluye las plataformas destacadas.';
    }
    return `${message}${featureText}`.trim();
  }
  let message = `Equilibrio entre prestaciones y precio por ${priceText}.`;
  if (requestedLines && tariffLines(tariff) >= requestedLines) {
    message += ` Mantiene las ${requestedLines} líneas solicitadas.`;
  }
  if (safeRequirements.budget && tariff.precio != null && tariff.precio <= safeRequirements.budget) {
    message += ' Respeta el presupuesto indicado.';
  }
  if (safeRequirements.minData && features.dataGB != null && features.dataGB >= safeRequirements.minData) {
    message += ' Cumple el mínimo de datos móviles.';
  }
  if (safeRequirements.fiberMbps && features.fiberMbps != null && features.fiberMbps >= safeRequirements.fiberMbps) {
    message += ' Ofrece la velocidad de fibra solicitada o superior.';
  }
  if (safeRequirements.wantsTv && tvInfo.hasTv) {
    message += ' Añade TV o plataformas incluidas.';
  }
  return `${message}${featureText}`.trim();
}

function buildAiRecommendations(input) {
  const requirements = normaliseAiRequirements(input);
  const dataset = tariffs.slice();
  if (!dataset.length) {
    return { requirements, items: [] };
  }
  const pool = dataset.filter(tariff => {
    if (!tariff) return false;
    const linesAvailable = tariffLines(tariff);
    if (requirements.lines && linesAvailable < requirements.lines) return false;
    if (requirements.wantsMobile && Number.isFinite(linesAvailable) && linesAvailable < (requirements.lines || 1)) return false;
    const tvInfo = tariffMeetsTvRequirement(tariff, requirements);
    if (requirements.wantsTv && !tvInfo.hasTv) return false;
    if (requirements.wantsTv && requirements.tvPlatform && !tvInfo.exactMatch) return false;
    const features = extractTariffFeatures(tariff);
    if (requirements.fiberMbps && features.fiberMbps != null && features.fiberMbps < requirements.fiberMbps) return false;
    if (requirements.minData && features.dataGB != null && features.dataGB < requirements.minData) return false;
    return true;
  });
  if (!pool.length) {
    return { requirements, items: [] };
  }
  const economyCandidates = pool
    .slice()
    .sort((a, b) => (a.precio ?? Infinity) - (b.precio ?? Infinity));
  const economy = economyCandidates.find(item => item && item.precio != null) || economyCandidates[0] || null;

  const balanced = pool
    .map(tariff => ({ tariff, score: scoreTariff(tariff, requirements) }))
    .filter(item => item.score > -Infinity)
    .sort((a, b) => b.score - a.score);
  const best = balanced.length ? balanced[0].tariff : economy;

  const premiumCandidates = pool
    .map(tariff => ({ tariff, score: premiumScore(tariff, requirements) }))
    .filter(item => item.score > -Infinity)
    .sort((a, b) => b.score - a.score);
  let premium = premiumCandidates.length ? premiumCandidates[0].tariff : null;

  const results = [];
  const seen = new Set();
  if (economy) {
    seen.add(economy.id);
    results.push({ type: 'economy', label: 'Opción más económica', tariff: economy, reason: formatAiReason('economy', economy, requirements, extractTariffFeatures(economy)) });
  }
  if (best && !seen.has(best.id)) {
    seen.add(best.id);
    results.push({ type: 'balanced', label: 'Mejor equilibrio', tariff: best, reason: formatAiReason('balanced', best, requirements, extractTariffFeatures(best)) });
  }
  if (premium) {
    if (seen.has(premium.id)) {
      premium = premiumCandidates.find(item => !seen.has(item.tariff.id))?.tariff || null;
    }
    if (premium) {
      seen.add(premium.id);
      results.push({ type: 'premium', label: 'Potencia superior', tariff: premium, reason: formatAiReason('premium', premium, requirements, extractTariffFeatures(premium)) });
    }
  }
  return { requirements, items: results };
}

function canCurrentUserRequestTariffs() {
  return Boolean(currentUser && (currentUser.role === 'comercial' || currentUser.role === 'lider' || currentUser.role === CLIENT_ROLE));
}

function clearAiHighlights() {
  if (!grid) return;
  grid.querySelectorAll('.tile.highlighted').forEach(tile => tile.classList.remove('highlighted'));
}

function focusTariffCard(tariffId) {
  if (!grid || !tariffId) return;
  clearAiHighlights();
  const tile = grid.querySelector(`[data-tariff-id="${tariffId}"]`);
  if (tile) {
    tile.classList.add('highlighted');
    tile.scrollIntoView({ behavior: 'smooth', block: 'center' });
    setTimeout(() => tile.classList.remove('highlighted'), 4000);
  }
}

function renderAiResults(result) {
  if (!aiResults) return;
  if (!result) {
    aiResults.innerHTML = '<p class="dim">Selecciona tus preferencias y pulsa «Buscar tarifas».</p>';
    clearAiHighlights();
    return;
  }
  if (!Array.isArray(result.items) || !result.items.length) {
    aiResults.innerHTML = '<p class="dim">No hemos encontrado tarifas que cumplan esas preferencias. Ajusta los filtros y vuelve a intentarlo.</p>';
    clearAiHighlights();
    return;
  }
  const requirements = result.requirements || {};
  const canRequest = canCurrentUserRequestTariffs();
  aiResults.innerHTML = result.items
    .map(option => {
      const tariff = option.tariff;
      const tariffId = escapeHtml(tariff.id || '');
      const price = tariff.precio != null ? euro(tariff.precio, tariff.moneda) : 'Precio no disponible';
      const lines = tariff.lineas != null ? `${tariff.lineas} líneas móviles` : 'Líneas flexibles';
      const permanencia = tariff.permanencia ? `Permanencia: ${escapeHtml(tariff.permanencia)}` : 'Sin datos de permanencia';
      const requestControl = canRequest
        ? `<button class="primary" data-action="ai-lead" data-id="${tariffId}">Solicitar tarifa</button>`
        : '<span class="dim">Inicia sesión para solicitarla</span>';
      const focusButton = `<button class="smallbtn" data-action="ai-focus" data-id="${tariffId}">Ver en catálogo</button>`;
      const tvInfo = tariffMeetsTvRequirement(tariff, requirements);
      const tvLabel = tvInfo.hasTv
        ? `<div class="dim">TV/plataformas: ${escapeHtml(tvInfo.platforms.map(item => item.label).join(', ') || 'Incluida')}</div>`
        : '';
      const reason = escapeHtml(option.reason);
      return `
        <div class="ai-card" data-id="${tariffId}">
          <span class="badge">${escapeHtml(option.label)}</span>
          <h4>${escapeHtml(tariff.nombre || '')}</h4>
          <div class="dim">${escapeHtml(tariff['compañia'] || 'Compañía no indicada')} · ${escapeHtml(lines)}</div>
          <div class="price">${escapeHtml(price)}</div>
          <p class="dim">${reason}</p>
          ${tvLabel}
          <p class="dim">${permanencia}</p>
          <div class="inline-actions" style="justify-content:flex-end; gap:8px;">
            ${focusButton}
            ${requestControl}
          </div>
        </div>
      `;
    })
    .join('');
}

function runAiSearch(input, { preserveFormState = false } = {}) {
  const requirements = normaliseAiRequirements(input || {});
  aiLastQuery = { ...requirements };
  if (!preserveFormState) {
    applyAiRequirementsToForm(requirements);
  }
  clearAiHighlights();
  const recommendation = buildAiRecommendations(requirements);
  renderAiResults(recommendation);
}

function handleAiSearchSubmit(event) {
  event.preventDefault();
  runAiSearch(collectAiRequirementsFromForm(), { preserveFormState: true });
}

function resetAiSearch() {
  aiLastQuery = null;
  applyAiRequirementsToForm(normaliseAiRequirements({}));
  clearAiHighlights();
  if (aiResults) {
    aiResults.innerHTML = '<p class="dim">Selecciona tus preferencias y pulsa «Buscar tarifas».</p>';
  }
}

function handleAiResultsClick(event) {
  const button = event.target.closest('button[data-action]');
  if (!button) return;
  const id = button.dataset.id;
  if (!id) return;
  if (button.dataset.action === 'ai-focus') {
    focusTariffCard(id);
  }
  if (button.dataset.action === 'ai-lead') {
    const tariff = tariffs.find(item => item.id === id);
    if (tariff) {
      openLeadModal(tariff);
    }
  }
}

function normaliseLead(raw) {
  if (!raw) return null;
  const lead = { ...raw };
  lead.id = lead.id || createId('lead');
  lead.status = lead.status || 'pendiente';
  lead.createdAt = lead.createdAt || lead.created_at || new Date().toISOString();
  lead.updatedAt = lead.updatedAt || lead.updated_at || lead.createdAt;
  const normalisedSoldAt = parseDate(raw.soldAt || raw.sold_at || lead.soldAt);
  lead.soldAt = normalisedSoldAt ? normalisedSoldAt.toISOString() : (lead.status === 'vendido' ? lead.updatedAt : null);
  lead.notified = lead.notified !== undefined ? Boolean(lead.notified) : true;
  lead.origin = lead.origin || 'comercial';
  lead.installed = Boolean(lead.installed);
  lead.commercial = lead.commercial || lead.comercial || '';
  lead.commercialName = lead.commercialName || lead.commercial || lead.comercial || lead.commercialName || '';
  lead.clientName = lead.clientName || lead.client || '';
  lead.contact = lead.contact || '';
  lead.notes = lead.notes || '';
  lead.cancelReason = lead.cancelReason || lead.cancel_reason || '';
  lead.cancelledAt = lead.cancelledAt || lead.cancelled_at || null;
  lead.cancelledBy = lead.cancelledBy || lead.cancelled_by || '';
  lead.cancelledByName = lead.cancelledByName || lead.cancelled_by_name || '';
  lead.clientUsername = (lead.clientUsername || lead.client_username || '').toLowerCase();
  lead.referredBy = (lead.referredBy || lead.referred_by || '').toLowerCase();
  const ledger = lead.pointsLedger || lead.points_ledger || {};
  lead.pointsLedger = {
    base: Number.isFinite(Number(ledger.base)) ? Number(ledger.base) : 0,
    referral: Number.isFinite(Number(ledger.referral)) ? Number(ledger.referral) : 0,
    awardedAt: ledger.awardedAt || ledger.awarded_at || null
  };
  return lead;
}

function normaliseRewardRequest(raw) {
  if (!raw) return null;
  const username = (raw.username || raw.user || '').trim().toLowerCase();
  if (!username) return null;
  const points = Number.parseInt(raw.points ?? raw.pointsCost ?? raw.coste ?? raw.amount ?? 0, 10);
  const status = raw.status === 'entregado' ? 'entregado' : 'pendiente';
  return {
    id: raw.id || createId('rewardreq'),
    username,
    status,
    points: Number.isFinite(points) && points > 0 ? points : 0,
    requestedAt: raw.requestedAt || raw.requested_at || new Date().toISOString(),
    deliveredAt: raw.deliveredAt || raw.delivered_at || null
  };
}

function normaliseReward(raw) {
  if (!raw) return null;
  const title = (raw.title || raw.nombre || '').trim();
  const points = Number.parseInt(raw.pointsCost ?? raw.points ?? raw.coste ?? 0, 10);
  if (!title) return null;
  const pointsCost = Number.isFinite(points) && points > 0 ? Math.round(points) : 0;
  if (pointsCost <= 0) return null;
  let totalUnits = null;
  const rawUnits = raw.totalUnits ?? raw.units ?? raw.stock ?? raw.existencias ?? raw.availableUnits ?? raw.quantity ?? raw.stockUnits;
  if (rawUnits !== null && rawUnits !== undefined && rawUnits !== '') {
    const parsedUnits = Number.parseInt(rawUnits, 10);
    if (Number.isFinite(parsedUnits) && parsedUnits >= 0) {
      totalUnits = parsedUnits;
    }
  }
  const reward = {
    id: raw.id || createId('reward'),
    title,
    pointsCost,
    description: (raw.description || raw.descripcion || raw['descripción'] || '').trim(),
    imageUrl: (raw.imageUrl || raw.image || raw.img || '').trim(),
    totalUnits,
    validFrom: raw.validFrom || raw.valid_from || '',
    validUntil: raw.validUntil || raw.valid_until || '',
    createdAt: raw.createdAt || raw.created_at || new Date().toISOString(),
    updatedAt: raw.updatedAt || raw.updated_at || new Date().toISOString(),
    archived: Boolean(raw.archived)
  };
  const requests = Array.isArray(raw.requests)
    ? raw.requests.map(normaliseRewardRequest).filter(Boolean)
    : [];
  reward.requests = requests;
  return reward;
}

function loadLeadsFromStorage() {
  try {
    const raw = localStorage.getItem(STORAGE_KEYS.leads);
    if (raw) {
      const parsed = JSON.parse(raw);
      if (Array.isArray(parsed)) {
        return parsed.map(normaliseLead).filter(Boolean);
      }
    }
  } catch (error) {
    console.warn('No se pudieron cargar las oportunidades', error);
  }
  return [];
}

function saveLeads() {
  if (remoteState.enabled) {
    scheduleRemoteSync();
  }
  try {
    localStorage.setItem(STORAGE_KEYS.leads, JSON.stringify(leads));
  } catch (error) {
    console.warn('No se pudieron guardar las oportunidades', error);
  }
}

function loadRewardsFromStorage() {
  try {
    const raw = localStorage.getItem(STORAGE_KEYS.rewards);
    if (raw) {
      const parsed = JSON.parse(raw);
      if (Array.isArray(parsed)) {
        return parsed.map(normaliseReward).filter(Boolean);
      }
    }
  } catch (error) {
    console.warn('No se pudieron cargar las recompensas guardadas', error);
  }
  return [];
}

function saveRewards() {
  if (remoteState.enabled) {
    scheduleRemoteSync();
  }
  try {
    localStorage.setItem(STORAGE_KEYS.rewards, JSON.stringify(rewards));
  } catch (error) {
    console.warn('No se pudieron guardar las recompensas', error);
  }
}

function normaliseNotification(raw) {
  if (!raw || !raw.user || !raw.message) return null;
  return {
    id: raw.id || createId('notif'),
    user: String(raw.user || '').trim(),
    message: String(raw.message || '').trim(),
    createdAt: raw.createdAt || raw.created_at || new Date().toISOString(),
    read: Boolean(raw.read),
    type: raw.type || 'info',
    meta: raw.meta && typeof raw.meta === 'object' ? { ...raw.meta } : {}
  };
}

function loadNotificationsFromStorage() {
  try {
    const raw = localStorage.getItem(STORAGE_KEYS.notifications);
    if (raw) {
      const parsed = JSON.parse(raw);
      if (Array.isArray(parsed)) {
        return parsed.map(normaliseNotification).filter(Boolean);
      }
    }
  } catch (error) {
    console.warn('No se pudieron cargar las notificaciones', error);
  }
  return [];
}

function saveNotifications() {
  if (remoteState.enabled) {
    scheduleRemoteSync();
  }
  try {
    localStorage.setItem(STORAGE_KEYS.notifications, JSON.stringify(notifications));
  } catch (error) {
    console.warn('No se pudieron guardar las notificaciones', error);
  }
}

function normaliseCallRequest(raw) {
  if (!raw) return null;
  const entry = {
    id: raw.id || createId('call'),
    name: (raw.name || raw.clientName || '').trim() || 'Contacto pendiente',
    phone: (raw.phone || raw.telefono || raw.contact || '').trim(),
    time: (raw.time || raw.timePreference || '').trim(),
    notes: (raw.notes || raw.observaciones || '').trim(),
    status: raw.status === 'atendida' || raw.status === 'resuelta' ? 'atendida' : 'pendiente',
    createdAt: raw.createdAt || raw.created_at || new Date().toISOString(),
    updatedAt: raw.updatedAt || raw.updated_at || new Date().toISOString(),
    handledBy: raw.handledBy || '',
    handledByName: raw.handledByName || '',
    resolvedAt: raw.resolvedAt || raw.resolved_at || null,
    originUser: raw.originUser || '',
    originName: raw.originName || (raw.name || '').trim(),
    contactChannel: (raw.contactChannel || raw.contact || '').trim()
  };
  return entry;
}

function loadCallRequestsFromStorage() {
  try {
    const raw = localStorage.getItem(STORAGE_KEYS.callRequests);
    if (raw) {
      const parsed = JSON.parse(raw);
      if (Array.isArray(parsed)) {
        return parsed.map(normaliseCallRequest).filter(Boolean);
      }
    }
  } catch (error) {
    console.warn('No se pudieron cargar las solicitudes de llamada', error);
  }
  return [];
}

function saveCallRequests() {
  if (remoteState.enabled) {
    scheduleRemoteSync();
  }
  try {
    localStorage.setItem(STORAGE_KEYS.callRequests, JSON.stringify(callRequests));
  } catch (error) {
    console.warn('No se pudieron guardar las solicitudes de llamada', error);
  }
}

function normaliseCustomBudget(raw) {
  if (!raw) return null;
  const entry = {
    id: raw.id || createId('pres'),
    summary: (raw.summary || raw.descripcion || '').trim(),
    contact: (raw.contact || raw.contacto || '').trim(),
    status: raw.status === 'resuelto' ? 'resuelto' : 'pendiente',
    createdAt: raw.createdAt || raw.created_at || new Date().toISOString(),
    updatedAt: raw.updatedAt || raw.updated_at || new Date().toISOString(),
    createdBy: raw.createdBy || '',
    createdByName: raw.createdByName || raw.contactName || '',
    createdByRole: raw.createdByRole || '',
    resolvedBy: raw.resolvedBy || '',
    resolvedByName: raw.resolvedByName || '',
    resolvedAt: raw.resolvedAt || raw.resolved_at || null
  };
  return entry;
}

function loadCustomBudgetsFromStorage() {
  try {
    const raw = localStorage.getItem(STORAGE_KEYS.customBudgets);
    if (raw) {
      const parsed = JSON.parse(raw);
      if (Array.isArray(parsed)) {
        return parsed.map(normaliseCustomBudget).filter(Boolean);
      }
    }
  } catch (error) {
    console.warn('No se pudieron cargar los presupuestos a medida', error);
  }
  return [];
}

function saveCustomBudgets() {
  if (remoteState.enabled) {
    scheduleRemoteSync();
  }
  try {
    localStorage.setItem(STORAGE_KEYS.customBudgets, JSON.stringify(customBudgets));
  } catch (error) {
    console.warn('No se pudieron guardar los presupuestos a medida', error);
  }
}

function notificationAppliesToUser(notification, user) {
  if (!notification) return false;
  const target = (notification.user || '').toString().trim().toLowerCase();
  if (!target || target === 'all' || target === '*') return true;
  if (!user) return false;
  const username = (user.username || '').toString().trim().toLowerCase();
  const role = (user.role || '').toString().trim().toLowerCase();
  if (target === username) return true;
  if (target === role) return true;
  if ((target === 'admin' || target === 'admins') && role === 'admin') return true;
  if ((target === 'comerciales' || target === 'comercial') && (role === 'comercial' || role === 'lider')) return true;
  if ((target === 'lideres' || target === 'líderes' || target === 'lider') && role === 'lider') return true;
  if ((target === 'clientes' || target === 'cliente') && role === CLIENT_ROLE) return true;
  return false;
}

function getAdminUsernames() {
  return Array.from(new Set(users.filter(user => user.role === 'admin').map(user => user.username).filter(Boolean)));
}

function pushNotification(payload) {
  if (!payload || !payload.user || !payload.message) return null;
  const entry = normaliseNotification({
    ...payload,
    id: payload.id || createId('notif'),
    createdAt: payload.createdAt || new Date().toISOString(),
    read: false,
    type: payload.type || 'info'
  });
  if (!entry) return null;
  notifications.unshift(entry);
  saveNotifications();
  renderNotifications();
  return entry;
}

function notifyAdmins(message, meta = {}) {
  if (!message) return;
  const admins = getAdminUsernames();
  admins.forEach(username => {
    pushNotification({ user: username, message, type: 'alert', meta });
  });
}

function renderNotifications() {
  if (!notificationButton || !notificationList) return;
  const relevant = notifications
    .filter(notification => notificationAppliesToUser(notification, currentUser))
    .sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));
  const hasUnread = relevant.some(notification => !notification.read);
  notificationButton.classList.toggle('has-unread', hasUnread);
  if (notificationDot) {
    notificationDot.style.display = hasUnread ? 'block' : 'none';
  }
  if (!relevant.length) {
    notificationList.innerHTML = '<li class="notification-empty">Sin notificaciones pendientes</li>';
    return;
  }
  notificationList.innerHTML = relevant
    .map(notification => {
      const time = formatDateTime(notification.createdAt);
      const itemClass = notification.read ? 'notification-item' : 'notification-item unread';
      return `
        <li class="${itemClass}" data-id="${notification.id}">
          <div class="notification-message">${escapeHtml(notification.message)}</div>
          <div class="notification-time">${escapeHtml(time)}</div>
        </li>
      `;
    })
    .join('');
}

function showNotifications() {
  if (!notificationDropdown || !notificationButton) return;
  renderNotifications();
  notificationDropdown.classList.remove('hidden');
  notificationButton.classList.add('active');
  notificationButton.setAttribute('aria-expanded', 'true');
  notificationsOpen = true;
  document.addEventListener('click', handleGlobalClickForNotifications);
}

function hideNotifications() {
  if (!notificationDropdown || !notificationButton) return;
  notificationDropdown.classList.add('hidden');
  notificationButton.classList.remove('active');
  notificationButton.setAttribute('aria-expanded', 'false');
  notificationsOpen = false;
  document.removeEventListener('click', handleGlobalClickForNotifications);
}

function toggleNotifications() {
  if (!notificationDropdown || !notificationButton) return;
  if (notificationsOpen) {
    hideNotifications();
  } else {
    showNotifications();
  }
}

function markCurrentNotificationsAsRead() {
  if (!notifications.length) {
    hideNotifications();
    return;
  }
  if (!currentUser) {
    notifications = notifications.map(notification => ({ ...notification, read: true }));
  } else {
    let changed = false;
    notifications = notifications.map(notification => {
      if (notification.read) return notification;
      if (notificationAppliesToUser(notification, currentUser)) {
        changed = true;
        return { ...notification, read: true };
      }
      return notification;
    });
    if (!changed) {
      hideNotifications();
      return;
    }
  }
  saveNotifications();
  renderNotifications();
}

function handleGlobalClickForNotifications(event) {
  if (!notificationsOpen) return;
  if (!notificationDropdown || !notificationButton) return;
  if (notificationDropdown.contains(event.target) || notificationButton.contains(event.target)) {
    return;
  }
  hideNotifications();
}


function openCustomBudgetModal() {
  if (!customBudgetModal) return;
  customBudgetForm?.reset();
  customBudgetModal.classList.remove('hidden');
  customBudgetModal.setAttribute('aria-hidden', 'false');
  setTimeout(() => customBudgetSummaryInput?.focus(), 0);
}

function closeCustomBudgetModal() {
  if (!customBudgetModal) return;
  customBudgetModal.classList.add('hidden');
  customBudgetModal.setAttribute('aria-hidden', 'true');
}

function handleCustomBudgetSubmit(event) {
  event.preventDefault();
  if (!customBudgetForm) return;
  if (!currentUser || !['comercial', CLIENT_ROLE, 'lider'].includes(currentUser.role)) {
    closeCustomBudgetModal();
    return;
  }
  const summary = customBudgetSummaryInput?.value.trim() || '';
  if (!summary) return;
  const contact = customBudgetContactInput?.value.trim() || '';
  const now = new Date().toISOString();
  const entry = normaliseCustomBudget({
    summary,
    contact,
    status: 'pendiente',
    createdAt: now,
    updatedAt: now,
    createdBy: currentUser.username,
    createdByName: userDisplayName(currentUser),
    createdByRole: currentUser.role
  });
  customBudgets.unshift(entry);
  saveCustomBudgets();
  renderCustomBudgetInbox();
  notifyAdmins(`Nueva solicitud de presupuesto a medida de ${entry.createdByName || 'un usuario'}.`, { id: entry.id, kind: 'custom-budget' });
  pushNotification({ user: currentUser.username, message: 'Tu solicitud de presupuesto a medida ha sido enviada al administrador.', type: 'success', meta: { id: entry.id } });
  closeCustomBudgetModal();
}

function renderCustomBudgetInbox() {
  if (!customBudgetSection || !customBudgetList) return;
  if (!currentUser || currentUser.role !== 'admin') {
    customBudgetSection.classList.add('hidden');
    customBudgetList.innerHTML = '';
    return;
  }
  if (!customBudgets.length) {
    customBudgetSection.classList.add('hidden');
    customBudgetList.innerHTML = '';
    return;
  }
  customBudgetSection.classList.remove('hidden');
  const items = customBudgets
    .slice()
    .sort((a, b) => new Date(b.updatedAt || b.createdAt || 0) - new Date(a.updatedAt || a.createdAt || 0));
  customBudgetList.innerHTML = items
    .map(entry => {
      const status = entry.status === 'resuelto' ? 'vendido' : 'pendiente';
      const statusText = entry.status === 'resuelto' ? 'Resuelto' : 'Pendiente';
      const requester = entry.createdByName || entry.createdBy || 'Cliente';
      const contactInfo = entry.contact
        ? `<div class="dim">Contacto: ${escapeHtml(entry.contact)}</div>`
        : '<div class="dim">Sin datos de contacto adicionales</div>';
      const footerInfo = entry.status === 'resuelto'
        ? `<span>Resuelto por ${escapeHtml(entry.resolvedByName || entry.resolvedBy || 'administración')} · ${escapeHtml(formatDateTime(entry.resolvedAt || entry.updatedAt))}</span>`
        : `<span>Última actualización: ${escapeHtml(formatDateTime(entry.updatedAt || entry.createdAt))}</span>`;
      const actions = entry.status === 'pendiente'
        ? `<button class="smallbtn" data-action="budget-complete" data-id="${escapeHtml(entry.id)}">Marcar resuelto</button>
            <button class="smallbtn danger" data-action="budget-delete" data-id="${escapeHtml(entry.id)}">Eliminar</button>`
        : `<button class="smallbtn danger" data-action="budget-delete" data-id="${escapeHtml(entry.id)}">Eliminar</button>`;
      return `
        <article class="lead-card" data-id="${escapeHtml(entry.id)}">
          <header>
            <div>
              <strong>${escapeHtml(entry.summary)}</strong>
              <div class="meta">Solicitado por ${escapeHtml(requester)}</div>
            </div>
            <span class="status-pill" data-status="${status}">${statusText}</span>
          </header>
          <div class="body">
            ${contactInfo}
            <div class="dim">Creado: ${escapeHtml(formatDateTime(entry.createdAt))}</div>
          </div>
          <footer>
            ${footerInfo}
          </footer>
          <div class="actions">
            ${actions}
          </div>
        </article>
      `;
    })
    .join('');
}

function handleCustomBudgetAction(event) {
  const button = event.target.closest('button[data-action]');
  if (!button) return;
  if (!currentUser || currentUser.role !== 'admin') return;
  const { action, id } = button.dataset;
  if (!id) return;
  const entry = customBudgets.find(item => item.id === id);
  if (!entry) return;
  if (action === 'budget-complete') {
    if (entry.status === 'resuelto') return;
    const now = new Date().toISOString();
    entry.status = 'resuelto';
    entry.resolvedBy = currentUser.username;
    entry.resolvedByName = userDisplayName(currentUser);
    entry.resolvedAt = now;
    entry.updatedAt = now;
    saveCustomBudgets();
    renderCustomBudgetInbox();
    if (entry.createdBy) {
      pushNotification({ user: entry.createdBy, message: 'Tu solicitud de presupuesto a medida ha sido atendida por el administrador.', type: 'info', meta: { id: entry.id } });
    }
    return;
  }
  if (action === 'budget-delete') {
    if (!confirm('¿Seguro que deseas eliminar esta solicitud de presupuesto?')) return;
    const index = customBudgets.findIndex(item => item.id === id);
    if (index === -1) return;
    const [removed] = customBudgets.splice(index, 1);
    saveCustomBudgets();
    renderCustomBudgetInbox();
    if (removed?.createdBy) {
      pushNotification({ user: removed.createdBy, message: 'Tu solicitud de presupuesto a medida se ha cerrado.', type: 'warning', meta: { id: removed.id } });
    }
  }
}

function openCallRequestModal() {
  if (!callRequestModal) return;
  callRequestForm?.reset();
  callRequestModal.classList.remove('hidden');
  callRequestModal.setAttribute('aria-hidden', 'false');
  setTimeout(() => callRequestNameInput?.focus(), 0);
}

function closeCallRequestModal() {
  if (!callRequestModal) return;
  callRequestModal.classList.add('hidden');
  callRequestModal.setAttribute('aria-hidden', 'true');
}

function handleCallRequestSubmit(event) {
  event.preventDefault();
  if (!callRequestForm) return;
  const name = callRequestNameInput?.value.trim() || '';
  const phone = callRequestPhoneInput?.value.trim() || '';
  if (!name || !phone) return;
  const time = callRequestTimeInput?.value.trim() || '';
  const notes = callRequestNotesInput?.value.trim() || '';
  const now = new Date().toISOString();
  const originUser = currentUser?.username || '';
  const entry = normaliseCallRequest({
    name,
    phone,
    time,
    notes,
    status: 'pendiente',
    createdAt: now,
    updatedAt: now,
    originUser,
    originName: currentUser ? userDisplayName(currentUser) : name,
    contactChannel: originUser ? currentUser.role : 'externo'
  });
  callRequests.unshift(entry);
  saveCallRequests();
  renderCallRequestInbox();
  notifyAdmins(`Nueva solicitud de llamada de ${entry.originName || 'un contacto'}.`, { id: entry.id, kind: 'call-request' });
  if (originUser) {
    pushNotification({ user: originUser, message: 'Hemos recibido tu solicitud de llamada. El administrador te contactará en breve.', type: 'success', meta: { id: entry.id } });
  }
  closeCallRequestModal();
}

function renderCallRequestInbox() {
  if (!callRequestSection || !callRequestList) return;
  if (!currentUser || currentUser.role !== 'admin') {
    callRequestSection.classList.add('hidden');
    callRequestList.innerHTML = '';
    return;
  }
  if (!callRequests.length) {
    callRequestSection.classList.add('hidden');
    callRequestList.innerHTML = '';
    return;
  }
  callRequestSection.classList.remove('hidden');
  const items = callRequests
    .slice()
    .sort((a, b) => {
      if (a.status !== b.status) return a.status === 'pendiente' ? -1 : 1;
      return new Date(b.createdAt || 0) - new Date(a.createdAt || 0);
    });
  callRequestList.innerHTML = items
    .map(entry => {
      const status = entry.status === 'atendida' ? 'vendido' : 'pendiente';
      const statusText = entry.status === 'atendida' ? 'Atendida' : 'Pendiente';
      const notes = entry.notes ? `<div class="dim">Notas: ${escapeHtml(entry.notes)}</div>` : '';
      const preferredTime = entry.time ? `<div class="dim">Horario preferido: ${escapeHtml(entry.time)}</div>` : '';
      const origin = entry.originName ? escapeHtml(entry.originName) : 'Contacto externo';
      const footerInfo = entry.status === 'atendida'
        ? `<span>Gestionada por ${escapeHtml(entry.handledByName || entry.handledBy || 'administración')} · ${escapeHtml(formatDateTime(entry.resolvedAt || entry.updatedAt))}</span>`
        : `<span>Recibida: ${escapeHtml(formatDateTime(entry.createdAt))}</span>`;
      const actions = entry.status === 'pendiente'
        ? `<button class="smallbtn" data-action="call-complete" data-id="${escapeHtml(entry.id)}">Marcar atendida</button>
            <button class="smallbtn danger" data-action="call-delete" data-id="${escapeHtml(entry.id)}">Eliminar</button>`
        : `<button class="smallbtn danger" data-action="call-delete" data-id="${escapeHtml(entry.id)}">Eliminar</button>`;
      return `
        <article class="lead-card" data-id="${escapeHtml(entry.id)}">
          <header>
            <div>
              <strong>${escapeHtml(entry.name)}</strong>
              <div class="meta">${origin} · Tel: ${escapeHtml(entry.phone)}</div>
            </div>
            <span class="status-pill" data-status="${status}">${statusText}</span>
          </header>
          <div class="body">
            ${preferredTime}
            ${notes}
          </div>
          <footer>
            ${footerInfo}
          </footer>
          <div class="actions">
            ${actions}
          </div>
        </article>
      `;
    })
    .join('');
}

function handleCallRequestAction(event) {
  const button = event.target.closest('button[data-action]');
  if (!button) return;
  if (!currentUser || currentUser.role !== 'admin') return;
  const { action, id } = button.dataset;
  if (!id) return;
  const entry = callRequests.find(item => item.id === id);
  if (!entry) return;
  if (action === 'call-complete') {
    if (entry.status === 'atendida') return;
    const now = new Date().toISOString();
    entry.status = 'atendida';
    entry.handledBy = currentUser.username;
    entry.handledByName = userDisplayName(currentUser);
    entry.resolvedAt = now;
    entry.updatedAt = now;
    saveCallRequests();
    renderCallRequestInbox();
    if (entry.originUser) {
      pushNotification({ user: entry.originUser, message: 'Tu solicitud de llamada ha sido atendida. El administrador se pondrá en contacto contigo.', type: 'info', meta: { id: entry.id } });
    }
    return;
  }
  if (action === 'call-delete') {
    if (!confirm('¿Seguro que deseas eliminar esta solicitud de llamada?')) return;
    const index = callRequests.findIndex(item => item.id === id);
    if (index === -1) return;
    const [removed] = callRequests.splice(index, 1);
    saveCallRequests();
    renderCallRequestInbox();
    if (removed?.originUser) {
      pushNotification({ user: removed.originUser, message: 'Tu solicitud de llamada se ha cerrado.', type: 'warning', meta: { id: removed.id } });
    }
  }
}

function ensureUserPointsStructure(user) {
  if (!user) return;
  if (typeof user.pointsBalance !== 'number' || Number.isNaN(user.pointsBalance)) {
    user.pointsBalance = 0;
  }
  user.pointsBalance = Math.round(user.pointsBalance);
  if (!Array.isArray(user.pointsHistory)) {
    user.pointsHistory = [];
  }
  if (!Array.isArray(user.referrals)) {
    user.referrals = [];
  }
}

function recordPointsMovement(user, amount, concept, { relatedId = '', type } = {}) {
  if (!user || !amount) return null;
  ensureUserPointsStructure(user);
  const movement = {
    id: createId('pts'),
    amount: Math.round(amount),
    concept: concept || 'Movimiento de puntos',
    relatedId,
    type: type || (amount >= 0 ? 'earned' : 'spent'),
    createdAt: new Date().toISOString()
  };
  user.pointsHistory.unshift(movement);
  if (user.pointsHistory.length > 200) {
    user.pointsHistory = user.pointsHistory.slice(0, 200);
  }
  user.pointsBalance = Math.max(0, Math.round(user.pointsBalance + movement.amount));
  return movement;
}

function updateSnapshotsAfterPointsChange(...list) {
  let refreshed = false;
  list.forEach(user => {
    if (user && currentUser?.username === user.username) {
      setCurrentUser(buildUserSnapshot(user), { persist: false });
      refreshed = true;
    }
  });
  if (refreshed) {
    renderClientPlan();
  }
}

function findTariffForLead(lead) {
  if (!lead) return null;
  return tariffs.find(item => item.id === lead.tariffId)
    || tariffs.find(item => item.codigo === lead.tariffCodigo)
    || null;
}

function calculateTariffPoints(tariff) {
  if (!tariff) return 0;
  const code = String(tariff.codigo || '').trim().toUpperCase();
  if (code.startsWith('C-')) return 20;
  const text = `${tariff.nombre || ''} ${tariff['descripción'] || tariff.description || ''}`.toLowerCase();
  let points = 0;
  if (/fibra/.test(text)) {
    if (/(?:1000\s*mb|1\s*g(?:ig)?b|1\.0\s*g(?:ig)?b)/.test(text)) {
      points += 10;
    } else if (/(?:600\s*mb|0\.6\s*g(?:ig)?b)/.test(text)) {
      points += 6;
    } else if (/(?:300\s*mb|0\.3\s*g(?:ig)?b)/.test(text)) {
      points += 3;
    }
  }
  const lines = Number.isFinite(Number(tariff.lineas)) ? Number(tariff.lineas) : null;
  if (lines && lines > 0) {
    points += lines * 2;
  }
  return Math.max(0, Math.round(points));
}

function calculateLeadPoints(lead) {
  const tariff = findTariffForLead(lead);
  if (tariff) {
    return calculateTariffPoints(tariff);
  }
  const text = `${lead?.tariffNombre || ''} ${lead?.notes || ''}`.toLowerCase();
  let points = 0;
  if (/fibra/.test(text)) {
    if (/(?:1000\s*mb|1\s*g(?:ig)?b|1\.0\s*g(?:ig)?b)/.test(text)) {
      points += 10;
    } else if (/(?:600\s*mb|0\.6\s*g(?:ig)?b)/.test(text)) {
      points += 6;
    } else if (/(?:300\s*mb|0\.3\s*g(?:ig)?b)/.test(text)) {
      points += 3;
    }
  }
  return Math.max(0, Math.round(points));
}

function grantInstallationPoints(lead) {
  if (!lead) return false;
  const username = lead.clientUsername || (lead.origin === CLIENT_ROLE ? lead.commercial : '');
  if (!username) return false;
  const client = getUserByUsername(username);
  if (!client) return false;
  ensureUserPointsStructure(client);
  const ledger = lead.pointsLedger && typeof lead.pointsLedger === 'object' ? lead.pointsLedger : {};
  lead.pointsLedger = {
    base: Number.isFinite(Number(ledger.base)) ? Number(ledger.base) : 0,
    referral: Number.isFinite(Number(ledger.referral)) ? Number(ledger.referral) : 0,
    awardedAt: ledger.awardedAt || null
  };
  if (lead.pointsLedger.base > 0 || lead.pointsLedger.referral > 0) return false;
  const totalPoints = calculateLeadPoints(lead);
  if (!totalPoints) return false;
  let basePoints = totalPoints;
  let referralPoints = 0;
  let inviter = null;
  if (lead.referredBy) {
    inviter = getUserByUsername(lead.referredBy);
    if (inviter) {
      ensureUserPointsStructure(inviter);
      referralPoints = Math.floor(totalPoints / 2);
      basePoints = totalPoints - referralPoints;
      if (basePoints < 0) basePoints = 0;
      if (referralPoints < 0) referralPoints = 0;
    }
  }
  let changed = false;
  if (basePoints > 0) {
    recordPointsMovement(client, basePoints, `Instalación ${lead.tariffCodigo || lead.tariffNombre || ''}`, { relatedId: lead.id, type: 'earned' });
    lead.pointsLedger.base = basePoints;
    changed = true;
  }
  if (inviter && referralPoints > 0) {
    if (!inviter.referrals.includes(client.username)) {
      inviter.referrals.push(client.username);
    }
    recordPointsMovement(inviter, referralPoints, `Plan amigo (${client.username})`, { relatedId: lead.id, type: 'earned' });
    lead.pointsLedger.referral = referralPoints;
    changed = true;
  }
  if (changed) {
    lead.pointsLedger.awardedAt = new Date().toISOString();
    saveUsers();
    updateSnapshotsAfterPointsChange(client, inviter);
  }
  return changed;
}

function revokeInstallationPoints(lead) {
  if (!lead || !lead.pointsLedger) return false;
  const username = lead.clientUsername || (lead.origin === CLIENT_ROLE ? lead.commercial : '');
  const client = username ? getUserByUsername(username) : null;
  const baseAmount = Number(lead.pointsLedger.base) || 0;
  const referralAmount = Number(lead.pointsLedger.referral) || 0;
  let inviter = null;
  let changed = false;
  if (client && baseAmount > 0) {
    recordPointsMovement(client, -baseAmount, `Ajuste instalación ${lead.tariffCodigo || lead.tariffNombre || ''}`, { relatedId: lead.id, type: 'spent' });
    lead.pointsLedger.base = 0;
    changed = true;
  }
  if (lead.referredBy && referralAmount > 0) {
    inviter = getUserByUsername(lead.referredBy);
    if (inviter) {
      recordPointsMovement(inviter, -referralAmount, `Ajuste plan amigo (${client ? client.username : 'cliente'})`, { relatedId: lead.id, type: 'spent' });
      changed = true;
    }
  }
  lead.pointsLedger.referral = 0;
  lead.pointsLedger.awardedAt = null;
  if (changed) {
    saveUsers();
    updateSnapshotsAfterPointsChange(client, inviter);
  }
  return changed;
}

function formatPoints(value) {
  return `${Math.max(0, Math.round(value || 0)).toLocaleString('es-ES')} pts`;
}

function formatInteger(value) {
  return Math.max(0, Math.round(Number(value) || 0)).toLocaleString('es-ES');
}

function formatPointsDelta(value) {
  const numeric = Math.round(Number(value) || 0);
  if (numeric > 0) {
    return `+${formatPoints(numeric)}`;
  }
  if (numeric < 0) {
    return `-${formatPoints(Math.abs(numeric))}`;
  }
  return formatPoints(0);
}

function isRewardActive(reward, referenceDate = todayISO()) {
  if (!reward || reward.archived) return false;
  if (reward.validFrom && reward.validFrom > referenceDate) return false;
  if (reward.validUntil && reward.validUntil < referenceDate) return false;
  return true;
}

function formatRewardValidity(reward) {
  if (!reward) return '';
  if (reward.validFrom && reward.validUntil) {
    return `Disponible del ${reward.validFrom} al ${reward.validUntil}`;
  }
  if (reward.validUntil) {
    return `Disponible hasta ${reward.validUntil}`;
  }
  if (reward.validFrom) {
    return `Disponible desde ${reward.validFrom}`;
  }
  return 'Disponibilidad abierta';
}

function getRewardStockState(reward) {
  if (!reward) return null;
  const total = typeof reward.totalUnits === 'number' && Number.isFinite(reward.totalUnits) && reward.totalUnits >= 0
    ? reward.totalUnits
    : null;
  if (total === null) return null;
  const consumed = Array.isArray(reward.requests) ? reward.requests.length : 0;
  const remaining = Math.max(0, total - consumed);
  return {
    total,
    consumed,
    remaining,
    outOfStock: remaining <= 0,
    lowStock: remaining > 0 && remaining < REWARD_LOW_STOCK_THRESHOLD
  };
}

function formatRewardStockBadge(reward) {
  const state = getRewardStockState(reward);
  if (!state) {
    return { markup: '', outOfStock: false, lowStock: false, text: '', className: '', state: null };
  }
  let text = '';
  let className = 'tag';
  if (state.outOfStock) {
    text = 'Sin stock';
    className = 'tag tag-error';
  } else if (state.lowStock) {
    text = `Quedan ${state.remaining} unidades`;
    className = 'tag tag-warning';
  } else {
    text = `${state.remaining} de ${state.total} unidades disponibles`;
  }
  return {
    markup: `<span class="${className}">${text}</span>`,
    outOfStock: state.outOfStock,
    lowStock: state.lowStock,
    text,
    className,
    state
  };
}

function populateReferralTariffs() {
  if (!referralTariffSelect) return;
  const options = tariffs
    .slice()
    .sort((a, b) => (a.nombre || '').localeCompare(b.nombre || '', 'es'))
    .map(item => `<option value="${item.id}">${item.nombre || item.codigo} · ${item.codigo}</option>`)
    .join('');
  referralTariffSelect.innerHTML = '<option value="">Selecciona un producto</option>' + options;
}

function resetReferralForm() {
  if (!referralForm) return;
  referralForm.reset();
  if (referralError) referralError.textContent = '';
}

function openReferralModal() {
  if (!currentUser || currentUser.role !== CLIENT_ROLE) return;
  populateReferralTariffs();
  resetReferralForm();
  if (!referralModal) return;
  referralModal.classList.remove('hidden');
  setTimeout(() => referralTariffSelect?.focus(), 50);
}

function closeReferralModal() {
  if (!referralModal) return;
  referralModal.classList.add('hidden');
  if (referralError) referralError.textContent = '';
}

function handleReferralSubmit(event) {
  event.preventDefault();
  if (!currentUser || currentUser.role !== CLIENT_ROLE) return;
  const tariffId = referralTariffSelect?.value;
  const tariff = tariffs.find(t => t.id === tariffId);
  if (!tariff) {
    if (referralError) referralError.textContent = 'Selecciona el producto que contratará tu amigo.';
    return;
  }
  const name = referralFriendNameInput?.value.trim() || '';
  const username = (referralFriendUsernameInput?.value.trim() || '').toLowerCase();
  const password = referralFriendPasswordInput?.value || '';
  const email = referralFriendEmailInput?.value.trim() || '';
  const phone = referralFriendPhoneInput?.value.trim() || '';
  const address = referralFriendAddressInput?.value.trim() || '';
  if (!name || !username || !password || !email || !phone || !address) {
    if (referralError) referralError.textContent = 'Completa todos los datos para crear el perfil de tu amigo.';
    return;
  }
  if (password.length < 6) {
    if (referralError) referralError.textContent = 'La contraseña debe tener al menos 6 caracteres.';
    return;
  }
  if (users.some(user => user.username === username)) {
    if (referralError) referralError.textContent = 'Ese usuario ya existe. Usa otro identificador.';
    return;
  }
  const emailLower = email.toLowerCase();
  if (emailLower && users.some(user => (user.email || '').toLowerCase() === emailLower)) {
    if (referralError) referralError.textContent = 'Ese correo ya está registrado en la plataforma.';
    return;
  }
  if (users.some(user => user.personalPhone === phone || user.companyPhone === phone)) {
    if (referralError) referralError.textContent = 'Ese teléfono ya está asociado a otro usuario.';
    return;
  }
  const parts = name.split(/\s+/);
  const firstName = parts.shift() || '';
  const lastName = parts.join(' ');
  const newUser = normaliseUser({
    username,
    password,
    role: CLIENT_ROLE,
    firstName,
    lastName,
    email,
    personalPhone: phone,
    address,
    referredBy: currentUser.username,
    selfRegistered: false
  });
  newUser.password = password;
  ensureUserPointsStructure(newUser);
  users.push(newUser);
  const inviterRecord = getUserByUsername(currentUser.username);
  if (inviterRecord) {
    ensureUserPointsStructure(inviterRecord);
    if (!inviterRecord.referrals.includes(newUser.username)) {
      inviterRecord.referrals.push(newUser.username);
    }
  }
  saveUsers();
  updateSnapshotsAfterPointsChange(inviterRecord);
  updateAvailableUsersHint();
  renderUserList();
  const displayName = userDisplayName(newUser) || newUser.username;
  const contact = [`Teléfono: ${phone}`, `Correo: ${email}`].join(' · ');
  const extraNotes = referralNotesInput?.value.trim();
  const noteParts = [`Dirección: ${address}`, `Invitado por ${userDisplayName(currentUser) || currentUser.username}`];
  if (extraNotes) noteParts.push(`Notas: ${extraNotes}`);
  const lead = {
    id: createId('lead'),
    tariffId,
    tariffCodigo: tariff.codigo,
    tariffNombre: tariff.nombre,
    tariffCompania: tariff['compañia'],
    commercial: newUser.username,
    commercialName: displayName,
    clientName: displayName,
    contact,
    notes: noteParts.join(' · '),
    status: 'pendiente',
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
    notified: true,
    origin: CLIENT_ROLE,
    installed: false,
    clientUsername: newUser.username,
    referredBy: currentUser.username,
    pointsLedger: { base: 0, referral: 0, awardedAt: null }
  };
  leads.push(lead);
  saveLeads();
  renderLeadSummary();
  renderAdminLeadList();
  renderCommercialPanel();
  renderTeamPanel();
  closeReferralModal();
  showCommercialFlash('¡Invitación enviada! Cuando se instale la tarifa recibirás tus puntos.');
}

function renderClientPlan() {
  if (!clientPlanSection) return;
  if (!currentUser || currentUser.role !== CLIENT_ROLE) {
    clientPlanSection.classList.add('hidden');
    return;
  }
  const record = getUserByUsername(currentUser.username) || currentUser;
  ensureUserPointsStructure(record);
  clientPlanSection.classList.remove('hidden');
  if (clientPointsBalance) {
    clientPointsBalance.innerHTML = `<span>Saldo disponible</span>${formatPoints(record.pointsBalance)}`;
  }
  renderClientRewards(record);
  renderClientPointsHistory(record);
}

function renderClientRewards(record) {
  if (!clientRewardsContainer) return;
  const today = todayISO();
  const active = rewards.filter(reward => isRewardActive(reward, today));
  if (!active.length) {
    clientRewardsContainer.innerHTML = '<div class="empty-state">Pronto añadiremos recompensas para canjear con tus puntos.</div>';
    return;
  }
  const balance = record.pointsBalance || 0;
  clientRewardsContainer.innerHTML = active
    .sort((a, b) => a.pointsCost - b.pointsCost)
    .map(reward => {
      const userRequests = reward.requests.filter(entry => entry.username === record.username);
      const pending = userRequests.filter(entry => entry.status !== 'entregado');
      const delivered = userRequests.filter(entry => entry.status === 'entregado');
      const hasPending = pending.length > 0;
      const unlocked = balance >= reward.pointsCost;
      const imageMarkup = reward.imageUrl
        ? `<figure class="reward-thumb"><img src="${escapeHtml(reward.imageUrl)}" alt="Imagen de ${escapeHtml(reward.title)}" loading="lazy" /></figure>`
        : '<figure class="reward-thumb placeholder"><span>Sin imagen</span></figure>';
      const statusParts = [];
      if (pending.length) statusParts.push(`${pending.length} pendiente${pending.length !== 1 ? 's' : ''}`);
      if (delivered.length) statusParts.push(`${delivered.length} entregada${delivered.length !== 1 ? 's' : ''}`);
      const statusText = statusParts.length ? statusParts.join(' · ') : 'Sin canjear';
      const stockBadge = formatRewardStockBadge(reward);
      const cardClasses = ['reward-card'];
      const outOfStock = stockBadge.outOfStock;
      if (unlocked && !outOfStock) {
        cardClasses.push('unlocked');
      } else {
        cardClasses.push('locked');
      }
      if (outOfStock) {
        cardClasses.push('out-of-stock');
      }
      const cardClass = cardClasses.join(' ');
      let actionButton = `<button type="button" class="smallbtn" disabled>Necesitas ${reward.pointsCost} pts</button>`;
      if (outOfStock) {
        actionButton = '<button type="button" class="smallbtn" disabled>Sin stock</button>';
      } else if (unlocked && !hasPending) {
        actionButton = `<button type="button" class="primary" data-action="redeem-reward" data-id="${reward.id}">Canjear por ${reward.pointsCost} pts</button>`;
      } else if (hasPending) {
        actionButton = '<button type="button" class="smallbtn" disabled>Solicitud en curso</button>';
      }
      const description = reward.description ? `<p class="dim">${reward.description}</p>` : '';
      const statusPieces = [];
      if (stockBadge.markup && (stockBadge.outOfStock || stockBadge.lowStock)) {
        statusPieces.push(stockBadge.markup);
      }
      if (statusText) statusPieces.push(`<span>${statusText}</span>`);
      const statusMarkup = statusPieces.length
        ? `<div class="reward-status">${statusPieces.join('')}</div>`
        : '';
      return `
        <div class="${cardClass}" data-id="${reward.id}">
          ${imageMarkup}
          <div class="title">${reward.title}</div>
          <div class="cost">${formatPoints(reward.pointsCost)}</div>
          <div class="validity">${formatRewardValidity(reward)}</div>
          ${description}
          ${statusMarkup}
          <div class="actions">${actionButton}</div>
        </div>
      `;
    })
    .join('');
}

function renderClientPointsHistory(record) {
  if (!clientPointsHistory || !clientPointsHistoryList) return;
  ensureUserPointsStructure(record);
  const history = record.pointsHistory.slice(0, 20);
  clientPointsHistory.classList.remove('hidden');
  if (!history.length) {
    clientPointsHistoryList.innerHTML = '<li class="empty">Aún no hay movimientos de puntos.</li>';
    return;
  }
  clientPointsHistoryList.innerHTML = history
    .map(entry => {
      const amount = Math.round(entry.amount || 0);
      const statusClass = entry.type === 'spent' || amount < 0 ? 'spent' : 'earned';
      const amountLabel = `${amount > 0 ? '+' : ''}${amount} pts`;
      const concept = entry.concept || 'Movimiento de puntos';
      return `<li class="${statusClass}"><div class="meta"><strong>${amountLabel}</strong><span>${concept}</span></div><span>${formatDateTime(entry.createdAt)}</span></li>`;
    })
    .join('');
}

function handleClientRewardAction(event) {
  const button = event.target.closest('button[data-action="redeem-reward"]');
  if (!button) return;
  event.preventDefault();
  const rewardId = button.dataset.id;
  if (!rewardId) return;
  handleRewardRedemption(rewardId);
}

function handleRewardRedemption(rewardId) {
  if (!currentUser || currentUser.role !== CLIENT_ROLE) return;
  const reward = rewards.find(item => item.id === rewardId);
  if (!reward) return;
  const record = getUserByUsername(currentUser.username);
  if (!record) return;
  ensureUserPointsStructure(record);
  const stockState = getRewardStockState(reward);
  if (stockState?.outOfStock) {
    showCommercialFlash('Esta recompensa está sin stock por el momento.');
    return;
  }
  if (record.pointsBalance < reward.pointsCost) {
    showCommercialFlash('Todavía no tienes puntos suficientes para esta recompensa.');
    return;
  }
  const pending = reward.requests.filter(entry => entry.username === record.username && entry.status !== 'entregado');
  if (pending.length) {
    showCommercialFlash('Ya tienes una solicitud pendiente de esta recompensa.');
    return;
  }
  recordPointsMovement(record, -reward.pointsCost, `Canje de recompensa: ${reward.title}`, { relatedId: reward.id, type: 'spent' });
  reward.requests.push({
    id: createId('rewardreq'),
    username: record.username,
    status: 'pendiente',
    points: reward.pointsCost,
    requestedAt: new Date().toISOString(),
    deliveredAt: null
  });
  reward.updatedAt = new Date().toISOString();
  saveUsers();
  saveRewards();
  updateSnapshotsAfterPointsChange(record);
  renderAdminRewards();
  renderClientPlan();
  showCommercialFlash('¡Recompensa solicitada! El equipo la gestionará muy pronto.');
}

function renderAdminRewards() {
  if (!rewardList) return;
  if (!rewards.length) {
    rewardList.innerHTML = '<div class="empty-state">Aún no has creado recompensas para el plan amigo.</div>';
    return;
  }
  const today = todayISO();
  rewardList.innerHTML = rewards
    .slice()
    .sort((a, b) => a.pointsCost - b.pointsCost)
    .map(reward => {
      const active = isRewardActive(reward, today);
      const total = reward.requests.length;
      const pending = reward.requests.filter(entry => entry.status !== 'entregado').length;
      const stockBadge = formatRewardStockBadge(reward);
      const requestsSummary = total
        ? `${total} solicitud${total !== 1 ? 'es' : ''} (${pending} pendiente${pending !== 1 ? 's' : ''})`
        : 'Sin solicitudes por ahora';
      const description = reward.description ? `<p class="dim">${reward.description}</p>` : '';
      const imageMarkup = reward.imageUrl
        ? `<figure class="reward-thumb"><img src="${escapeHtml(reward.imageUrl)}" alt="Imagen de ${escapeHtml(reward.title)}" loading="lazy" /></figure>`
        : '<figure class="reward-thumb placeholder"><span>Sin imagen</span></figure>';
      const requestsMarkup = total
        ? `<div class="requests-list">${reward.requests
            .slice()
            .sort((a, b) => new Date(b.requestedAt) - new Date(a.requestedAt))
            .map(request => {
              const userRecord = getUserByUsername(request.username);
              const name = userDisplayName(userRecord) || request.username;
              const statusTag = request.status === 'entregado'
                ? '<span class="tag tag-success">Entregado</span>'
                : '<span class="tag tag-warning">Pendiente</span>';
              const actionButton = request.status === 'entregado'
                ? `<button class="smallbtn" data-action="undo-delivery" data-reward="${reward.id}" data-request="${request.id}">Marcar pendiente</button>`
                : `<button class="smallbtn" data-action="deliver-reward" data-reward="${reward.id}" data-request="${request.id}">Marcar entregado</button>`;
              const delivered = request.deliveredAt ? `<span>Entregado: ${formatDateTime(request.deliveredAt)}</span>` : '';
              return `
                <div class="request-item" data-reward="${reward.id}" data-request="${request.id}">
                  <div class="info">
                    <strong>${name}</strong>
                    <span>Canjeó ${formatPoints(request.points || reward.pointsCost)}</span>
                    <span>Solicitado: ${formatDateTime(request.requestedAt)}</span>
                    ${delivered}
                  </div>
                  <div class="actions">
                    ${statusTag}
                    ${actionButton}
                  </div>
                </div>
              `;
            }).join('')}</div>`
        : '<div class="empty-state">Nadie ha solicitado esta recompensa todavía.</div>';
      const cardClasses = ['reward-card'];
      const outOfStock = stockBadge.outOfStock;
      if (active && !outOfStock) {
        cardClasses.push('unlocked');
      } else {
        cardClasses.push('locked');
      }
      if (outOfStock) {
        cardClasses.push('out-of-stock');
      }
      const cardClass = cardClasses.join(' ');
      const statusPieces = [];
      if (stockBadge.markup) statusPieces.push(stockBadge.markup);
      if (requestsSummary) statusPieces.push(`<span>${requestsSummary}</span>`);
      const statusMarkup = statusPieces.length
        ? `<div class="reward-status">${statusPieces.join('')}</div>`
        : '';
      return `
        <div class="${cardClass}" data-id="${reward.id}">
          ${imageMarkup}
          <div class="title">${reward.title}</div>
          <div class="cost">${formatPoints(reward.pointsCost)}</div>
          <div class="validity">${formatRewardValidity(reward)}</div>
          ${description}
          ${statusMarkup}
          <div class="actions">
            <button class="smallbtn" data-action="edit-reward" data-id="${reward.id}">Editar</button>
            <button class="smallbtn danger" data-action="delete-reward" data-id="${reward.id}">Eliminar</button>
          </div>
          ${requestsMarkup}
        </div>
      `;
    })
    .join('');
}

function rewardImageValueIsPreviewable(value) {
  return /^https?:\/\//i.test(value) || /^data:image\//i.test(value);
}

function refreshRewardImagePreview(value) {
  if (!rewardImageDropzone) return;
  const placeholder = rewardImageDropzone.querySelector('.upload-placeholder');
  const previewValue = value && rewardImageValueIsPreviewable(value) ? value : '';
  if (previewValue) {
    rewardImageDropzone.classList.add('has-image');
    if (rewardImagePreview) {
      rewardImagePreview.src = previewValue;
      rewardImagePreview.classList.remove('hidden');
    }
    placeholder?.classList.add('hidden');
    rewardImageClearBtn?.classList.remove('hidden');
    rewardImageActions?.classList.remove('hidden');
  } else {
    rewardImageDropzone.classList.remove('has-image');
    if (rewardImagePreview) {
      rewardImagePreview.src = '';
      rewardImagePreview.classList.add('hidden');
    }
    placeholder?.classList.remove('hidden');
    rewardImageClearBtn?.classList.add('hidden');
    rewardImageActions?.classList.add('hidden');
  }
}

function setRewardImageValue(value) {
  if (rewardImageInput) {
    rewardImageInput.value = value || '';
  }
  refreshRewardImagePreview(value || '');
  if (rewardImageFileInput) {
    rewardImageFileInput.value = '';
  }
}

function resetRewardImageField() {
  setRewardImageValue('');
}

function handleRewardImageFile(file) {
  if (!file) return;
  if (!file.type?.startsWith('image/')) {
    if (rewardFormInfo) rewardFormInfo.textContent = 'Solo se permiten archivos de imagen.';
    return;
  }
  const reader = new FileReader();
  reader.onload = () => {
    const result = reader.result;
    if (typeof result === 'string') {
      setRewardImageValue(result);
      if (rewardFormInfo) rewardFormInfo.textContent = 'Imagen cargada desde tu equipo.';
    }
  };
  reader.onerror = () => {
    if (rewardFormInfo) rewardFormInfo.textContent = 'No se pudo leer la imagen seleccionada.';
  };
  reader.readAsDataURL(file);
}

function setupRewardImageUploader() {
  if (!rewardImageDropzone) return;
  const preventDefaults = (event) => {
    event.preventDefault();
    event.stopPropagation();
  };
  ['dragenter', 'dragover'].forEach(eventName => {
    rewardImageDropzone.addEventListener(eventName, (event) => {
      preventDefaults(event);
      rewardImageDropzone.classList.add('dragover');
    });
  });
  ['dragleave', 'dragend'].forEach(eventName => {
    rewardImageDropzone.addEventListener(eventName, (event) => {
      preventDefaults(event);
      if (eventName === 'dragleave') {
        const related = event.relatedTarget;
        if (related && rewardImageDropzone.contains(related)) {
          return;
        }
      }
      rewardImageDropzone.classList.remove('dragover');
    });
  });
  rewardImageDropzone.addEventListener('drop', (event) => {
    preventDefaults(event);
    rewardImageDropzone.classList.remove('dragover');
    const file = event.dataTransfer?.files?.[0];
    if (file) {
      handleRewardImageFile(file);
    }
  });
  rewardImageDropzone.addEventListener('click', () => {
    rewardImageFileInput?.click();
  });
  rewardImageDropzone.addEventListener('keydown', (event) => {
    if (event.key === 'Enter' || event.key === ' ') {
      event.preventDefault();
      rewardImageFileInput?.click();
    }
  });
  rewardImageFileInput?.addEventListener('change', () => {
    const file = rewardImageFileInput.files?.[0];
    if (file) {
      handleRewardImageFile(file);
    }
  });
  rewardImageClearBtn?.addEventListener('click', () => {
    resetRewardImageField();
    if (rewardFormInfo) rewardFormInfo.textContent = 'Se eliminó la imagen asociada.';
  });
  rewardImageInput?.addEventListener('input', () => {
    const value = rewardImageInput.value.trim();
    refreshRewardImagePreview(value);
  });
  refreshRewardImagePreview(rewardImageInput?.value.trim() || '');
}

function resetRewardForm() {
  rewardForm?.reset();
  if (rewardIdInput) rewardIdInput.value = '';
  if (rewardUnitsInput) rewardUnitsInput.value = '';
  if (rewardFormInfo) rewardFormInfo.textContent = '';
  resetRewardImageField();
}

function fillRewardForm(reward) {
  if (!reward) return;
  if (rewardIdInput) rewardIdInput.value = reward.id;
  if (rewardTitleInput) rewardTitleInput.value = reward.title;
  if (rewardPointsInput) rewardPointsInput.value = reward.pointsCost;
  if (rewardUnitsInput) rewardUnitsInput.value = reward.totalUnits ?? '';
  if (rewardValidFromInput) rewardValidFromInput.value = reward.validFrom || '';
  if (rewardValidUntilInput) rewardValidUntilInput.value = reward.validUntil || '';
  setRewardImageValue(reward.imageUrl || '');
  if (rewardDescriptionInput) rewardDescriptionInput.value = reward.description || '';
  if (rewardFormInfo) rewardFormInfo.textContent = 'Editando recompensa existente.';
}

function handleRewardFormSubmit(event) {
  event.preventDefault();
  if (!rewardForm) return;
  const title = rewardTitleInput?.value.trim();
  const pointsValue = Number(rewardPointsInput?.value || 0);
  const unitsRaw = (rewardUnitsInput?.value ?? '').trim();
  let totalUnits = null;
  const imageUrl = rewardImageInput?.value.trim() || '';
  if (unitsRaw) {
    const parsedUnits = Number.parseInt(unitsRaw, 10);
    if (!Number.isFinite(parsedUnits) || parsedUnits < 0) {
      if (rewardFormInfo) rewardFormInfo.textContent = 'Las unidades deben ser un número igual o mayor que cero.';
      return;
    }
    totalUnits = parsedUnits;
  }
  if (imageUrl && !rewardImageValueIsPreviewable(imageUrl)) {
    if (rewardFormInfo) rewardFormInfo.textContent = 'La imagen debe ser una URL válida o un archivo de imagen.';
    return;
  }
  if (!title) {
    if (rewardFormInfo) rewardFormInfo.textContent = 'Indica un nombre para la recompensa.';
    return;
  }
  if (!Number.isFinite(pointsValue) || pointsValue <= 0) {
    if (rewardFormInfo) rewardFormInfo.textContent = 'El coste debe ser un número positivo.';
    return;
  }
  const existingId = rewardIdInput?.value || '';
  const now = new Date().toISOString();
  if (existingId) {
    const existing = rewards.find(item => item.id === existingId);
    if (!existing) {
      if (rewardFormInfo) rewardFormInfo.textContent = 'No se encontró la recompensa a editar.';
      return;
    }
    existing.title = title;
    existing.pointsCost = Math.round(pointsValue);
    existing.description = rewardDescriptionInput?.value.trim() || '';
    existing.validFrom = rewardValidFromInput?.value || '';
    existing.validUntil = rewardValidUntilInput?.value || '';
    existing.imageUrl = imageUrl;
    existing.totalUnits = totalUnits;
    existing.updatedAt = now;
    if (rewardFormInfo) rewardFormInfo.textContent = 'Recompensa actualizada correctamente.';
  } else {
    const reward = {
      id: createId('reward'),
      title,
      pointsCost: Math.round(pointsValue),
      description: rewardDescriptionInput?.value.trim() || '',
      imageUrl,
      totalUnits,
      validFrom: rewardValidFromInput?.value || '',
      validUntil: rewardValidUntilInput?.value || '',
      createdAt: now,
      updatedAt: now,
      archived: false,
      requests: []
    };
    rewards.push(reward);
    if (rewardFormInfo) rewardFormInfo.textContent = 'Recompensa creada correctamente.';
  }
  saveRewards();
  renderAdminRewards();
  renderClientPlan();
  resetRewardForm();
}

function handleRewardListAction(event) {
  const button = event.target.closest('button[data-action]');
  if (!button) return;
  const action = button.dataset.action;
  const rewardId = button.dataset.reward || button.dataset.id;
  if (!action || !rewardId) return;
  const reward = rewards.find(item => item.id === rewardId);
  if (!reward) return;
  if (action === 'edit-reward') {
    fillRewardForm(reward);
    window.scrollTo({ top: rewardForm?.offsetTop || 0, behavior: 'smooth' });
    return;
  }
  if (action === 'delete-reward') {
    if (!confirm('¿Eliminar esta recompensa y todas sus solicitudes?')) return;
    rewards = rewards.filter(item => item.id !== rewardId);
    saveRewards();
    renderAdminRewards();
    renderClientPlan();
    if (rewardFormInfo) rewardFormInfo.textContent = 'Recompensa eliminada.';
    return;
  }
  const requestId = button.dataset.request;
  if (!requestId) return;
  const request = reward.requests.find(entry => entry.id === requestId);
  if (!request) return;
  if (action === 'deliver-reward') {
    request.status = 'entregado';
    request.deliveredAt = new Date().toISOString();
    saveRewards();
    renderAdminRewards();
    renderClientPlan();
    return;
  }
  if (action === 'undo-delivery') {
    request.status = 'pendiente';
    request.deliveredAt = null;
    saveRewards();
    renderAdminRewards();
    renderClientPlan();
  }
}

function loadSessionUser() {
  try {
    const raw = sessionStorage.getItem(STORAGE_KEYS.session);
    if (raw) {
      const parsed = JSON.parse(raw);
      if (parsed && parsed.username) {
        return parsed;
      }
    }
  } catch (error) {
    console.warn('No se pudo restaurar la sesión', error);
  }
  return null;
}

function persistSessionUser(user) {
  try {
    if (user?.username) {
      sessionStorage.setItem(STORAGE_KEYS.session, JSON.stringify({ username: user.username }));
    } else {
      sessionStorage.removeItem(STORAGE_KEYS.session);
    }
  } catch (error) {
    console.warn('No se pudo actualizar la sesión', error);
  }
}

function roleLabel(role) {
  return ROLE_LABELS[role] || role;
}

function handleStorageEvent(event) {
  if (!event) return;
  if (event.storageArea && event.storageArea !== localStorage) return;
  if (event.key === STORAGE_KEYS.tariffs) {
    tariffs = loadTariffsFromStorage();
    aplicarFiltros();
    if (currentUser?.role === 'admin') {
      renderTariffTable();
    }
    populateReferralTariffs();
    populateAiFiberOptions();
    if (aiLastQuery) {
      runAiSearch(aiLastQuery, { preserveFormState: true });
    }
  }
  if (event.key === STORAGE_KEYS.leads) {
    leads = loadLeadsFromStorage();
    renderLeadSummary();
    renderAdminLeadList();
    renderCommercialPanel();
    renderTeamPanel();
  }
  if (event.key === STORAGE_KEYS.rewards) {
    rewards = loadRewardsFromStorage();
    renderAdminRewards();
    renderCommercialPanel();
  }
  if (event.key === STORAGE_KEYS.notifications) {
    notifications = loadNotificationsFromStorage();
    renderNotifications();
  }
  if (event.key === STORAGE_KEYS.callRequests) {
    callRequests = loadCallRequestsFromStorage();
    renderCallRequestInbox();
  }
  if (event.key === STORAGE_KEYS.customBudgets) {
    customBudgets = loadCustomBudgetsFromStorage();
    renderCustomBudgetInbox();
  }
  if (event.key === STORAGE_KEYS.users) {
    users = loadUsersFromStorage();
    updateAvailableUsersHint();
    renderUserList();
    if (currentUser) {
      const updated = getUserByUsername(currentUser.username);
      if (updated) {
        setCurrentUser(buildUserSnapshot(updated), { persist: false });
      } else {
        logout();
      }
    } else {
      updateUserInfo();
    }
  }
}

function iconSVG(kind) {
  if (kind === 'euro') return `<svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17 5c-4.418 0-8 3.582-8 8s3.582 8 8 8" stroke="currentColor" stroke-width="2"/><path d="M3 10h8M3 14h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>`;
  if (kind === 'calendar') return `<svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="5" width="18" height="16" rx="2" stroke="currentColor" stroke-width="2"/><path d="M16 3v4M8 3v4M3 10h18" stroke="currentColor" stroke-width="2"/></svg>`;
  if (kind === 'sim') return `<svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 3h7l5 5v11a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z" stroke="currentColor" stroke-width="2"/><path d="M7 12h10M7 16h10M7 8h6" stroke="currentColor" stroke-width="2"/></svg>`;
  if (kind === 'company') return `<svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 21V7l9-4 9 4v14" stroke="currentColor" stroke-width="2"/><path d="M9 21V9h6v12" stroke="currentColor" stroke-width="2"/></svg>`;
  if (kind === 'tv') return `<svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="5" width="18" height="13" rx="2" stroke="currentColor" stroke-width="2"/><path d="M8 21h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M10 17l-2 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M14 17l2 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>`;
  return '';
}

function inVigencia(item, fecha) {
  const d = (s) => (s ? new Date(s) : null);
  const f = new Date(fecha);
  const desde = d(item.vigente_desde), hasta = d(item.vigente_hasta);
  if (desde && f < desde) return false;
  if (hasta && f > hasta) return false;
  return true;
}

function euro(n, moneda) {
  if (n === null || n === undefined || Number.isNaN(n)) return '-';
  try {
    return new Intl.NumberFormat('es-ES', { style: 'currency', currency: moneda || 'EUR' }).format(n);
  } catch (error) {
    return `${n} ${moneda || 'EUR'}`;
  }
}

function slugify(value) {
  return String(value || '')
    .toLowerCase()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '')
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/^-+|-+$/g, '') || 'general';
}

function sortTariffsForDisplay(list) {
  return list
    .slice()
    .sort((a, b) => {
      if (a.destacada !== b.destacada) return a.destacada ? -1 : 1;
      const companyCompare = (a['compañia'] || '').localeCompare(b['compañia'] || '', 'es');
      if (companyCompare !== 0) return companyCompare;
      return (a.nombre || '').localeCompare(b.nombre || '', 'es');
    });
}

function buildTariffCard(item) {
  const tile = document.createElement('div');
  tile.className = `tile tariff-card${item.destacada ? ' featured' : ''}`;
  tile.dataset.tariffId = item.id;
  const precio = item.precio != null ? euro(item.precio, item.moneda) : '-';
  const safePrice = escapeHtml(precio);
  const typeCode = escapeHtml(item.tipo || '-');
  const typeLabel = escapeHtml(TARIFF_TYPE_LABELS[item.tipo] || 'Producto');
  const companyLabel = escapeHtml(item['compañia'] || 'Sin compañía');
  const linesValue = item.lineas != null ? escapeHtml(String(item.lineas)) : '';
  const lineBadgeText = linesValue ? `${linesValue} líneas` : 'Líneas flexibles';
  const vigenciaInicio = escapeHtml(item.vigente_desde || '-');
  const vigenciaFin = escapeHtml(item.vigente_hasta || '-');
  const permanenciaText = escapeHtml(item.permanencia || 'No indicada');
  const descripcion = escapeHtml(item['descripción'] || 'Esta tarifa no tiene descripción guardada.');
  const safeName = escapeHtml(item.nombre || 'Tarifa sin nombre');
  const safeCode = escapeHtml(item.codigo || '-');
  const moneda = escapeHtml(item.moneda || 'EUR');
  const platforms = Array.isArray(item.plataformas) ? item.plataformas.filter(Boolean) : [];
  const platformsBadge = platforms.length ? `<span class="badge">${iconSVG('tv')} ${escapeHtml(platforms.join(', '))}</span>` : '';
  tile.innerHTML = `
      <div class="tariff-card-header">
        <div class="tariff-card-heading">
          <h3 class="tariff-card-name">${safeName}</h3>
          <div class="tariff-card-code">Código comercial: <strong>${safeCode}</strong></div>
        </div>
        <div class="tariff-card-price">
          <span class="tariff-card-amount">${safePrice}</span>
          <span class="tariff-card-period">/ mes</span>
        </div>
      </div>
      <div class="tariff-card-tags">
        <span class="badge badge-type">${typeCode} · ${typeLabel}</span>
        <span class="badge">${iconSVG('company')} ${companyLabel}</span>
        <span class="badge">${iconSVG('sim')} ${lineBadgeText}</span>
        <span class="badge">${iconSVG('calendar')} Vigente: ${vigenciaInicio} → ${vigenciaFin}</span>
        ${platformsBadge}
      </div>
      <p class="tariff-card-description">${descripcion}</p>
      <div class="tariff-card-meta-grid">
        <div class="tariff-card-meta-item">
          <span class="tariff-detail-label">Permanencia</span>
          <strong>${permanenciaText}</strong>
        </div>
        <div class="tariff-card-meta-item">
          <span class="tariff-detail-label">Líneas incluidas</span>
          <strong>${linesValue || 'Flexible'}</strong>
          <span class="tariff-detail-note">Moneda ${moneda}</span>
        </div>
        <div class="tariff-card-meta-item">
          <span class="tariff-detail-label">Vigencia</span>
          <strong>${vigenciaInicio}</strong>
          <span class="tariff-detail-note">${vigenciaFin}</span>
        </div>
      </div>
    `;
  const actions = document.createElement('div');
  actions.className = 'tile-actions';
  if (!currentUser) {
    const requestBtn = document.createElement('button');
    requestBtn.className = 'smallbtn';
    requestBtn.textContent = 'Solicitar tarifa';
    requestBtn.addEventListener('click', () => openRequestModal(item));
    actions.appendChild(requestBtn);
  }
  if (currentUser && (currentUser.role === 'comercial' || currentUser.role === 'lider' || currentUser.role === CLIENT_ROLE)) {
    const leadBtn = document.createElement('button');
    leadBtn.className = 'primary';
    leadBtn.textContent = 'Enviar propuesta';
    leadBtn.addEventListener('click', () => openLeadModal(item));
    actions.appendChild(leadBtn);
  }
  if (currentUser?.role === 'admin') {
    const editBtn = document.createElement('button');
    editBtn.className = 'smallbtn';
    editBtn.textContent = 'Editar';
    editBtn.addEventListener('click', () => {
      prefillTariffForm(item);
      const targetTop = tarifaForm?.offsetTop || adminPanel?.offsetTop || 0;
      window.scrollTo({ top: targetTop, behavior: 'smooth' });
    });
    actions.appendChild(editBtn);
  }
  if (actions.children.length) {
    tile.appendChild(actions);
  }
  return tile;
}

function renderTariffGrid(data) {
  if (!grid) return;
  lastRenderedTariffs = data.slice();
  grid.innerHTML = '';
  if (!data.length) {
    const empty = document.createElement('div');
    empty.className = 'tile';
    empty.style.gridColumn = '1 / -1';
    empty.innerHTML = `<div class="title">Sin resultados</div><p class="dim">No hay tarifas que coincidan con los filtros seleccionados.</p>`;
    grid.appendChild(empty);
    if (countEl) countEl.textContent = '0';
    return;
  }
  const sorted = sortTariffsForDisplay(data);
  const hasFeatured = sorted.some(item => item.destacada);
  const companies = uniq(sorted.map(item => item['compañia'] ? item['compañia'] : 'Sin compañía'))
    .map(name => ({ name, label: name, slug: slugify(name) }))
    .sort((a, b) => a.label.localeCompare(b.label, 'es'));
  const tabButtons = [{ id: 'destacadas', label: 'Destacadas' }];
  companies.forEach(entry => tabButtons.push({ id: `company-${entry.slug}`, label: entry.label, company: entry.name }));
  tabButtons.push({ id: 'todas', label: 'Todas las tarifas' });
  const validTabIds = tabButtons.map(btn => btn.id);
  if (!validTabIds.includes(clientTariffTab)) {
    clientTariffTab = hasFeatured
      ? 'destacadas'
      : companies.length
        ? `company-${companies[0].slug}`
        : 'todas';
  }

  const wrapper = document.createElement('div');
  wrapper.className = 'tariff-layout';

  const nav = document.createElement('div');
  nav.className = 'tariff-jumps';
  nav.innerHTML = `
    <button type="button" data-tariff-jump="section-fibra">Solo fibra</button>
    <button type="button" data-tariff-jump="section-movil">Solo móvil</button>
    <button type="button" data-tariff-jump="section-convergente">Fibra y móvil</button>
  `;
  wrapper.appendChild(nav);

  const tabContainer = document.createElement('div');
  tabContainer.className = 'tariff-client-tabs';
  tabContainer.innerHTML = tabButtons
    .map(btn => `<button type="button" class="tariff-tab-btn${clientTariffTab === btn.id ? ' active' : ''}" data-client-tab="${btn.id}">${btn.label}</button>`)
    .join('');
  wrapper.appendChild(tabContainer);

  const panels = document.createElement('div');
  panels.className = 'tariff-panels';

  const appendPanel = (id, panel) => {
    panel.dataset.panelId = id;
    if (clientTariffTab === id) panel.classList.add('active');
    panels.appendChild(panel);
  };

  const featuredPanel = document.createElement('div');
  featuredPanel.className = 'tariff-company-panel grid-layout';
  const featuredItems = sortTariffsForDisplay(sorted.filter(item => item.destacada));
  if (!featuredItems.length) {
    featuredPanel.classList.add('empty');
    featuredPanel.innerHTML = '<p class="dim">No hay tarifas destacadas disponibles.</p>';
  } else {
    featuredItems.forEach(item => featuredPanel.appendChild(buildTariffCard(item)));
  }
  appendPanel('destacadas', featuredPanel);

  companies.forEach(entry => {
    const panel = document.createElement('div');
    panel.className = 'tariff-company-panel grid-layout';
    const items = sortTariffsForDisplay(sorted.filter(item => (item['compañia'] ? item['compañia'] : 'Sin compañía') === entry.name));
    if (!items.length) {
      panel.classList.add('empty');
      panel.innerHTML = `<p class="dim">No hay tarifas registradas para ${entry.label}.</p>`;
    } else {
      items.forEach(item => panel.appendChild(buildTariffCard(item)));
    }
    appendPanel(`company-${entry.slug}`, panel);
  });

  const sectionsPanel = document.createElement('div');
  sectionsPanel.className = 'tariff-company-panel';
  const sections = [
    { id: 'section-fibra', label: 'Solo fibra', description: 'Incluye todas las tarifas tipo F disponibles.', types: ['F'] },
    { id: 'section-movil', label: 'Solo móvil', description: 'Incluye tarifas tipo M, N y P.', types: ['M', 'N', 'P'] },
    { id: 'section-convergente', label: 'Fibra y móvil', description: 'Incluye todas las tarifas tipo C.', types: ['C'] }
  ];
  sections.forEach(section => {
    const sectionEl = document.createElement('section');
    sectionEl.className = 'tariff-type-section';
    sectionEl.id = section.id;
    sectionEl.innerHTML = `<h3>${section.label}</h3><p class="section-description">${section.description}</p>`;
    const items = sortTariffsForDisplay(sorted.filter(item => section.types.includes(item.tipo)));
    if (!items.length) {
      const empty = document.createElement('p');
      empty.className = 'dim';
      empty.textContent = 'No hay tarifas disponibles en este grupo ahora mismo.';
      sectionEl.appendChild(empty);
    } else {
      const gridContainer = document.createElement('div');
      gridContainer.className = 'tariff-card-grid';
      items.forEach(item => gridContainer.appendChild(buildTariffCard(item)));
      sectionEl.appendChild(gridContainer);
    }
    sectionsPanel.appendChild(sectionEl);
  });
  appendPanel('todas', sectionsPanel);

  wrapper.appendChild(panels);
  grid.appendChild(wrapper);
  if (countEl) countEl.textContent = String(data.length);
  if (pendingTariffScrollTarget) {
    const target = grid.querySelector(`#${pendingTariffScrollTarget}`);
    if (target) {
      requestAnimationFrame(() => target.scrollIntoView({ behavior: 'smooth', block: 'start' }));
    }
    pendingTariffScrollTarget = '';
  }
}

function aplicarFiltros() {
  const sorted = sortTariffsForDisplay(tariffs);
  renderTariffGrid(sorted);
}

function resetTariffForm(options = {}) {
  if (!tarifaForm) return;
  tarifaForm.reset();
  if (tarifaPlataformasInput) tarifaPlataformasInput.value = '';
  editingTariffId = null;
  if (tarifaMoneda) tarifaMoneda.value = tarifaMoneda.getAttribute('value') || 'EUR';
  if (tarifaTipo) tarifaTipo.value = 'C';
  if (tarifaDestacadaInput) tarifaDestacadaInput.checked = false;
  if (!options.keepMessage && tarifaFormInfo) tarifaFormInfo.textContent = '';
  if (guardarTarifaBtn) guardarTarifaBtn.textContent = 'Guardar tarifa';
}

function prefillTariffForm(tariff) {
  if (!tarifaForm) return;
  editingTariffId = tariff.id;
  if (tarifaCodigo) tarifaCodigo.value = tariff.codigo || '';
  if (tarifaNombre) tarifaNombre.value = tariff.nombre || '';
  if (tarifaCompania) tarifaCompania.value = tariff['compañia'] || '';
  if (tarifaTipo) tarifaTipo.value = (tariff.tipo && TARIFF_TYPE_ORDER.includes(tariff.tipo) ? tariff.tipo : detectTariffType(tariff)) || 'C';
  if (tarifaLineas) tarifaLineas.value = tariff.lineas != null ? tariff.lineas : '';
  if (tarifaPrecio) tarifaPrecio.value = tariff.precio != null ? tariff.precio : '';
  if (tarifaMoneda) tarifaMoneda.value = tariff.moneda || 'EUR';
  if (tarifaPermanencia) tarifaPermanencia.value = tariff.permanencia || '';
  if (tarifaDesde) tarifaDesde.value = tariff.vigente_desde || '';
  if (tarifaHasta) tarifaHasta.value = tariff.vigente_hasta || '';
  if (tarifaDescripcion) tarifaDescripcion.value = tariff['descripción'] || '';
  if (tarifaPlataformasInput) tarifaPlataformasInput.value = Array.isArray(tariff.plataformas) ? tariff.plataformas.join(', ') : '';
  if (tarifaDestacadaInput) tarifaDestacadaInput.checked = Boolean(tariff.destacada);
  if (guardarTarifaBtn) guardarTarifaBtn.textContent = 'Actualizar tarifa';
  if (tarifaFormInfo) tarifaFormInfo.textContent = `Editando la tarifa «${tariff.nombre}».`;
}

function handleTarifaFormSubmit(event) {
  event.preventDefault();
  if (!tarifaForm) return;
  const entry = normaliseTariff({
    id: editingTariffId || createId('tarifa'),
    codigo: tarifaCodigo?.value.trim() || '',
    nombre: tarifaNombre?.value.trim() || '',
    precio: tarifaPrecio?.value !== '' ? Number(tarifaPrecio.value) : null,
    'compañia': tarifaCompania?.value.trim() || '',
    tipo: tarifaTipo?.value || 'C',
    moneda: tarifaMoneda?.value.trim() || 'EUR',
    permanencia: tarifaPermanencia?.value.trim() || '',
    'descripción': tarifaDescripcion?.value.trim() || '',
    plataformas: tarifaPlataformasInput?.value || '',
    lineas: tarifaLineas?.value !== '' ? Number(tarifaLineas.value) : null,
    vigente_desde: tarifaDesde?.value || null,
    vigente_hasta: tarifaHasta?.value || null,
    destacada: Boolean(tarifaDestacadaInput?.checked)
  });
  const index = tariffs.findIndex(t => t.id === entry.id);
  const message = editingTariffId ? 'Tarifa actualizada correctamente.' : 'Tarifa creada correctamente.';
  if (index >= 0) {
    tariffs[index] = entry;
  } else {
    tariffs.push(entry);
  }
  saveTariffs();
  aplicarFiltros();
  renderTariffTable();
  if (aiLastQuery) runAiSearch(aiLastQuery, { preserveFormState: true });
  if (tarifaFormInfo) tarifaFormInfo.textContent = message;
  resetTariffForm({ keepMessage: true });
}

function handleTarifaListAction(event) {
  const button = event.target.closest('button[data-action]');
  if (!button) return;
  const action = button.dataset.action;
  const id = button.dataset.id;
  if (!action || !id) return;
  const tariff = tariffs.find(t => t.id === id);
  if (!tariff) return;
  if (action === 'edit-tariff') {
    prefillTariffForm(tariff);
    const targetTop = tarifaForm?.offsetTop || adminPanel?.offsetTop || 0;
    window.scrollTo({ top: targetTop, behavior: 'smooth' });
  }
  if (action === 'delete-tariff') {
    if (confirm(`¿Seguro que deseas eliminar la tarifa «${tariff.nombre}»?`)) {
      tariffs = tariffs.filter(t => t.id !== id);
      saveTariffs();
      aplicarFiltros();
      renderTariffTable();
      if (aiLastQuery) runAiSearch(aiLastQuery, { preserveFormState: true });
      if (tarifaFormInfo) tarifaFormInfo.textContent = 'Tarifa eliminada.';
      resetTariffForm();
    }
  }
  if (action === 'toggle-featured') {
    tariff.destacada = !tariff.destacada;
    saveTariffs();
    if (tarifaFormInfo) {
      tarifaFormInfo.textContent = tariff.destacada
        ? `Tarifa «${tariff.nombre}» marcada como destacada.`
        : `Tarifa «${tariff.nombre}» sin destacar.`;
    }
    aplicarFiltros();
    renderTariffTable();
  }
}

function renderTariffTable() {
  if (!tarifaList) return;
  if (!tariffs.length) {
    tarifaList.innerHTML = '<p class="dim">No hay tarifas registradas todavía.</p>';
    if (adminTariffTabsContainer) adminTariffTabsContainer.innerHTML = '';
    if (adminTariffTypeContainer) adminTariffTypeContainer.innerHTML = '';
    return;
  }
  const companies = uniq(tariffs.map(item => item['compañia'] ? item['compañia'] : 'Sin compañía')).sort((a, b) => a.localeCompare(b, 'es'));
  if (adminTariffCompanyFilter !== 'all' && !companies.includes(adminTariffCompanyFilter)) {
    adminTariffCompanyFilter = 'all';
  }
  if (!['all', ...TARIFF_TYPE_ORDER].includes(adminTariffTypeFilter)) {
    adminTariffTypeFilter = 'all';
  }
  if (adminTariffTabsContainer) {
    const tabs = [{ value: 'all', label: 'Todas las compañías' }, ...companies.map(name => ({ value: name, label: name }))];
    adminTariffTabsContainer.innerHTML = tabs
      .map(tab => `<button type="button" class="tariff-tab-btn${adminTariffCompanyFilter === tab.value ? ' active' : ''}" data-company-filter="${tab.value}">${tab.label}</button>`)
      .join('');
  }
  if (adminTariffTypeContainer) {
    const typeOptions = [{ value: 'all', label: 'Todos los tipos' }, ...TARIFF_TYPE_ORDER.map(type => ({ value: type, label: `${type} · ${TARIFF_TYPE_LABELS[type]}` }))];
    adminTariffTypeContainer.innerHTML = typeOptions
      .map(option => `<button type="button" class="tariff-type-btn${adminTariffTypeFilter === option.value ? ' active' : ''}" data-type-filter="${option.value}">${option.label}</button>`)
      .join('');
  }
  let filtered = tariffs.slice();
  if (adminTariffCompanyFilter !== 'all') {
    filtered = filtered.filter(t => (t['compañia'] ? t['compañia'] : 'Sin compañía') === adminTariffCompanyFilter);
  }
  if (adminTariffTypeFilter !== 'all') {
    filtered = filtered.filter(t => (t.tipo || detectTariffType(t)) === adminTariffTypeFilter);
  }
  filtered = sortTariffsForDisplay(filtered);
  if (!filtered.length) {
    tarifaList.innerHTML = '<p class="dim">No hay tarifas para los filtros seleccionados.</p>';
    return;
  }
  const rows = filtered
    .map(t => {
      const price = t.precio != null ? euro(t.precio, t.moneda) : '-';
      const vigencia = `${t.vigente_desde || '-'}<br><span class="dim">${t.vigente_hasta || '-'}</span>`;
      const typeLabel = TARIFF_TYPE_LABELS[t.tipo] || t.tipo || '-';
      const featuredTag = t.destacada ? '<span class="tag">Destacada</span>' : '';
      const toggleLabel = t.destacada ? 'Quitar destacado' : 'Marcar destacada';
      const platforms = Array.isArray(t.plataformas) && t.plataformas.length
        ? escapeHtml(t.plataformas.join(', '))
        : '<span class="dim">Sin plataformas</span>';
      return `
        <tr data-id="${t.id}" class="${t.destacada ? 'featured-row' : ''}">
          <td><strong>${t.nombre}</strong> ${featuredTag}<br><span class="dim">${t.codigo}</span></td>
          <td>${t['compañia'] || 'Sin compañía'}</td>
          <td><span class="badge badge-type">${t.tipo || '-'}</span><br><span class="dim">${typeLabel}</span></td>
          <td>${price}</td>
          <td>${t.lineas != null ? t.lineas : '-'}</td>
          <td>${t.permanencia || '-'}</td>
          <td>${platforms}</td>
          <td>${vigencia}</td>
          <td>
            <button class="smallbtn" data-action="edit-tariff" data-id="${t.id}">Editar</button>
            <button class="smallbtn" data-action="delete-tariff" data-id="${t.id}">Eliminar</button>
            <button class="smallbtn" data-action="toggle-featured" data-id="${t.id}">${toggleLabel}</button>
          </td>
        </tr>
      `;
    })
    .join('');
  tarifaList.innerHTML = `
    <table class="admin-tariff-table">
      <thead>
        <tr>
          <th>Tarifa</th>
          <th>Compañía</th>
          <th>Tipo</th>
          <th>Precio</th>
          <th>Líneas</th>
          <th>Permanencia</th>
          <th>TV / Plataformas</th>
          <th>Vigencia</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>
  `;
}

function handleAdminTariffTabClick(event) {
  const button = event.target.closest('button[data-company-filter]');
  if (!button) return;
  const value = button.dataset.companyFilter || 'all';
  if (adminTariffCompanyFilter === value) return;
  adminTariffCompanyFilter = value;
  renderTariffTable();
}

function handleAdminTariffTypeClick(event) {
  const button = event.target.closest('button[data-type-filter]');
  if (!button) return;
  const value = button.dataset.typeFilter || 'all';
  if (adminTariffTypeFilter === value) return;
  adminTariffTypeFilter = value;
  renderTariffTable();
}

function handleTariffGridClick(event) {
  const tabBtn = event.target.closest('[data-client-tab]');
  if (tabBtn) {
    const target = tabBtn.dataset.clientTab;
    if (target && clientTariffTab !== target) {
      clientTariffTab = target;
      renderTariffGrid(lastRenderedTariffs);
    }
    return;
  }
  const jumpBtn = event.target.closest('[data-tariff-jump]');
  if (jumpBtn) {
    const target = jumpBtn.dataset.tariffJump;
    if (target) {
      pendingTariffScrollTarget = target;
      clientTariffTab = 'todas';
      renderTariffGrid(lastRenderedTariffs);
    }
  }
}

function populateLeadFilterOptions() {
  if (!leadFilter) return;
  const current = leadFilter.value;
  const entries = Array.from(
    new Map(
      leads
        .filter(lead => lead.origin !== CLIENT_ROLE)
        .map(lead => [lead.commercial, lead.commercialName || lead.commercial])
    )
  );
  entries.sort((a, b) => a[1].localeCompare(b[1], 'es'));
  leadFilter.innerHTML = '<option value="">Todos</option>' + entries.map(([id, name]) => `<option value="${id}">${name}</option>`).join('');
  if (entries.some(([id]) => id === current)) {
    leadFilter.value = current;
  } else {
    leadFilter.value = '';
  }
}

function renderLeadSummary() {
  if (!leadSummary) return;
  const teamLeads = leads.filter(lead => lead.origin !== CLIENT_ROLE);
  if (!teamLeads.length) {
    leadSummary.innerHTML = '<div class="dim">Aún no hay oportunidades registradas.</div>';
    populateLeadFilterOptions();
    return;
  }
  const aggregate = teamLeads.reduce((acc, lead) => {
    if (!acc[lead.commercial]) {
      acc[lead.commercial] = {
        commercial: lead.commercial,
        name: lead.commercialName || lead.commercial,
        total: 0,
        sold: 0
      };
    }
    acc[lead.commercial].total += 1;
    if (lead.status === 'vendido') acc[lead.commercial].sold += 1;
    return acc;
  }, {});
  const cards = Object.values(aggregate)
    .sort((a, b) => a.name.localeCompare(b.name, 'es'))
    .map(info => `
      <div class="kpi">
        <div class="label">${info.name}</div>
        <div><span class="highlight">${info.sold}</span> / ${info.total} ventas</div>
      </div>
    `)
    .join('');
  leadSummary.innerHTML = cards;
  populateLeadFilterOptions();
}

function formatDateTime(iso) {
  if (!iso) return '-';
  try {
    return new Date(iso).toLocaleString('es-ES', { dateStyle: 'short', timeStyle: 'short' });
  } catch (error) {
    return iso;
  }
}

function leadStatusLabel(status) {
  if (status === 'vendido') return 'Vendida';
  if (status === 'cancelado') return 'Cancelada';
  return 'Pendiente';
}

function leadCancellationDetails(lead) {
  if (!lead || lead.status !== 'cancelado') return '';
  const reason = (lead.cancelReason || '').trim();
  if (!reason) return '';
  const by = lead.cancelledByName || lead.cancelledBy || '';
  const when = lead.cancelledAt ? formatDateTime(lead.cancelledAt) : '';
  const metaParts = [];
  if (by) metaParts.push(`Responsable: ${by}`);
  if (when) metaParts.push(`Fecha: ${when}`);
  const meta = metaParts.length ? ` <span class="dim">(${metaParts.join(' · ')})</span>` : '';
  return `<p><strong>Motivo de cancelación:</strong> ${reason}${meta}</p>`;
}

function renderAdminLeadList() {
  if (!leadList) return;
  const teamLeads = leads.filter(lead => lead.origin !== CLIENT_ROLE);
  if (!teamLeads.length) {
    leadList.innerHTML = '<p class="dim">Sin oportunidades pendientes.</p>';
  } else {
    const filter = leadFilter?.value || '';
    const filtered = teamLeads
      .filter(lead => !filter || lead.commercial === filter)
      .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
    if (!filtered.length) {
      leadList.innerHTML = '<p class="dim">No hay oportunidades para el comercial seleccionado.</p>';
    } else {
      leadList.innerHTML = filtered
        .map(lead => {
          const statusLabel = leadStatusLabel(lead.status);
          const installedTag = lead.installed ? '<span class="tag tag-success">Instalada</span>' : '';
          const referralTag = lead.referredBy ? '<span class="tag">Plan amigo</span>' : '';
          const allowToggle = lead.status !== 'cancelado';
          const toggleLabel = lead.status === 'vendido' ? 'Marcar como pendiente' : 'Marcar como vendida';
          const toggleButton = allowToggle
            ? `<button class="smallbtn" data-action="toggle-status" data-id="${lead.id}">${toggleLabel}</button>`
            : '';
          const installLabel = lead.installed ? 'Marcar como pendiente de instalación' : 'Marcar como instalada';
          const installButton = lead.status === 'vendido'
            ? `<button class="smallbtn" data-action="toggle-installed" data-id="${lead.id}">${installLabel}</button>`
            : '';
          const cancelButton = lead.status === 'vendido'
            ? `<button class="smallbtn" data-action="cancel-lead" data-id="${lead.id}">Cancelar venta</button>`
            : '';
          const deleteButton = currentUser?.role === 'admin'
            ? `<button class="smallbtn danger" data-action="delete-lead" data-id="${lead.id}">Eliminar</button>`
            : '';
          const controls = [toggleButton, installButton, cancelButton, deleteButton].filter(Boolean).join('');
          const controlsMarkup = controls ? `<div class="controls" style="margin-left:auto;">${controls}</div>` : '';
          return `
            <div class="lead-card" data-id="${lead.id}">
              <header>
                <div>
                  <strong>${lead.clientName}</strong>
                  <span class="tag">${lead.tariffCodigo}</span>
                </div>
                <div class="inline-actions">
                  <span class="status-pill" data-status="${lead.status}">${statusLabel}</span>
                  ${installedTag}
                  ${referralTag}
                </div>
              </header>
              <div class="body">
                <p><strong>Tarifa:</strong> ${lead.tariffNombre} · <strong>${lead.tariffCompania}</strong></p>
                <p><strong>Contacto:</strong> ${lead.contact}</p>
                ${lead.notes ? `<p><strong>Notas:</strong> ${lead.notes}</p>` : ''}
                ${leadCancellationDetails(lead)}
              </div>
              <footer>
                <span>Comercial: <strong>${lead.commercialName}</strong></span>
                <span>Creada: ${formatDateTime(lead.createdAt)} · Última actualización: ${formatDateTime(lead.updatedAt)}</span>
                ${controlsMarkup}
              </footer>
            </div>
          `;
        })
        .join('');
    }
  }
  renderDirectClientInbox();
  renderAdminSalesStats();
}

function renderDirectClientInbox() {
  if (!directClientSection || !directClientList || !directClientEmpty) return;
  const directClients = leads
    .filter(lead => lead.origin === CLIENT_ROLE)
    .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
  if (!directClients.length) {
    directClientSection.classList.add('hidden');
    directClientList.innerHTML = '';
    directClientEmpty.classList.remove('hidden');
    return;
  }
  directClientSection.classList.remove('hidden');
  directClientEmpty.classList.add('hidden');
  directClientList.innerHTML = directClients
    .map(lead => {
      const statusLabel = leadStatusLabel(lead.status);
      const installedTag = lead.installed ? '<span class="tag tag-success">Instalada</span>' : '';
      const referralTag = lead.referredBy ? '<span class="tag">Plan amigo</span>' : '';
      const allowToggle = lead.status !== 'cancelado';
      const toggleLabel = lead.status === 'vendido' ? 'Marcar como pendiente' : 'Marcar como vendida';
      const toggleButton = allowToggle
        ? `<button class="smallbtn" data-action="toggle-status" data-id="${lead.id}">${toggleLabel}</button>`
        : '';
      const installLabel = lead.installed ? 'Marcar como pendiente de instalación' : 'Marcar como instalada';
      const installButton = lead.status === 'vendido'
        ? `<button class="smallbtn" data-action="toggle-installed" data-id="${lead.id}">${installLabel}</button>`
        : '';
      const cancelButton = lead.status === 'vendido'
        ? `<button class="smallbtn" data-action="cancel-lead" data-id="${lead.id}">Cancelar venta</button>`
        : '';
      const deleteButton = currentUser?.role === 'admin'
        ? `<button class="smallbtn danger" data-action="delete-lead" data-id="${lead.id}">Eliminar</button>`
        : '';
      const controls = [toggleButton, installButton, cancelButton, deleteButton].filter(Boolean).join('');
      const controlsMarkup = controls ? `<div class="controls" style="margin-left:auto;">${controls}</div>` : '';
      return `
        <div class="lead-card" data-id="${lead.id}">
          <header>
            <div>
              <strong>${lead.clientName}</strong>
              <span class="tag tag-warning">Cliente directo</span>
              <span class="tag">${lead.tariffCodigo}</span>
            </div>
          <div class="inline-actions">
            <span class="status-pill" data-status="${lead.status}">${statusLabel}</span>
            ${installedTag}
            ${referralTag}
          </div>
          </header>
          <div class="body">
            <p><strong>Tarifa solicitada:</strong> ${lead.tariffNombre} · <strong>${lead.tariffCompania}</strong></p>
            <p><strong>Solicitud enviada por:</strong> ${lead.commercialName}</p>
            <p><strong>Contacto:</strong> ${lead.contact}</p>
            ${lead.notes ? `<p><strong>Notas:</strong> ${lead.notes}</p>` : ''}
            ${leadCancellationDetails(lead)}
          </div>
          <footer>
            <span>Recibida: ${formatDateTime(lead.createdAt)}</span>
            <span>Actualizada: ${formatDateTime(lead.updatedAt)}</span>
            ${controlsMarkup}
          </footer>
        </div>
      `;
    })
    .join('');
}

function getTariffFromIndex(lead, index) {
  if (!lead) return null;
  if (lead.tariffId && index.has(lead.tariffId)) {
    return index.get(lead.tariffId);
  }
  if (lead.tariffId) {
    const byId = tariffs.find(item => item.id === lead.tariffId);
    if (byId) {
      index.set(byId.id, byId);
      return byId;
    }
  }
  if (lead.tariffCodigo) {
    const byCode = tariffs.find(item => item.codigo === lead.tariffCodigo);
    if (byCode) {
      index.set(byCode.id, byCode);
      return byCode;
    }
  }
  return null;
}

function computeLeadMetrics(lead, index) {
  const tariff = getTariffFromIndex(lead, index);
  const descriptionSource = [
    tariff?.nombre || '',
    tariff?.['descripción'] || '',
    lead.tariffNombre || '',
    lead.notes || ''
  ].join(' ').toLowerCase();
  const hasFiber = /fibra/i.test(descriptionSource);
  let mobileLines = 0;
  if (tariff && tariff.lineas !== null && tariff.lineas !== undefined) {
    const parsed = Number(tariff.lineas);
    if (Number.isFinite(parsed)) {
      mobileLines = Math.max(0, parsed);
    }
  }
  if (!mobileLines) {
    const match = descriptionSource.match(/(\d+)\s*(?:l[ií]neas?)/i);
    if (match) {
      const parsed = Number(match[1]);
      if (Number.isFinite(parsed)) {
        mobileLines = Math.max(mobileLines, parsed);
      }
    }
  }
  const code = (lead.tariffCodigo || tariff?.codigo || '').trim();
  const isPack = /^c[-_]?/i.test(code);
  const fiberCount = hasFiber ? 1 : 0;
  const commission = fiberCount * COMMISSION_RATES.fiber + mobileLines * COMMISSION_RATES.mobile;
  return {
    fiberCount,
    mobileLines,
    isPack,
    commission
  };
}

function getKpiStatus(packSales) {
  const thresholds = KPI_THRESHOLDS.slice().sort((a, b) => a.sales - b.sales);
  let achieved = null;
  let next = null;
  thresholds.forEach(threshold => {
    if (packSales >= threshold.sales) {
      achieved = threshold;
    } else if (!next) {
      next = threshold;
    }
  });
  const previousSales = achieved ? achieved.sales : 0;
  const targetSales = next ? next.sales : (achieved ? achieved.sales : (thresholds[thresholds.length - 1]?.sales || 0));
  const span = Math.max(1, targetSales - previousSales);
  let progress = next ? (packSales - previousSales) / span : 1;
  if (!Number.isFinite(progress)) progress = 0;
  progress = Math.max(0, Math.min(1, progress));
  const missing = next ? Math.max(0, next.sales - packSales) : 0;
  const bonus = achieved ? achieved.bonus : 0;
  const label = achieved ? `Bono ${euro(bonus)}` : 'Sin bono';
  return {
    achieved,
    next,
    progress,
    missing,
    bonus,
    packSales,
    label,
    previousSales,
    targetSales,
    reached: Boolean(achieved)
  };
}

function buildMonthlyMetrics() {
  const metrics = new Map();
  const tariffIndex = new Map();
  leads.forEach(lead => {
    if (lead.status !== 'vendido') return;
    if (!lead.installed) return;
    const saleDate = parseDate(lead.soldAt || lead.updatedAt);
    if (!saleDate) return;
    const monthDate = startOfMonth(saleDate);
    const key = monthKeyFromDate(monthDate);
    if (!metrics.has(key)) {
      metrics.set(key, { date: monthDate, perUser: new Map() });
    }
    const entry = metrics.get(key);
    const username = lead.commercial || 'sin-asignar';
    const userRecord = getUserByUsername(username);
    const displayName = userDisplayName(userRecord) || lead.commercialName || (username === 'sin-asignar' ? 'Sin asignar' : username);
    if (!entry.perUser.has(username)) {
      entry.perUser.set(username, {
        username,
        name: displayName,
        totalSales: 0,
        packSales: 0,
        fiberSales: 0,
        mobileLines: 0,
        commission: 0
      });
    }
    const stats = entry.perUser.get(username);
    const metricsForLead = computeLeadMetrics(lead, tariffIndex);
    stats.totalSales += 1;
    stats.packSales += metricsForLead.isPack ? 1 : 0;
    stats.fiberSales += metricsForLead.fiberCount;
    stats.mobileLines += metricsForLead.mobileLines;
    stats.commission += metricsForLead.commission;
  });
  metrics.forEach(entry => {
    entry.perUser.forEach(stats => {
      stats.kpi = getKpiStatus(stats.packSales);
    });
  });
  return metrics;
}

function getUserMonthlyStats(metricsMap, monthDate, username) {
  const key = monthKeyFromDate(monthDate);
  const entry = metricsMap.get(key);
  const stats = entry?.perUser.get(username);
  if (stats) {
    return {
      username: stats.username,
      name: stats.name,
      totalSales: stats.totalSales,
      packSales: stats.packSales,
      fiberSales: stats.fiberSales,
      mobileLines: stats.mobileLines,
      commission: stats.commission,
      kpi: stats.kpi || getKpiStatus(stats.packSales)
    };
  }
  const userRecord = getUserByUsername(username);
  const displayName = userDisplayName(userRecord) || username;
  return {
    username,
    name: displayName,
    totalSales: 0,
    packSales: 0,
    fiberSales: 0,
    mobileLines: 0,
    commission: 0,
    kpi: getKpiStatus(0)
  };
}

function renderCommercialMetrics() {
  if (!commercialMetrics) return;
  if (!currentUser || currentUser.role !== 'comercial') {
    commercialMetrics.classList.add('hidden');
    commercialMetrics.innerHTML = '';
    return;
  }
  const metricsMap = buildMonthlyMetrics();
  const currentMonth = startOfMonth(new Date());
  const stats = getUserMonthlyStats(metricsMap, currentMonth, currentUser.username);
  const userRecord = getUserByUsername(currentUser.username) || currentUser;
  const displayName = userDisplayName(userRecord) || currentUser.username;
  const maxThreshold = KPI_THRESHOLDS[KPI_THRESHOLDS.length - 1]?.sales || 0;
  const globalProgress = maxThreshold
    ? Math.min(100, Math.round((stats.packSales / maxThreshold) * 100))
    : (stats.packSales > 0 ? 100 : 0);
  const status = stats.kpi;
  const firstThreshold = KPI_THRESHOLDS[0];
  const bonusValue = status.bonus || 0;
  const totalBenefit = stats.commission + bonusValue;
  const bonusClass = bonusValue > 0 ? 'bonus-highlight active' : 'bonus-highlight';
  const bonusNote = bonusValue > 0
    ? `Has desbloqueado un bono de ${euro(bonusValue)} este mes.`
    : status.next
      ? `Instala ${status.missing} packs más para alcanzar ${euro(status.next.bonus)}.`
      : firstThreshold
        ? `Instala ${firstThreshold.sales} packs para activar el primer bono.`
        : 'Aún no has activado un bono este mes.';
  const nextMessage = status.next
    ? `Te faltan <strong>${status.missing}</strong> packs instalados para alcanzar ${euro(status.next.bonus)}.`
    : status.reached
      ? 'Has alcanzado el máximo bono mensual disponible.'
      : firstThreshold
        ? `Instala ${firstThreshold.sales} packs para activar el primer bono.`
        : 'Define objetivos de packs para activar los bonos.';
  const historyItems = [];
  for (let offset = 1; offset <= KPI_HISTORY_MONTHS; offset += 1) {
    const monthDate = new Date(currentMonth);
    monthDate.setMonth(monthDate.getMonth() - offset);
    const historyStats = getUserMonthlyStats(metricsMap, monthDate, currentUser.username);
    historyItems.push({
      label: monthLabel(monthDate),
      packs: historyStats.packSales,
      commission: historyStats.commission
    });
  }
  const historyMarkup = historyItems.length
    ? historyItems.map(item => `<li><span>${item.label}</span><span><strong>${item.packs}</strong> packs · ${euro(item.commission)}</span></li>`).join('')
    : '<li>No hay histórico disponible.</li>';
  const markerValues = KPI_THRESHOLDS.length
    ? [0, ...KPI_THRESHOLDS.map(t => t.sales)]
    : [0];
  const markers = markerValues.map(value => `<span>${value}</span>`).join('');
  const installReminder = 'Recuerda que solo cuentan las instalaciones confirmadas.';
  commercialMetrics.innerHTML = `
    <div class="commercial-kpi">
      <div class="kpi-header">
        <div>
          <div class="dim">${monthLabel(currentMonth)}</div>
          <strong>${displayName}</strong>
        </div>
        <div class="badge">${status.label}</div>
      </div>
      <div>
        <div class="kpi-progress-track">
          <div class="kpi-progress-fill" style="width:${globalProgress}%;"></div>
        </div>
        <div class="kpi-markers">${markers}</div>
      </div>
      <div class="kpi-status">
        <span>Packs instalados: <strong>${stats.packSales}</strong></span>
        <span>${nextMessage}</span>
      </div>
    </div>
    <div class="${bonusClass}">
      <span class="bonus-label">Bono del mes</span>
      <span class="bonus-amount">${euro(bonusValue)}</span>
      <span class="bonus-note">${bonusNote}</span>
      <span class="bonus-note">${installReminder}</span>
    </div>
    <div class="commission-card">
      <div>
        <div class="dim">Comisión confirmada del mes</div>
        <div class="commission-value">${euro(stats.commission)}</div>
      </div>
      <div class="commission-meta">
        <span>Fibra: <strong>${stats.fiberSales}</strong></span>
        <span>Líneas móviles: <strong>${stats.mobileLines}</strong></span>
        <span>Ventas instaladas: <strong>${stats.totalSales}</strong></span>
      </div>
    </div>
    <div class="total-benefit-card">
      <div>
        <div class="dim">Beneficio total (comisiones + bono)</div>
        <div class="total-benefit-value">${euro(totalBenefit)}</div>
      </div>
    </div>
    <div class="metrics-history">
      <h4>Histórico reciente</h4>
      <ul>${historyMarkup}</ul>
    </div>
  `;
  commercialMetrics.classList.remove('hidden');
}

function statInitials(name = '') {
  const parts = String(name || '')
    .trim()
    .split(/\s+/)
    .filter(Boolean);
  if (!parts.length) return '?';
  const letters = parts.slice(0, 2).map(part => part[0] || '');
  const initials = letters.join('').toUpperCase();
  return initials || '?';
}

function renderStatAvatarMarkup(name, photo) {
  const safeName = escapeHtml(name || '');
  if (photo) {
    return `<div class="stat-avatar"><img src="${escapeHtml(photo)}" alt="Foto de ${safeName}" loading="lazy" /></div>`;
  }
  return `<div class="stat-avatar">${escapeHtml(statInitials(name))}</div>`;
}

function collectAdminSalesMetrics(rangeKey) {
  const { start, end } = getTimeframeRange(rangeKey);
  const technicians = new Map();
  const clients = new Map();
  const tariffIndex = new Map();

  const ensureTechnician = (username, record, fallbackName) => {
    const key = username || 'sin-asignar';
    if (!technicians.has(key)) {
      technicians.set(key, {
        username: key,
        name: fallbackName,
        totalSales: 0,
        packSales: 0,
        fiberSales: 0,
        mobileLines: 0,
        commission: 0,
        photo: record?.photo || '',
        role: record?.role || null
      });
    }
    const entry = technicians.get(key);
    if (record) {
      if (record.photo && !entry.photo) {
        entry.photo = record.photo;
      }
      if (record.role) {
        entry.role = record.role;
      }
    }
    if (fallbackName && !entry.name) {
      entry.name = fallbackName;
    }
    return entry;
  };

  const ensureClient = (username, record, fallbackName = '') => {
    if (!username) return null;
    if (!clients.has(username)) {
      clients.set(username, {
        username,
        name: fallbackName || username,
        totalSales: 0,
        fiberSales: 0,
        mobileLines: 0,
        pointsNet: 0,
        pointsEarned: 0,
        pointsSpent: 0,
        pointsEarnedFromLeads: 0,
        pointsEarnedFromReferrals: 0,
        photo: record?.photo || ''
      });
    }
    const entry = clients.get(username);
    if (record) {
      entry.name = userDisplayName(record) || entry.name || username;
      if (record.photo && !entry.photo) entry.photo = record.photo;
    } else if (fallbackName) {
      entry.name = fallbackName;
    }
    return entry;
  };

  leads.forEach(lead => {
    if (lead.status !== 'vendido') return;
    if (!lead.installed) return;
    const referenceDate = parseDate(lead.pointsLedger?.awardedAt || lead.soldAt || lead.updatedAt);
    if (!referenceDate) return;
    if (referenceDate < start || referenceDate > end) return;
    const metrics = computeLeadMetrics(lead, tariffIndex);

    const username = lead.commercial || 'sin-asignar';
    const userRecord = getUserByUsername(username);
    const displayName = userDisplayName(userRecord)
      || lead.commercialName
      || (username === 'sin-asignar' ? 'Sin asignar' : username);
    const technician = ensureTechnician(username, userRecord, displayName);
    technician.totalSales += 1;
    technician.packSales += metrics.isPack ? 1 : 0;
    technician.fiberSales += metrics.fiberCount;
    technician.mobileLines += metrics.mobileLines;
    technician.commission += metrics.commission;

    const clientUsername = (lead.clientUsername || (lead.origin === CLIENT_ROLE ? lead.commercial : '') || '')
      .trim()
      .toLowerCase();
    if (clientUsername) {
      const clientRecord = getUserByUsername(clientUsername);
      const clientName = userDisplayName(clientRecord) || lead.clientName || clientUsername;
      const clientStats = ensureClient(clientUsername, clientRecord, clientName);
      if (clientStats) {
        clientStats.totalSales += 1;
        clientStats.fiberSales += metrics.fiberCount;
        clientStats.mobileLines += metrics.mobileLines;
        const basePoints = Number.isFinite(Number(lead.pointsLedger?.base)) ? Number(lead.pointsLedger.base) : 0;
        if (basePoints > 0) {
          clientStats.pointsEarnedFromLeads += basePoints;
        }
      }
    }
    if (lead.referredBy) {
      const inviterUsername = lead.referredBy.trim().toLowerCase();
      if (inviterUsername) {
        const inviterRecord = getUserByUsername(inviterUsername);
        const inviterName = userDisplayName(inviterRecord) || inviterUsername;
        const inviterStats = ensureClient(inviterUsername, inviterRecord, inviterName);
        if (inviterStats) {
          const referralPoints = Number.isFinite(Number(lead.pointsLedger?.referral)) ? Number(lead.pointsLedger.referral) : 0;
          if (referralPoints > 0) {
            inviterStats.pointsEarnedFromReferrals += referralPoints;
          }
        }
      }
    }
  });

  users.forEach(user => {
    if (user.role !== CLIENT_ROLE) return;
    const stats = ensureClient(user.username, user, userDisplayName(user) || user.username);
    if (!stats) return;
    const history = Array.isArray(user.pointsHistory) ? user.pointsHistory : [];
    history.forEach(movement => {
      const movementDate = parseDate(movement.createdAt);
      if (!movementDate) return;
      if (movementDate < start || movementDate > end) return;
      const amount = Math.round(Number(movement.amount) || 0);
      if (!amount) return;
      stats.pointsNet += amount;
      if (amount > 0) {
        stats.pointsEarned += amount;
      } else if (amount < 0) {
        stats.pointsSpent += Math.abs(amount);
      }
    });
  });

  const technicianList = Array.from(technicians.values()).map(entry => ({
    ...entry,
    role: entry.role || '',
    kpi: getKpiStatus(entry.packSales)
  }));

  const clientList = Array.from(clients.values()).map(entry => ({
    ...entry,
    pointsNet: entry.pointsNet || 0,
    pointsEarned: entry.pointsEarned || 0,
    pointsSpent: entry.pointsSpent || 0,
    pointsEarnedFromLeads: entry.pointsEarnedFromLeads || 0,
    pointsEarnedFromReferrals: entry.pointsEarnedFromReferrals || 0,
    totalSales: entry.totalSales || 0,
    fiberSales: entry.fiberSales || 0,
    mobileLines: entry.mobileLines || 0
  }));

  return { technicians: technicianList, clients: clientList };
}

function renderTechnicianStatCard(stats, index) {
  const kpi = stats.kpi || getKpiStatus(stats.packSales || 0);
  const kpiState = kpi.reached ? 'active' : 'pending';
  const kpiText = kpi.reached ? `${kpi.label}` : 'KPI pendiente';
  const firstThreshold = KPI_THRESHOLDS[0];
  const detail = kpi.next
    ? `Faltan ${kpi.missing} packs instalados para ${euro(kpi.next.bonus)}`
    : kpi.reached
      ? 'Objetivo de packs instalados completado.'
      : firstThreshold
        ? `Necesitas ${firstThreshold.sales} packs instalados para el primer bono.`
        : 'Sin configuración de bonos.';
  const avatar = renderStatAvatarMarkup(stats.name, stats.photo);
  return `
    <div class="stat-card" data-rank="${index + 1}">
      <div class="stat-header">
        <div style="display:flex; align-items:center; gap:10px;">
          ${avatar}
          <div>
            <span class="stat-rank">#${index + 1}</span>
            <div class="stat-name">${escapeHtml(stats.name)}</div>
          </div>
        </div>
        <span class="kpi-badge" data-state="${kpiState}">${kpiText}</span>
      </div>
      <div class="stat-figure">${euro(stats.commission)}<span>Comisión generada</span></div>
      <div class="stat-metrics">
        <div class="stat-metric"><span>Ventas instaladas</span><strong>${stats.totalSales}</strong></div>
        <div class="stat-metric"><span>Packs instalados</span><strong>${stats.packSales}</strong></div>
        <div class="stat-metric"><span>Fibra contratada</span><strong>${stats.fiberSales}</strong></div>
        <div class="stat-metric"><span>Líneas móviles</span><strong>${stats.mobileLines}</strong></div>
      </div>
      <div class="stat-footnote">${detail}</div>
    </div>
  `;
}

function renderClientStatCard(stats, index) {
  const avatar = renderStatAvatarMarkup(stats.name, stats.photo);
  const net = stats.pointsNet || 0;
  const netLabel = formatPointsDelta(net);
  const earnedLabel = stats.pointsEarned > 0 ? `+${formatPoints(stats.pointsEarned)}` : formatPoints(0);
  const spentLabel = stats.pointsSpent > 0 ? `-${formatPoints(stats.pointsSpent)}` : formatPoints(0);
  const badgeState = net >= 0 ? 'active' : 'pending';
  const badgeText = net >= 0 ? 'Saldo positivo' : 'Saldo en descenso';
  const installPoints = stats.pointsEarnedFromLeads || 0;
  const referralPoints = stats.pointsEarnedFromReferrals || 0;
  const footnoteParts = [];
  if (installPoints > 0) footnoteParts.push(`${formatPoints(installPoints)} por instalaciones`);
  if (referralPoints > 0) footnoteParts.push(`${formatPoints(referralPoints)} por invitaciones`);
  const footnote = footnoteParts.length
    ? `Incluye ${footnoteParts.join(' y ')}.`
    : 'Actividad generada en el periodo seleccionado.';
  return `
    <div class="stat-card" data-rank="${index + 1}">
      <div class="stat-header">
        <div style="display:flex; align-items:center; gap:10px;">
          ${avatar}
          <div>
            <span class="stat-rank">#${index + 1}</span>
            <div class="stat-name">${escapeHtml(stats.name)}</div>
          </div>
        </div>
        <span class="kpi-badge" data-state="${badgeState}">${badgeText}</span>
      </div>
      <div class="stat-figure">${netLabel}<span>Puntos netos</span></div>
      <div class="stat-metrics">
        <div class="stat-metric"><span>Puntos ganados</span><strong>${earnedLabel}</strong></div>
        <div class="stat-metric"><span>Puntos canjeados</span><strong>${spentLabel}</strong></div>
        <div class="stat-metric"><span>Instalaciones</span><strong>${stats.totalSales}</strong></div>
        <div class="stat-metric"><span>Fibra contratada</span><strong>${stats.fiberSales}</strong></div>
        <div class="stat-metric"><span>Líneas móviles</span><strong>${stats.mobileLines}</strong></div>
      </div>
      <div class="stat-footnote">${footnote}</div>
    </div>
  `;
}

function renderAdminSalesStats() {
  if (!adminSalesStats || !adminClientStats) return;
  const rangeKey = adminSalesRange || 'month';
  const range = getTimeframeRange(rangeKey);
  if (adminSalesRangeLabel) {
    adminSalesRangeLabel.textContent = range.label;
  }
  if (adminSalesRangeControls) {
    const buttons = adminSalesRangeControls.querySelectorAll('button[data-range]');
    buttons.forEach(button => {
      button.classList.toggle('active', button.dataset.range === rangeKey);
    });
  }
  const { technicians, clients } = collectAdminSalesMetrics(rangeKey);
  const technicianEntries = technicians.filter(entry => entry.role !== CLIENT_ROLE);
  const totalFiber = technicianEntries.reduce((sum, entry) => sum + (entry.fiberSales || 0), 0);
  const totalMobile = technicianEntries.reduce((sum, entry) => sum + (entry.mobileLines || 0), 0);
  const totalServices = totalFiber + totalMobile;

  if (adminSalesTotals) {
    adminSalesTotals.innerHTML = `
      <div class="admin-total-card">
        <span class="total-heading">Ventas totales instaladas</span>
        <span class="total-number">${formatInteger(totalServices)}</span>
        <span class="total-breakdown">${formatInteger(totalFiber)} fibras · ${formatInteger(totalMobile)} líneas móviles</span>
      </div>
    `;
    adminSalesTotals.classList.remove('hidden');
  }

  const sortedTechnicians = technicianEntries
    .filter(entry => entry.totalSales > 0 || entry.commission > 0)
    .sort((a, b) => {
      if (b.commission !== a.commission) return b.commission - a.commission;
      if (b.packSales !== a.packSales) return b.packSales - a.packSales;
      if (b.fiberSales !== a.fiberSales) return b.fiberSales - a.fiberSales;
      return a.name.localeCompare(b.name, 'es');
    });
  adminSalesStats.innerHTML = sortedTechnicians.length
    ? sortedTechnicians.map((stats, index) => renderTechnicianStatCard(stats, index)).join('')
    : '<p class="dim">No hay comisiones registradas en este periodo.</p>';

  const sortedClients = clients
    .filter(entry => (
      (entry.pointsNet || 0) !== 0
      || entry.pointsEarned > 0
      || entry.pointsSpent > 0
      || entry.totalSales > 0
      || entry.fiberSales > 0
      || entry.mobileLines > 0
      || entry.pointsEarnedFromLeads > 0
      || entry.pointsEarnedFromReferrals > 0
    ))
    .sort((a, b) => {
      const scoreA = a.pointsNet !== 0
        ? a.pointsNet
        : (a.pointsEarned > 0 ? a.pointsEarned : (a.pointsEarnedFromLeads > 0 ? a.pointsEarnedFromLeads : a.pointsEarnedFromReferrals));
      const scoreB = b.pointsNet !== 0
        ? b.pointsNet
        : (b.pointsEarned > 0 ? b.pointsEarned : (b.pointsEarnedFromLeads > 0 ? b.pointsEarnedFromLeads : b.pointsEarnedFromReferrals));
      if (scoreB !== scoreA) return scoreB - scoreA;
      if (b.pointsEarned !== a.pointsEarned) return b.pointsEarned - a.pointsEarned;
      if (b.totalSales !== a.totalSales) return b.totalSales - a.totalSales;
      if (b.fiberSales !== a.fiberSales) return b.fiberSales - a.fiberSales;
      if (b.mobileLines !== a.mobileLines) return b.mobileLines - a.mobileLines;
      return a.name.localeCompare(b.name, 'es');
    });

  adminClientStats.innerHTML = sortedClients.length
    ? sortedClients.map((stats, index) => renderClientStatCard(stats, index)).join('')
    : '<p class="dim">No hay actividad de clientes en este periodo.</p>';
}

function activateAdminTab(tab) {
  if (!adminTabPanels) return;
  const availableKeys = Object.keys(adminTabPanels).filter(key => adminTabPanels[key]);
  const target = tab && adminTabPanels[tab] ? tab : 'sales';
  adminActiveTab = target;
  adminTabButtons?.forEach(button => {
    const isActive = button.dataset.tab === target;
    button.classList.toggle('active', isActive);
  });
  availableKeys.forEach(key => {
    const panel = adminTabPanels[key];
    if (!panel) return;
    if (key === target) {
      panel.classList.remove('hidden');
    } else {
      panel.classList.add('hidden');
    }
  });
  if (target === 'sales') {
    renderAdminSalesStats();
  }
}

function handleLeadListAction(event) {
  const button = event.target.closest('button[data-action]');
  if (!button) return;
  const action = button.dataset.action;
  const id = button.dataset.id;
  if (!action || !id) return;
  const lead = leads.find(l => l.id === id);
  if (!lead) return;
  if (action === 'toggle-status') {
    if (lead.status === 'cancelado') return;
    lead.status = lead.status === 'vendido' ? 'pendiente' : 'vendido';
    lead.updatedAt = new Date().toISOString();
    if (lead.status === 'vendido') {
      lead.notified = false;
      lead.soldAt = lead.updatedAt;
    } else {
      lead.notified = true;
      lead.installed = false;
      lead.soldAt = null;
    }
    lead.cancelReason = '';
    lead.cancelledAt = null;
    lead.cancelledBy = '';
    lead.cancelledByName = '';
    saveLeads();
    renderLeadSummary();
    renderAdminLeadList();
    renderTeamPanel();
    renderCommercialPanel();
  }
  if (action === 'toggle-installed') {
    if (!currentUser || (currentUser.role !== 'admin' && currentUser.role !== 'lider')) return;
    if (lead.status !== 'vendido') return;
    const wasInstalled = lead.installed;
    lead.installed = !lead.installed;
    lead.updatedAt = new Date().toISOString();
    if (lead.installed) {
      grantInstallationPoints(lead);
    } else if (wasInstalled) {
      revokeInstallationPoints(lead);
    }
    saveLeads();
    renderLeadSummary();
    renderAdminLeadList();
    renderTeamPanel();
    renderCommercialPanel();
  }
  if (action === 'cancel-lead') {
    if (!currentUser || (currentUser.role !== 'admin' && currentUser.role !== 'lider')) return;
    if (lead.status !== 'vendido') return;
    const reason = prompt('Indica el motivo de la cancelación de la venta:');
    if (reason === null) return;
    const trimmed = reason.trim();
    if (!trimmed) {
      alert('Debes indicar un comentario para cancelar la venta.');
      return;
    }
    lead.status = 'cancelado';
    lead.cancelReason = trimmed;
    lead.cancelledAt = new Date().toISOString();
    lead.cancelledBy = currentUser.username;
    lead.cancelledByName = userDisplayName(currentUser) || currentUser.username;
    lead.installed = false;
    lead.notified = true;
    lead.updatedAt = lead.cancelledAt;
    lead.soldAt = null;
    saveLeads();
    renderLeadSummary();
    renderAdminLeadList();
    renderTeamPanel();
    renderCommercialPanel();
  }
  if (action === 'delete-lead') {
    if (!currentUser || currentUser.role !== 'admin') return;
    if (!confirm('¿Eliminar definitivamente esta venta?')) {
      return;
    }
    leads = leads.filter(entry => entry.id !== id);
    saveLeads();
    renderLeadSummary();
    renderAdminLeadList();
    renderTeamPanel();
    renderCommercialPanel();
    return;
  }
}

function hideCommercialNotifications() {
  if (!commercialNotifications) return;
  commercialNotifications.classList.add('hidden');
  commercialNotifications.removeAttribute('data-mode');
  commercialNotifications.innerHTML = '';
}

function showCommercialAlert(leadsToNotify) {
  if (!commercialNotifications) return;
  if (!leadsToNotify.length) {
    if (commercialNotifications.dataset.mode === 'alert') {
      hideCommercialNotifications();
    }
    return;
  }
  const list = leadsToNotify
    .map(lead => `<li>${lead.tariffNombre} · cliente <strong>${lead.clientName}</strong></li>`)
    .join('');
  commercialNotifications.innerHTML = `
    <h3 class="section-subtitle" style="margin-top:0;">Ventas confirmadas</h3>
    <p>El administrador ha marcado como vendidas estas oportunidades:</p>
    <ul class="login-hints">${list}</ul>
  `;
  commercialNotifications.classList.remove('hidden');
  commercialNotifications.dataset.mode = 'alert';
}

function showCommercialFlash(message) {
  if (!commercialNotifications) return;
  commercialNotifications.innerHTML = `
    <h3 class="section-subtitle" style="margin-top:0;">¡Perfecto!</h3>
    <p>${message}</p>
  `;
  commercialNotifications.classList.remove('hidden');
  commercialNotifications.dataset.mode = 'flash';
  if (commercialNoticeTimeout) clearTimeout(commercialNoticeTimeout);
  commercialNoticeTimeout = setTimeout(() => {
    if (commercialNotifications.dataset.mode === 'flash') {
      hideCommercialNotifications();
    }
  }, 4000);
}

function renderCommercialPanel() {
  if (!commercialPanel || !commercialLeads) return;
  renderCommercialMetrics();
  const isClient = currentUser?.role === CLIENT_ROLE;
  if (isClient) {
    renderClientPlan();
  } else if (clientPlanSection) {
    clientPlanSection.classList.add('hidden');
  }
  const mine = leads
    .filter(lead => lead.commercial === currentUser?.username)
    .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
  const pendingAlerts = mine.filter(lead => lead.status === 'vendido' && !lead.notified);
  if (pendingAlerts.length) {
    showCommercialAlert(pendingAlerts);
    pendingAlerts.forEach(lead => { lead.notified = true; });
    saveLeads();
  } else if (commercialNotifications?.dataset.mode === 'alert') {
    hideCommercialNotifications();
  }
  if (!mine.length) {
    const emptyMessage = isClient
      ? 'Aún no has solicitado tarifas. Explora las opciones y desbloquea recompensas con tus puntos.'
      : 'Aún no has enviado propuestas. Elige una tarifa y envía la primera.';
    commercialLeads.innerHTML = `<p class="dim">${emptyMessage}</p>`;
    return;
  }
  commercialLeads.innerHTML = mine
    .map(lead => {
      const statusLabel = leadStatusLabel(lead.status);
      const installedTag = lead.installed ? '<span class="tag tag-success">Instalada</span>' : '';
      const referralTag = lead.referredBy ? '<span class="tag">Plan amigo</span>' : '';
      return `
        <div class="lead-card">
          <header>
            <div>
              <strong>${lead.tariffNombre}</strong>
              <span class="tag">${lead.tariffCodigo}</span>
            </div>
            <div class="inline-actions">
              <span class="status-pill" data-status="${lead.status}">${statusLabel}</span>
              ${installedTag}
              ${referralTag}
            </div>
          </header>
          <div class="body">
            <p><strong>Cliente:</strong> ${lead.clientName}</p>
            <p><strong>Contacto:</strong> ${lead.contact}</p>
            ${lead.notes ? `<p><strong>Notas:</strong> ${lead.notes}</p>` : ''}
            ${leadCancellationDetails(lead)}
          </div>
          <footer>
            <span>Enviada: ${formatDateTime(lead.createdAt)}</span>
            <span>Última actualización: ${formatDateTime(lead.updatedAt)}</span>
          </footer>
        </div>
      `;
    })
    .join('');
}

function renderTeamPanel() {
  if (!teamPanel || !teamSummary || !teamLeadList) return;
  if (!currentUser || currentUser.role !== 'lider') {
    teamSummary.innerHTML = '';
    teamLeadList.innerHTML = '';
    return;
  }
  const managerRecord = getUserByUsername(currentUser.username) || currentUser;
  const members = Array.isArray(managerRecord?.managedUsers)
    ? managerRecord.managedUsers
    : Array.isArray(currentUser.managedUsers)
      ? currentUser.managedUsers
      : [];
  const uniqueMembers = Array.from(new Set(members.filter(Boolean)));
  if (!uniqueMembers.length) {
    teamSummary.innerHTML = '<div class="dim">Aún no tienes usuarios asignados a tu equipo.</div>';
    teamLeadList.innerHTML = '';
    return;
  }
  const teamLeads = leads
    .filter(lead => uniqueMembers.includes(lead.commercial))
    .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
  if (!teamLeads.length) {
    teamSummary.innerHTML = '<div class="dim">Sin oportunidades registradas para tu equipo.</div>';
    teamLeadList.innerHTML = '<p class="dim">Cuando tu equipo envíe propuestas aparecerán aquí.</p>';
    return;
  }
  const aggregate = teamLeads.reduce((acc, lead) => {
    if (!acc[lead.commercial]) {
      acc[lead.commercial] = {
        username: lead.commercial,
        name: lead.commercialName || lead.commercial,
        total: 0,
        sold: 0
      };
    }
    acc[lead.commercial].total += 1;
    if (lead.status === 'vendido') acc[lead.commercial].sold += 1;
    return acc;
  }, {});
  teamSummary.innerHTML = Object.values(aggregate)
    .sort((a, b) => a.name.localeCompare(b.name, 'es'))
    .map(info => `
      <div class="kpi">
        <div class="label">${info.name}</div>
        <div><span class="highlight">${info.sold}</span> / ${info.total} ventas</div>
      </div>
    `)
    .join('');
  teamLeadList.innerHTML = teamLeads
    .map(lead => {
      const statusLabel = leadStatusLabel(lead.status);
      const installedTag = lead.installed ? '<span class="tag tag-success">Instalada</span>' : '';
      const referralTag = lead.referredBy ? '<span class="tag">Plan amigo</span>' : '';
      const installLabel = lead.installed ? 'Marcar como pendiente de instalación' : 'Marcar como instalada';
      const installButton = lead.status === 'vendido'
        ? `<button class="smallbtn" data-action="toggle-installed" data-id="${lead.id}">${installLabel}</button>`
        : '';
      const cancelButton = lead.status === 'vendido'
        ? `<button class="smallbtn" data-action="cancel-lead" data-id="${lead.id}">Cancelar venta</button>`
        : '';
      const controls = [installButton, cancelButton].filter(Boolean).join('');
      const controlsMarkup = controls ? `<div class="controls" style="margin-left:auto;">${controls}</div>` : '';
      return `
        <div class="lead-card">
          <header>
            <div>
              <strong>${lead.clientName}</strong>
              <span class="tag">${lead.tariffCodigo}</span>
            </div>
          <div class="inline-actions">
            <span class="status-pill" data-status="${lead.status}">${statusLabel}</span>
            ${installedTag}
            ${referralTag}
          </div>
          </header>
          <div class="body">
            <p><strong>Tarifa:</strong> ${lead.tariffNombre} · <strong>${lead.tariffCompania}</strong></p>
            <p><strong>Comercial:</strong> ${lead.commercialName}</p>
            <p><strong>Contacto:</strong> ${lead.contact}</p>
            ${lead.notes ? `<p><strong>Notas:</strong> ${lead.notes}</p>` : ''}
            ${leadCancellationDetails(lead)}
          </div>
          <footer>
            <span>Creada: ${formatDateTime(lead.createdAt)}</span>
            <span>Actualizada: ${formatDateTime(lead.updatedAt)}</span>
            ${controlsMarkup}
          </footer>
        </div>
      `;
    })
    .join('');
}

function openLeadModal(tariff) {
  if (!leadModal || !leadForm) return;
  leadModal.classList.remove('hidden');
  if (leadTariffName) leadTariffName.textContent = `${tariff.nombre} (${tariff.codigo})`;
  leadForm.reset();
  if (leadTariffIdInput) leadTariffIdInput.value = tariff.id;
  setTimeout(() => clientNameInput?.focus(), 50);
}

function closeLeadModal() {
  if (!leadModal || !leadForm) return;
  leadModal.classList.add('hidden');
  leadForm.reset();
}

function resetRequestForm() {
  if (!requestForm) return;
  requestForm.reset();
  if (requestError) requestError.textContent = '';
}

function openRequestModal(tariff) {
  if (!requestModal || !requestForm) return;
  resetRequestForm();
  requestModal.classList.remove('hidden');
  if (requestTariffName) requestTariffName.textContent = `${tariff.nombre} (${tariff.codigo})`;
  if (requestTariffIdInput) requestTariffIdInput.value = tariff.id;
  setTimeout(() => requestUsernameInput?.focus(), 50);
}

function closeRequestModal() {
  if (!requestModal) return;
  requestModal.classList.add('hidden');
  resetRequestForm();
}

function openProfilePanel() {
  if (!profilePanel || !currentUser) return;
  prefillProfileForm();
  profilePanel.classList.remove('hidden');
  setTimeout(() => profileFirstName?.focus(), 50);
}

function closeProfilePanel() {
  if (!profilePanel) return;
  profilePanel.classList.add('hidden');
}

function showRegisterModal() {
  if (!registerModal) return;
  registerModal.classList.remove('hidden');
  registerForm?.reset();
  if (registerError) registerError.textContent = '';
  setTimeout(() => registerFirstNameInput?.focus(), 50);
}

function hideRegisterModal() {
  if (!registerModal) return;
  registerModal.classList.add('hidden');
  if (registerError) registerError.textContent = '';
  registerForm?.reset();
}

function handleRegisterSubmit(event) {
  event.preventDefault();
  if (!registerForm) return;
  const username = registerUserInput?.value.trim().toLowerCase();
  const password = registerPassInput?.value || '';
  const confirmPassword = registerPassConfirmInput?.value || '';
  if (!username || username.length < 3) {
    if (registerError) registerError.textContent = 'Elige un usuario de al menos 3 caracteres.';
    return;
  }
  if (users.some(user => user.username === username)) {
    if (registerError) registerError.textContent = 'Ese usuario ya está en uso. Prueba con otro nombre.';
    return;
  }
  if (password.length < 6) {
    if (registerError) registerError.textContent = 'La contraseña debe tener al menos 6 caracteres.';
    return;
  }
  if (password !== confirmPassword) {
    if (registerError) registerError.textContent = 'Las contraseñas no coinciden.';
    return;
  }
  const firstName = registerFirstNameInput?.value.trim() || '';
  const lastName = registerLastNameInput?.value.trim() || '';
  const email = registerEmailInput?.value.trim() || '';
  const newRecord = normaliseUser({
    username,
    password,
    role: CLIENT_ROLE,
    firstName,
    lastName,
    email,
    selfRegistered: true
  });
  users.push(newRecord);
  saveUsers();
  updateAvailableUsersHint();
  renderUserList();
  hideRegisterModal();
  setCurrentUser(buildUserSnapshot(newRecord));
  if (currentUser?.role === CLIENT_ROLE) {
    showCommercialFlash('Tu cuenta se creó correctamente. Ya puedes solicitar tarifas.');
  }
}

function handleLeadFormSubmit(event) {
  event.preventDefault();
  const tariffId = leadTariffIdInput?.value;
  if (!tariffId) return;
  const tariff = tariffs.find(t => t.id === tariffId);
  if (!tariff || !currentUser) return;
  const commercialRecord = getUserByUsername(currentUser.username) || currentUser;
  const commercialName = userDisplayName(commercialRecord);
  const lead = {
    id: createId('lead'),
    tariffId,
    tariffCodigo: tariff.codigo,
    tariffNombre: tariff.nombre,
    tariffCompania: tariff['compañia'],
    commercial: currentUser.username,
    commercialName,
    clientName: clientNameInput?.value.trim() || '',
    contact: clientContactInput?.value.trim() || '',
    notes: clientNotesInput?.value.trim() || '',
    status: 'pendiente',
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
    notified: true,
    origin: currentUser.role === CLIENT_ROLE ? CLIENT_ROLE : currentUser.role,
    installed: false
  };
  leads.push(lead);
  saveLeads();
  renderLeadSummary();
  renderAdminLeadList();
  renderCommercialPanel();
  renderTeamPanel();
  showCommercialFlash('Tu propuesta se ha enviado al administrador.');
  closeLeadModal();
}

function handleRequestFormSubmit(event) {
  event.preventDefault();
  const tariffId = requestTariffIdInput?.value;
  if (!tariffId) return;
  const tariff = tariffs.find(t => t.id === tariffId);
  if (!tariff) {
    if (requestError) requestError.textContent = 'La tarifa seleccionada ya no está disponible.';
    return;
  }
  const username = requestUsernameInput?.value.trim().toLowerCase();
  const password = requestPasswordInput?.value || '';
  const email = requestEmailInput?.value.trim();
  const phone = requestPhoneInput?.value.trim();
  const address = requestAddressInput?.value.trim();
  if (!username || !password || !email || !phone || !address) {
    if (requestError) requestError.textContent = 'Completa todos los campos para enviar tu solicitud.';
    return;
  }
  if (password.length < 6) {
    if (requestError) requestError.textContent = 'La contraseña debe tener al menos 6 caracteres.';
    return;
  }
  const emailLower = email.toLowerCase();
  const existing = users.find(user =>
    user.username === username ||
    (emailLower && user.email?.toLowerCase() === emailLower) ||
    (phone && (user.personalPhone === phone || user.companyPhone === phone))
  );
  let userRecord = existing || null;
  if (existing) {
    if (existing.password && existing.password !== password) {
      if (requestError) requestError.textContent = 'Las credenciales no coinciden con un usuario existente.';
      return;
    }
    let updated = false;
    if (!existing.email && email) { existing.email = email; updated = true; }
    if (!existing.personalPhone && phone) { existing.personalPhone = phone; updated = true; }
    if (!existing.address && address) { existing.address = address; updated = true; }
    if (!existing.password && password) { existing.password = password; updated = true; }
    if (updated) {
      saveUsers();
      updateAvailableUsersHint();
      renderUserList();
    }
  } else {
    const newUser = normaliseUser({
      username,
      password,
      role: CLIENT_ROLE,
      email,
      personalPhone: phone,
      address
    });
    newUser.password = password;
    users.push(newUser);
    saveUsers();
    updateAvailableUsersHint();
    renderUserList();
    userRecord = newUser;
  }
  if (!userRecord) {
    if (requestError) requestError.textContent = 'No se pudo crear el usuario. Inténtalo de nuevo.';
    return;
  }
  const displayName = userDisplayName(userRecord) || userRecord.username;
  const contact = [`Teléfono: ${phone}`, `Correo: ${email}`].filter(Boolean).join(' · ');
  const lead = {
    id: createId('lead'),
    tariffId,
    tariffCodigo: tariff.codigo,
    tariffNombre: tariff.nombre,
    tariffCompania: tariff['compañia'],
    commercial: userRecord.username,
    commercialName: displayName,
    clientName: displayName,
    contact,
    notes: `Dirección: ${address}`,
    status: 'pendiente',
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
    notified: true,
    origin: CLIENT_ROLE,
    installed: false,
    clientUsername: userRecord.username,
    referredBy: userRecord.referredBy || '',
    pointsLedger: { base: 0, referral: 0, awardedAt: null }
  };
  leads.push(lead);
  saveLeads();
  renderLeadSummary();
  renderAdminLeadList();
  renderCommercialPanel();
  renderTeamPanel();
  setCurrentUser(buildUserSnapshot(userRecord));
  closeRequestModal();
  showCommercialFlash('Hemos recibido tu solicitud. El equipo la revisará en breve.');
}

function showLoginModal() {
  if (!loginModal) return;
  loginModal.classList.remove('hidden');
  setTimeout(() => loginUserInput?.focus(), 50);
}

function hideLoginModal() {
  if (!loginModal) return;
  loginModal.classList.add('hidden');
  if (loginError) loginError.textContent = '';
  loginForm?.reset();
}

function handleLoginSubmit(event) {
  event.preventDefault();
  const username = loginUserInput?.value.trim().toLowerCase();
  const password = loginPassInput?.value;
  const user = users.find(u => u.username === username && u.password === password);
  if (!user) {
    if (loginError) loginError.textContent = 'Credenciales no válidas.';
    return;
  }
  setCurrentUser(buildUserSnapshot(user));
  hideLoginModal();
}

function setCurrentUser(user, { persist = true } = {}) {
  currentUser = user;
  if (persist) {
    persistSessionUser(user);
  }
  updateUIForRole();
  prefillProfileForm();
}

function logout() {
  setCurrentUser(null);
}

function updateUserInfo() {
  if (!userInfo) return;
  if (!currentUser) {
    userInfo.innerHTML = `
      <button class="primary" id="openLogin">Iniciar sesión</button>
      <button class="smallbtn" id="openRegister">Crear cuenta</button>
    `;
  } else {
    const displayName = userDisplayName(currentUser);
    const role = currentUser.role;
    const avatar = currentUser.photo ? `<img class="avatar" src="${currentUser.photo}" alt="${displayName}">` : '';
    userInfo.innerHTML = `
      ${avatar}
      <span class="dim">Sesión iniciada:</span>
      <span class="name">${displayName}</span>
      <span class="role-tag" data-role="${role}">${roleLabel(role)}</span>
      <button class="smallbtn" id="openProfile">Mi perfil</button>
      <button class="smallbtn" id="logoutBtn">Cerrar sesión</button>
    `;
  }
  const openBtn = $('#openLogin', userInfo);
  if (openBtn) openBtn.addEventListener('click', showLoginModal);
  const registerBtn = $('#openRegister', userInfo);
  if (registerBtn) registerBtn.addEventListener('click', showRegisterModal);
  const profileBtn = $('#openProfile', userInfo);
  if (profileBtn) profileBtn.addEventListener('click', openProfilePanel);
  const logoutBtn = $('#logoutBtn', userInfo);
  if (logoutBtn) logoutBtn.addEventListener('click', logout);
}

function updateUIForRole() {
  updateUserInfo();
  renderNotifications();
  if (!authReminder) return;
  if (!currentUser) {
    adminActiveTab = 'sales';
  }
  if (customBudgetButton) {
    const canRequestBudget = Boolean(currentUser && ['comercial', 'lider', CLIENT_ROLE].includes(currentUser.role));
    customBudgetButton.classList.toggle('hidden', !canRequestBudget);
  }
  if (callRequestButton) {
    callRequestButton.classList.remove('hidden');
  }
  if (currentUser?.role !== 'comercial' && currentUser?.role !== 'lider' && currentUser?.role !== CLIENT_ROLE) {
    hideCommercialNotifications();
  }
  if (profilePanel && !currentUser) {
    closeProfilePanel();
  }
  if (teamPanel && currentUser?.role !== 'lider') {
    teamPanel.classList.add('hidden');
  }
  if (!currentUser) {
    authReminder.classList.add('hidden');
    authNoticeBasic?.classList.add('hidden');
    adminPanel?.classList.add('hidden');
    commercialPanel?.classList.add('hidden');
    teamPanel?.classList.add('hidden');
  } else if (currentUser.role === 'basico') {
    authReminder.classList.remove('hidden');
    authNoticeBasic?.classList.remove('hidden');
    adminPanel?.classList.add('hidden');
    commercialPanel?.classList.add('hidden');
    teamPanel?.classList.add('hidden');
  } else if (currentUser.role === 'admin') {
    authReminder.classList.add('hidden');
    authNoticeBasic?.classList.add('hidden');
    adminPanel?.classList.remove('hidden');
    commercialPanel?.classList.add('hidden');
    teamPanel?.classList.add('hidden');
    renderTariffTable();
    renderLeadSummary();
    renderAdminLeadList();
    renderUserList();
    activateAdminTab(adminActiveTab);
  } else if (currentUser.role === CLIENT_ROLE) {
    authReminder.classList.add('hidden');
    authNoticeBasic?.classList.add('hidden');
    adminPanel?.classList.add('hidden');
    commercialPanel?.classList.remove('hidden');
    renderCommercialPanel();
    teamPanel?.classList.add('hidden');
  } else if (currentUser.role === 'comercial') {
    authReminder.classList.add('hidden');
    authNoticeBasic?.classList.add('hidden');
    adminPanel?.classList.add('hidden');
    commercialPanel?.classList.remove('hidden');
    renderCommercialPanel();
    teamPanel?.classList.add('hidden');
  } else if (currentUser.role === 'lider') {
    authReminder.classList.add('hidden');
    authNoticeBasic?.classList.add('hidden');
    adminPanel?.classList.add('hidden');
    commercialPanel?.classList.remove('hidden');
    teamPanel?.classList.remove('hidden');
    renderCommercialPanel();
    renderTeamPanel();
  }
  aplicarFiltros();
}

function updateLeadAssignmentsForUser(user) {
  if (!user) return false;
  const displayName = userDisplayName(user);
  let changed = false;
  leads.forEach(lead => {
    if (lead.commercial === user.username && lead.commercialName !== displayName) {
      lead.commercialName = displayName;
      changed = true;
    }
  });
  if (changed) {
    saveLeads();
  }
  return changed;
}

function prefillProfileForm() {
  if (!profileForm) return;
  if (!currentUser) {
    profileForm.reset();
    if (profileFormInfo) profileFormInfo.textContent = '';
    return;
  }
  const record = getUserByUsername(currentUser.username);
  if (!record) return;
  if (profileFirstName) profileFirstName.value = record.firstName || '';
  if (profileLastName) profileLastName.value = record.lastName || '';
  if (profileEmail) profileEmail.value = record.email || '';
  if (profileCompanyPhone) profileCompanyPhone.value = record.companyPhone || '';
  if (profilePersonalPhone) profilePersonalPhone.value = record.personalPhone || '';
  if (profilePhoto) profilePhoto.value = record.photo || '';
  if (profileAddress) profileAddress.value = record.address || '';
  if (profilePassword) profilePassword.value = '';
  if (profilePasswordConfirm) profilePasswordConfirm.value = '';
  if (profileFormInfo) profileFormInfo.textContent = '';
}

function handleProfileFormSubmit(event) {
  event.preventDefault();
  if (!currentUser) return;
  const record = getUserByUsername(currentUser.username);
  if (!record) return;
  const newPassword = profilePassword?.value || '';
  const confirmPassword = profilePasswordConfirm?.value || '';
  if (newPassword || confirmPassword) {
    if (newPassword !== confirmPassword) {
      if (profileFormInfo) profileFormInfo.textContent = 'Las contraseñas no coinciden.';
      return;
    }
    record.password = newPassword;
  }
  record.firstName = profileFirstName?.value.trim() || '';
  record.lastName = profileLastName?.value.trim() || '';
  record.email = profileEmail?.value.trim() || '';
  record.companyPhone = profileCompanyPhone?.value.trim() || '';
  record.personalPhone = profilePersonalPhone?.value.trim() || '';
  record.photo = profilePhoto?.value.trim() || '';
  record.address = profileAddress?.value.trim() || '';
  saveUsers();
  updateAvailableUsersHint();
  const leadsUpdated = updateLeadAssignmentsForUser(record);
  setCurrentUser(buildUserSnapshot(record));
  if (profileFormInfo) profileFormInfo.textContent = 'Perfil actualizado correctamente.';
  if (leadsUpdated) {
    renderLeadSummary();
    renderAdminLeadList();
    renderCommercialPanel();
    renderTeamPanel();
  }
  renderUserList();
}

function toggleManagedUsersField(role) {
  if (!managedUsersField) return;
  if (role === 'lider') {
    managedUsersField.classList.remove('hidden');
  } else {
    managedUsersField.classList.add('hidden');
  }
}

function populateManagedUserOptions(selected = []) {
  if (!userManagedUsers) return;
  const select = userManagedUsers;
  const managerUsername = editingUser || userUsername?.value.trim().toLowerCase() || '';
  const available = users
    .filter(user => user.role === 'comercial' && user.username !== managerUsername)
    .sort((a, b) => userDisplayName(a).localeCompare(userDisplayName(b), 'es'));
  const selectedSet = new Set((selected || []).filter(Boolean));
  select.innerHTML = '';
  if (!available.length) {
    const option = document.createElement('option');
    option.value = '';
    option.textContent = 'Sin comerciales disponibles';
    option.disabled = true;
    select.appendChild(option);
    return;
  }
  available.forEach(user => {
    const option = document.createElement('option');
    option.value = user.username;
    option.textContent = `${userDisplayName(user)} (${user.username})`;
    option.selected = selectedSet.has(user.username);
    select.appendChild(option);
  });
  selectedSet.forEach(value => {
    if (!available.some(user => user.username === value)) {
      const option = document.createElement('option');
      option.value = value;
      option.textContent = `${value} (no disponible)`;
      option.selected = true;
      option.disabled = true;
      select.appendChild(option);
    }
  });
}

function resetUserForm(options = {}) {
  if (!userForm) return;
  userForm.reset();
  editingUser = null;
  if (userUsername) {
    userUsername.value = '';
    userUsername.removeAttribute('disabled');
  }
  if (userPassword) {
    userPassword.value = '';
    userPassword.placeholder = 'Obligatoria al crear';
  }
  if (saveUserBtn) saveUserBtn.textContent = 'Crear usuario';
  if (!options.keepMessage && userFormInfo) userFormInfo.textContent = '';
  toggleManagedUsersField(userRole?.value || 'basico');
  populateManagedUserOptions([]);
}

function prefillUserForm(user) {
  if (!userForm || !user) return;
  editingUser = user.username;
  if (userUsername) {
    userUsername.value = user.username;
    userUsername.setAttribute('disabled', 'true');
  }
  if (userPassword) {
    userPassword.value = '';
    userPassword.placeholder = 'Deja en blanco para mantenerla';
  }
  if (userRole) userRole.value = user.role;
  if (userEmail) userEmail.value = user.email || '';
  if (userFirstName) userFirstName.value = user.firstName || '';
  if (userLastName) userLastName.value = user.lastName || '';
  if (userCompanyPhone) userCompanyPhone.value = user.companyPhone || '';
  if (userPersonalPhone) userPersonalPhone.value = user.personalPhone || '';
  if (userPhoto) userPhoto.value = user.photo || '';
  if (userAddress) userAddress.value = user.address || '';
  toggleManagedUsersField(user.role);
  populateManagedUserOptions(user.role === 'lider' ? user.managedUsers : []);
  if (userFormInfo) userFormInfo.textContent = `Editando el usuario «${userDisplayName(user)}» (${user.username}).`;
  if (saveUserBtn) saveUserBtn.textContent = 'Actualizar usuario';
}

function handleUserFormSubmit(event) {
  event.preventDefault();
  if (!userForm) return;
  const usernameValue = userUsername?.value.trim().toLowerCase() || '';
  const isEditing = Boolean(editingUser);
  const targetUsername = isEditing ? editingUser : usernameValue;
  if (!usernameValue) {
    if (userFormInfo) userFormInfo.textContent = 'El nombre de usuario es obligatorio.';
    return;
  }
  if (!isEditing && users.some(u => u.username === usernameValue)) {
    if (userFormInfo) userFormInfo.textContent = 'Ya existe un usuario con ese identificador.';
    return;
  }
  const roleValue = userRole?.value || 'basico';
  const passwordValue = userPassword?.value || '';
  if (!isEditing && !passwordValue) {
    if (userFormInfo) userFormInfo.textContent = 'Debes indicar una contraseña inicial.';
    return;
  }
  let record = isEditing ? getUserByUsername(editingUser) : null;
  if (isEditing && !record) {
    if (userFormInfo) userFormInfo.textContent = 'No se encontró el usuario seleccionado.';
    return;
  }
  const managedSelection = roleValue === 'lider'
    ? Array.from(userManagedUsers?.selectedOptions || []).map(option => option.value).filter(Boolean)
    : [];
  if (isEditing) {
    if (record.role === 'admin' && roleValue !== 'admin') {
      const otherAdmins = users.filter(user => user.username !== record.username && user.role === 'admin');
      if (!otherAdmins.length) {
        if (userFormInfo) userFormInfo.textContent = 'Debe permanecer al menos un administrador activo.';
        return;
      }
    }
    record.role = roleValue;
    record.email = userEmail?.value.trim() || '';
    record.firstName = userFirstName?.value.trim() || '';
    record.lastName = userLastName?.value.trim() || '';
    record.companyPhone = userCompanyPhone?.value.trim() || '';
    record.personalPhone = userPersonalPhone?.value.trim() || '';
    record.photo = userPhoto?.value.trim() || '';
    record.address = userAddress?.value.trim() || '';
    if (passwordValue) record.password = passwordValue;
    record.managedUsers = roleValue === 'lider' ? managedSelection : [];
    if (roleValue !== 'comercial') {
      removeFromManagedTeams(record.username);
    }
    if (userFormInfo) userFormInfo.textContent = 'Usuario actualizado correctamente.';
  } else {
    const payload = normaliseUser({
      username: usernameValue,
      password: passwordValue,
      role: roleValue,
      email: userEmail?.value.trim() || '',
      firstName: userFirstName?.value.trim() || '',
      lastName: userLastName?.value.trim() || '',
      companyPhone: userCompanyPhone?.value.trim() || '',
      personalPhone: userPersonalPhone?.value.trim() || '',
      photo: userPhoto?.value.trim() || '',
      address: userAddress?.value.trim() || '',
      managedUsers: managedSelection,
      selfRegistered: false
    });
    users.push(payload);
    if (userFormInfo) userFormInfo.textContent = 'Usuario creado correctamente.';
  }
  cleanManagedUsers(users);
  saveUsers();
  updateAvailableUsersHint();
  renderUserList();
  populateManagedUserOptions(isEditing && roleValue === 'lider' ? managedSelection : []);
  const updatedRecord = getUserByUsername(targetUsername);
  const leadsUpdated = updateLeadAssignmentsForUser(updatedRecord);
  if (currentUser?.username === targetUsername) {
    if (updatedRecord) {
      setCurrentUser(buildUserSnapshot(updatedRecord));
      if (leadsUpdated) {
        renderLeadSummary();
        renderAdminLeadList();
        renderCommercialPanel();
        renderTeamPanel();
      }
    } else {
      setCurrentUser(null);
    }
  } else {
    if (currentUser?.role === 'lider') {
      const manager = getUserByUsername(currentUser.username);
      if (manager) {
        setCurrentUser(buildUserSnapshot(manager));
      }
    }
    if (leadsUpdated) {
      renderLeadSummary();
      renderAdminLeadList();
      renderCommercialPanel();
      renderTeamPanel();
    } else {
      renderTeamPanel();
    }
  }
  resetUserForm({ keepMessage: true });
}

function handleUserListAction(event) {
  const button = event.target.closest('button[data-action][data-username]');
  if (!button) return;
  const action = button.dataset.action;
  const username = button.dataset.username;
  const user = getUserByUsername(username);
  if (!user) return;
  if (action === 'edit-user') {
    prefillUserForm(user);
    userForm?.scrollIntoView({ behavior: 'smooth', block: 'start' });
    return;
  }
  if (action === 'delete-user') {
    if (currentUser?.username === username) {
      alert('No puedes eliminar tu propia cuenta mientras está iniciada la sesión.');
      return;
    }
    if (user.role === 'admin') {
      const otherAdmins = users.filter(entry => entry.username !== username && entry.role === 'admin');
      if (!otherAdmins.length) {
        alert('Debe permanecer al menos un administrador activo.');
        return;
      }
    }
    if (!confirm(`¿Seguro que deseas eliminar al usuario «${userDisplayName(user)}» (${user.username})?`)) {
      return;
    }
    removeFromManagedTeams(username);
    users = users.filter(entry => entry.username !== username);
    cleanManagedUsers(users);
    saveUsers();
    updateAvailableUsersHint();
    renderUserList();
    renderTeamPanel();
    if (editingUser === username) {
      resetUserForm();
    }
    if (currentUser?.role === 'lider') {
      const manager = getUserByUsername(currentUser.username);
      if (manager) {
        setCurrentUser(buildUserSnapshot(manager));
      }
    }
  }
}

function renderUserList() {
  if (!userListContainer) return;
  if (!users.length) {
    userListContainer.innerHTML = '<p class="dim">Aún no hay cuentas registradas.</p>';
    return;
  }
  const filterValue = userRoleFilter?.value || 'all';
  const filteredUsers = users
    .slice()
    .filter(user => {
      if (filterValue === 'all') return true;
      if (filterValue === 'direct-client') {
        return user.role === CLIENT_ROLE && Boolean(user.selfRegistered);
      }
      if (filterValue === 'cliente') {
        return user.role === CLIENT_ROLE && !user.selfRegistered;
      }
      return user.role === filterValue;
    })
    .sort((a, b) => userDisplayName(a).localeCompare(userDisplayName(b), 'es'));
  if (!filteredUsers.length) {
    userListContainer.innerHTML = '<p class="dim">No hay usuarios que coincidan con el filtro seleccionado.</p>';
    return;
  }
  const rows = filteredUsers
    .map(user => {
      const name = userDisplayName(user);
      const email = user.email || '-';
      const companyPhone = user.companyPhone || '-';
      const personalPhone = user.personalPhone || '-';
      const addressLine = user.address ? `<br><span class="dim">${user.address}</span>` : '';
      const members = Array.isArray(user.managedUsers) ? user.managedUsers : [];
      const memberNames = members
        .map(username => {
          const record = getUserByUsername(username);
          return record ? userDisplayName(record) : username;
        })
        .filter(Boolean);
      const teamCount = user.role === 'lider' ? members.length : 0;
      const teamTitle = memberNames.join(', ');
      const deleteDisabled = currentUser?.username === user.username ? 'disabled' : '';
      const roleText = roleLabel(user.role);
      const tagBadges = [];
      if (user.role === 'lider') {
        tagBadges.push('<span class="tag">Responsable</span>');
      }
      if (user.role === CLIENT_ROLE && user.selfRegistered) {
        tagBadges.push('<span class="tag tag-warning">Cliente directo</span>');
      }
      const badgesMarkup = tagBadges.length
        ? `<div style="margin-top:6px; display:flex; gap:6px; flex-wrap:wrap;">${tagBadges.join('')}</div>`
        : '';
      const teamCell = user.role === 'lider'
        ? `<td${teamTitle ? ` title="${teamTitle.replace(/"/g, '&quot;')}"` : ''}>${teamCount}</td>`
        : '<td>-</td>';
      return `
        <tr data-username="${user.username}">
          <td><strong>${name}</strong><br><span class="dim">${user.username}</span>${addressLine}${badgesMarkup}</td>
          <td>${roleText}</td>
          <td>${email}</td>
          <td>${companyPhone}</td>
          <td>${personalPhone}</td>
          ${teamCell}
          <td>
            <div class="controls">
              <button class="smallbtn" data-action="edit-user" data-username="${user.username}">Editar</button>
              <button class="smallbtn" data-action="delete-user" data-username="${user.username}" ${deleteDisabled}>Eliminar</button>
            </div>
          </td>
        </tr>
      `;
    })
    .join('');
  userListContainer.innerHTML = `
    <table class="data-table">
      <thead>
        <tr>
          <th>Usuario</th>
          <th>Rol</th>
          <th>Correo</th>
          <th>Tel. empresa</th>
          <th>Tel. personal</th>
          <th>Equipo</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>
  `;
}

async function initRemoteSync() {
  if (!remoteState.enabled) {
    return;
  }
  try {
    if (!firebaseAppInstance) {
      firebaseAppInstance = initializeApp(window.FIREBASE_CONFIG);
    }
    if (!firestoreDb) {
      firestoreDb = getFirestore(firebaseAppInstance);
    }
    if (!REMOTE_TARGET || !REMOTE_TARGET.collection || !REMOTE_TARGET.document) {
      console.warn('REMOTE_TARGET no definido correctamente, usando valores por defecto.');
    }
    const collectionName = REMOTE_TARGET.collection || 'app';
    const documentName = REMOTE_TARGET.document || 'state';
    remoteDocRef = doc(firestoreDb, collectionName, documentName);
    setSyncStatus('connecting', 'Conectando…');
    if (!remoteState.unsub) {
      remoteState.unsub = onSnapshot(remoteDocRef, (snapshot) => {
        remoteState.ready = true;
        remoteState.lastError = null;
        applyRemoteData(snapshot.data());
        if (!remoteState.writing && !remoteState.pending) {
          setSyncStatus('online', 'Sincronizado');
        }
      }, (error) => {
        remoteState.lastError = error;
        console.error('Error en la suscripción a Firestore', error);
        setSyncStatus('error', 'Error de sincronización');
      });
    }
    const existing = await getDoc(remoteDocRef);
    if (!existing.exists()) {
      await setDoc(remoteDocRef, {
        users: DEFAULT_USERS,
        tariffs: BASE_DATA,
        leads: [],
        rewards: [],
        updatedAt: serverTimestamp()
      });
    }
    flushRemoteQueue();
  } catch (error) {
    remoteState.lastError = error;
    console.error('No se pudo iniciar la sincronización remota', error);
    setSyncStatus('error', 'Sin conexión');
  }
}

initRemoteSync();

document.addEventListener('DOMContentLoaded', () => {
  domReady = true;
  syncStatusEl = document.querySelector('#syncStatus');
  renderSyncStatus();

  grid = $('#grid');
  countEl = $('#count');
  authReminder = $('#authReminder');
  authNoticeAnonymous = $('#authNoticeAnonymous');
  authNoticeBasic = $('#authNoticeBasic');
  adminPanel = $('#adminPanel');
  commercialPanel = $('#commercialPanel');
  userInfo = $('#userInfo');
  loginModal = $('#loginModal');
  loginForm = $('#loginForm');
  loginError = $('#loginError');
  loginUserInput = $('#loginUser');
  loginPassInput = $('#loginPass');
  registerModal = $('#registerModal');
  registerForm = $('#registerForm');
  registerError = $('#registerError');
  registerUserInput = $('#registerUser');
  registerPassInput = $('#registerPass');
  registerPassConfirmInput = $('#registerPassConfirm');
  registerFirstNameInput = $('#registerFirstName');
  registerLastNameInput = $('#registerLastName');
  registerEmailInput = $('#registerEmail');
  leadModal = $('#leadModal');
  leadForm = $('#leadForm');
  leadTariffName = $('#leadTariffName');
  leadTariffIdInput = $('#leadTariffId');
  requestModal = $('#requestModal');
  requestForm = $('#requestForm');
  requestTariffName = $('#requestTariffName');
  requestTariffIdInput = $('#requestTariffId');
  requestUsernameInput = $('#requestUsername');
  requestPasswordInput = $('#requestPassword');
  requestEmailInput = $('#requestEmail');
  requestPhoneInput = $('#requestPhone');
  requestAddressInput = $('#requestAddress');
  requestError = $('#requestError');
  commercialNotifications = $('#commercialNotifications');
  commercialLeads = $('#commercialLeads');
  commercialMetrics = $('#commercialMetrics');
  clientPlanSection = $('#clientPlanSection');
  clientPointsBalance = $('#clientPointsBalance');
  clientRewardsContainer = $('#clientRewards');
  clientPointsHistory = $('#clientPointsHistory');
  clientPointsHistoryList = $('#clientPointsHistoryList');
  referralModal = $('#referralModal');
  referralForm = $('#referralForm');
  referralTariffSelect = $('#referralTariff');
  referralFriendNameInput = $('#referralFriendName');
  referralFriendUsernameInput = $('#referralFriendUsername');
  referralFriendPasswordInput = $('#referralFriendPassword');
  referralFriendEmailInput = $('#referralFriendEmail');
  referralFriendPhoneInput = $('#referralFriendPhone');
  referralFriendAddressInput = $('#referralFriendAddress');
  referralNotesInput = $('#referralNotes');
  referralError = $('#referralError');
  leadSummary = $('#leadSummary');
  leadList = $('#leadList');
  leadFilter = $('#leadFilter');
  directClientSection = $('#directClientSection');
  directClientList = $('#directClientList');
  directClientEmpty = $('#directClientEmpty');
  adminSalesTotals = $('#adminSalesTotals');
  adminSalesStats = $('#adminSalesStats');
  adminClientStats = $('#adminClientStats');
  adminSalesRangeControls = $('#adminSalesRangeControls');
  adminSalesRangeLabel = $('#adminSalesRangeLabel');
  adminTabs = $('#adminTabs');
  adminSalesTab = $('#adminSalesTab');
  adminTariffsTab = $('#adminTariffsTab');
  adminClientsTab = $('#adminClientsTab');
  adminRewardsTab = $('#adminRewardsTab');
  adminUsersTab = $('#adminUsersTab');
  adminTabButtons = adminTabs ? Array.from(adminTabs.querySelectorAll('button[data-tab]')) : [];
  adminTabPanels = {
    sales: adminSalesTab,
    tariffs: adminTariffsTab,
    clients: adminClientsTab,
    rewards: adminRewardsTab,
    users: adminUsersTab
  };
  activateAdminTab(adminActiveTab);
  tarifaList = $('#tarifaList');
  tarifaForm = $('#tarifaForm');
  tarifaFormInfo = $('#tarifaFormInfo');
  guardarTarifaBtn = $('#guardarTarifa');
  cancelarEdicionBtn = $('#cancelarEdicion');
  tarifaCodigo = $('#tarifaCodigo');
  tarifaNombre = $('#tarifaNombre');
  tarifaCompania = $('#tarifaCompania');
  tarifaTipo = $('#tarifaTipo');
  tarifaLineas = $('#tarifaLineas');
  tarifaPrecio = $('#tarifaPrecio');
  tarifaMoneda = $('#tarifaMoneda');
  tarifaPermanencia = $('#tarifaPermanencia');
  tarifaDesde = $('#tarifaDesde');
  tarifaHasta = $('#tarifaHasta');
  tarifaDescripcion = $('#tarifaDescripcion');
  tarifaDestacadaInput = $('#tarifaDestacada');
  adminTariffTabsContainer = $('#adminTariffCompanyTabs');
  adminTariffTypeContainer = $('#adminTariffTypeFilters');
  tarifaPlataformasInput = $('#tarifaPlataformas');
  customBudgetSection = $('#customBudgetSection');
  customBudgetList = $('#customBudgetList');
  callRequestSection = $('#callRequestSection');
  callRequestList = $('#callRequestList');
  rewardForm = $('#rewardForm');
  rewardFormInfo = $('#rewardFormInfo');
  rewardIdInput = $('#rewardId');
  rewardTitleInput = $('#rewardTitle');
  rewardPointsInput = $('#rewardPoints');
  rewardUnitsInput = $('#rewardUnits');
  rewardValidFromInput = $('#rewardValidFrom');
  rewardValidUntilInput = $('#rewardValidUntil');
  rewardImageInput = $('#rewardImage');
  rewardImageDropzone = $('#rewardImageDropzone');
  rewardImageFileInput = $('#rewardImageFile');
  rewardImagePreview = $('#rewardImagePreview');
  rewardImageClearBtn = $('#rewardImageClear');
  rewardImageActions = $('#rewardImageActions');
  rewardDescriptionInput = $('#rewardDescription');
  rewardList = $('#rewardList');
  clientNameInput = $('#clientName');
  clientContactInput = $('#clientContact');
  clientNotesInput = $('#clientNotes');
  aiPanel = $('#aiPanel');
  aiForm = $('#aiSearchForm');
  aiFiberSelect = $('#aiFiberSpeed');
  aiMobilePreferenceSelect = $('#aiMobilePreference');
  aiMobileLinesSelect = $('#aiMobileLines');
  aiTvPreferenceSelect = $('#aiTvPreference');
  aiTvPlatformSelect = $('#aiTvPlatform');
  aiLinesField = $('#aiLinesField');
  aiTvField = $('#aiTvField');
  aiResults = $('#aiResults');
  aiClearBtn = $('#aiSearchClear');
  customBudgetModal = $('#customBudgetModal');
  customBudgetForm = $('#customBudgetForm');
  customBudgetSummaryInput = $('#customBudgetSummary');
  customBudgetContactInput = $('#customBudgetContact');
  callRequestModal = $('#callRequestModal');
  callRequestForm = $('#callRequestForm');
  callRequestNameInput = $('#callRequestName');
  callRequestPhoneInput = $('#callRequestPhone');
  callRequestTimeInput = $('#callRequestTime');
  callRequestNotesInput = $('#callRequestNotes');
  customBudgetButton = $('#customBudgetButton');
  notificationButton = $('#notificationButton');
  notificationDropdown = $('#notificationDropdown');
  notificationList = $('#notificationList');
  notificationDot = $('#notificationDot');
  markNotificationsReadBtn = $('#markNotificationsRead');
  closeNotificationsBtn = $('#closeNotifications');
  callRequestButton = $('#callRequestButton');

  profilePanel = $('#profilePanel');
  profileForm = $('#profileForm');
  profileFormInfo = $('#profileFormInfo');
  profileFirstName = $('#profileFirstName');
  profileLastName = $('#profileLastName');
  profileEmail = $('#profileEmail');
  profileCompanyPhone = $('#profileCompanyPhone');
  profilePersonalPhone = $('#profilePersonalPhone');
  profilePhoto = $('#profilePhoto');
  profileAddress = $('#profileAddress');
  profilePassword = $('#profilePassword');
  profilePasswordConfirm = $('#profilePasswordConfirm');
  closeProfileBtn = $('#closeProfile');

  teamPanel = $('#teamPanel');
  teamSummary = $('#teamSummary');
  teamLeadList = $('#teamLeadList');

  userForm = $('#userForm');
  userFormInfo = $('#userFormInfo');
  userUsername = $('#userUsername');
  userPassword = $('#userPassword');
  userRole = $('#userRole');
  userEmail = $('#userEmail');
  userFirstName = $('#userFirstName');
  userLastName = $('#userLastName');
  userCompanyPhone = $('#userCompanyPhone');
  userPersonalPhone = $('#userPersonalPhone');
  userPhoto = $('#userPhoto');
  userAddress = $('#userAddress');
  userManagedUsers = $('#userManagedUsers');
  managedUsersField = $('#managedUsersField');
  userRoleFilter = $('#userRoleFilter');
  userListContainer = $('#userList');
  saveUserBtn = $('#saveUserBtn');
  cancelUserEdit = $('#cancelUserEdit');

  setupRewardImageUploader();

  users = loadUsersFromStorage();
  tariffs = loadTariffsFromStorage();
  leads = loadLeadsFromStorage();
  rewards = loadRewardsFromStorage();
  notifications = loadNotificationsFromStorage();
  callRequests = loadCallRequestsFromStorage();
  customBudgets = loadCustomBudgetsFromStorage();

  resetUserForm();

  populateReferralTariffs();
  populateAiLinesOptions();
  renderEverythingAfterDataChange({ refreshAi: Boolean(aiLastQuery) });
  $('#imprimir')?.addEventListener('click', () => window.print());

  loginForm?.addEventListener('submit', handleLoginSubmit);
  $('#cancelLogin')?.addEventListener('click', hideLoginModal);
  loginModal?.addEventListener('click', (event) => { if (event.target === loginModal) hideLoginModal(); });

  registerForm?.addEventListener('submit', handleRegisterSubmit);
  $('#cancelRegister')?.addEventListener('click', hideRegisterModal);
  registerModal?.addEventListener('click', (event) => { if (event.target === registerModal) hideRegisterModal(); });

  leadForm?.addEventListener('submit', handleLeadFormSubmit);
  $('#cancelLead')?.addEventListener('click', closeLeadModal);
  leadModal?.addEventListener('click', (event) => { if (event.target === leadModal) closeLeadModal(); });

  requestForm?.addEventListener('submit', handleRequestFormSubmit);
  $('#cancelRequest')?.addEventListener('click', closeRequestModal);
  requestModal?.addEventListener('click', (event) => { if (event.target === requestModal) closeRequestModal(); });

  referralForm?.addEventListener('submit', handleReferralSubmit);
  $('#openReferral')?.addEventListener('click', openReferralModal);
  $('#cancelReferral')?.addEventListener('click', closeReferralModal);
  referralModal?.addEventListener('click', (event) => { if (event.target === referralModal) closeReferralModal(); });

  profileForm?.addEventListener('submit', handleProfileFormSubmit);
  closeProfileBtn?.addEventListener('click', closeProfilePanel);
  profilePanel?.addEventListener('click', (event) => { if (event.target === profilePanel) closeProfilePanel(); });

  tarifaForm?.addEventListener('submit', handleTarifaFormSubmit);
  cancelarEdicionBtn?.addEventListener('click', () => resetTariffForm());
  tarifaList?.addEventListener('click', handleTarifaListAction);
  adminTariffTabsContainer?.addEventListener('click', handleAdminTariffTabClick);
  adminTariffTypeContainer?.addEventListener('click', handleAdminTariffTypeClick);
  grid?.addEventListener('click', handleTariffGridClick);

  rewardForm?.addEventListener('submit', handleRewardFormSubmit);
  $('#cancelRewardEdit')?.addEventListener('click', () => resetRewardForm());
  rewardList?.addEventListener('click', handleRewardListAction);
  clientRewardsContainer?.addEventListener('click', handleClientRewardAction);

  leadList?.addEventListener('click', handleLeadListAction);
  directClientList?.addEventListener('click', handleLeadListAction);
  teamLeadList?.addEventListener('click', handleLeadListAction);
  leadFilter?.addEventListener('change', renderAdminLeadList);

  userForm?.addEventListener('submit', handleUserFormSubmit);
  cancelUserEdit?.addEventListener('click', () => resetUserForm());
  userRole?.addEventListener('change', () => {
    const role = userRole.value;
    toggleManagedUsersField(role);
    const selected = editingUser ? (getUserByUsername(editingUser)?.managedUsers || []) : [];
    populateManagedUserOptions(role === 'lider' ? selected : []);
  });
  userRoleFilter?.addEventListener('change', renderUserList);
  userListContainer?.addEventListener('click', handleUserListAction);
  adminTabs?.addEventListener('click', (event) => {
    const button = event.target.closest('button[data-tab]');
    if (!button) return;
    event.preventDefault();
    activateAdminTab(button.dataset.tab);
  });

  adminSalesRangeControls?.addEventListener('click', (event) => {
    const button = event.target.closest('button[data-range]');
    if (!button) return;
    event.preventDefault();
    const targetRange = button.dataset.range || 'month';
    if (targetRange === adminSalesRange) return;
    adminSalesRange = targetRange;
    renderAdminSalesStats();
  });

  aiForm?.addEventListener('submit', handleAiSearchSubmit);
  aiClearBtn?.addEventListener('click', resetAiSearch);
  aiResults?.addEventListener('click', handleAiResultsClick);
  aiMobilePreferenceSelect?.addEventListener('change', handleAiMobilePreferenceChange);
  aiTvPreferenceSelect?.addEventListener('change', handleAiTvPreferenceChange);

  notificationButton?.addEventListener('click', (event) => {
    event.preventDefault();
    toggleNotifications();
  });
  markNotificationsReadBtn?.addEventListener('click', markCurrentNotificationsAsRead);
  closeNotificationsBtn?.addEventListener('click', hideNotifications);

  customBudgetButton?.addEventListener('click', openCustomBudgetModal);
  customBudgetForm?.addEventListener('submit', handleCustomBudgetSubmit);
  $('#cancelCustomBudget')?.addEventListener('click', closeCustomBudgetModal);
  customBudgetModal?.addEventListener('click', (event) => {
    if (event.target === customBudgetModal) {
      closeCustomBudgetModal();
    }
  });
  customBudgetList?.addEventListener('click', handleCustomBudgetAction);

  callRequestButton?.addEventListener('click', openCallRequestModal);
  callRequestForm?.addEventListener('submit', handleCallRequestSubmit);
  $('#cancelCallRequest')?.addEventListener('click', closeCallRequestModal);
  callRequestModal?.addEventListener('click', (event) => {
    if (event.target === callRequestModal) {
      closeCallRequestModal();
    }
  });
  callRequestList?.addEventListener('click', handleCallRequestAction);

  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape') {
      hideLoginModal();
      closeLeadModal();
      hideRegisterModal();
      closeRequestModal();
      closeProfilePanel();
      closeCustomBudgetModal();
      closeCallRequestModal();
      hideNotifications();
    }
  });

  window.addEventListener('storage', handleStorageEvent);

  const savedUser = loadSessionUser();
  if (savedUser?.username) {
    const record = getUserByUsername(savedUser.username);
    if (record) {
      setCurrentUser(buildUserSnapshot(record), { persist: false });
    } else {
      persistSessionUser(null);
      updateUIForRole();
    }
  } else {
    updateUIForRole();
  }

  resetAiSearch();
});
</script>
</body>
</html>
